var H=Object.defineProperty,R=Object.defineProperties;var w=Object.getOwnPropertyDescriptors;var b=Object.getOwnPropertySymbols;var P=Object.prototype.hasOwnProperty,z=Object.prototype.propertyIsEnumerable;var k=(a,e,t)=>e in a?H(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t,I=(a,e)=>{for(var t in e||(e={}))P.call(e,t)&&k(a,t,e[t]);if(b)for(var t of b(e))z.call(e,t)&&k(a,t,e[t]);return a},D=(a,e)=>R(a,w(e));import{a8 as A,c2 as V,r as p,fM as G,R as r,aj as B,cK as $,aJ as m,ed as N,aS as _,eg as j,dd as K,cj as C,cG as F,dg as Y,fd as J,dQ as Q,eC as S,cH as W,eB as X,fN as T,ek as y,dc as Z,em as q,eo as ee}from"./index.7daee9ef.js";import{B as te}from"./BrightcoveLogoIcon.9d2bdc09.js";import{U as ae}from"./UploadInput.4c4e4115.js";import{M as re}from"./MediaListing.c26c4fa3.js";const L=a=>a?a.replace(/^\s*[\r\n]/gm,"").trim().split(`
`).map(e=>e.match(/\d{13}/gm)||[""]).map(e=>({accountId:e[0],videoId:e[1]})):[],M=(a,e)=>{const t=L(a);return t.length?t.every(o=>o.videoId&&o.accountId===e):!1},O={gridContainer:{position:"relative",alignItems:"center"},uploadButton:{wordBreak:"keep-all"}},oe=A("div")({position:"absolute"}),se=({onChange:a,isOptional:e=!1})=>{const t=V(),[o,c]=p.exports.useState(""),[s,g]=p.exports.useState(""),[n,l]=p.exports.useState(0),{accountId:d}=G(),h=i=>{const u=i.target.value;c(u),!(u!=null&&u.length)&&e?g(""):!u||!M(u,d)?g(t("ra.message.uploadBrightcoveLinkFail")):g("")},f=p.exports.useCallback(()=>{let i=L(o);a(i),c("")},[o,a]),E=Boolean(s);return r.createElement(B,{"data-testid":"FormUploadBrightCove__root",mb:E?`${n}px`:0},r.createElement(B,{pb:2},r.createElement($,null,t("resources.input.pasteVideoLink"))),r.createElement(m,{container:!0,spacing:1,alignItems:"center"},r.createElement(m,{item:!0},r.createElement(B,{display:"flex"},r.createElement(te,null))),r.createElement(m,{item:!0,xs:!0,sx:O.gridContainer},r.createElement(N,{fullWidth:!0,inputProps:{"data-testid":"FormUploadBrightCove__input"},name:"url",size:"small",margin:"none",label:t(`resources.${_.LOS}.brightcoveVideoLink`),value:o,onChange:h,error:!!s}),E&&r.createElement(oe,{ref:i=>{i&&i.offsetHeight!==n&&l(i.offsetHeight)}},r.createElement(j,{variant:"standard",error:!0},s))),r.createElement(m,{item:!0},r.createElement(K,{sx:O.uploadButton,"data-testid":"FormUploadBrightCove__button","aria-label":t("ra.common.action.upload"),disabled:!M(o,d),onClick:f},t("ra.common.action.upload")))))},ne=(a,e)=>p.exports.useCallback((t,o)=>{if(t=t.filter(s=>"media_id"in s),!t||!t.length)return!1;let c=!1;return t.forEach(s=>{if(s.media_id===o.media_id){a(e("ra.message.brightcoveVideoLinkHasExisted"),S.ERROR),c=!0;return}}),c},[a,e]),ie=(a,e,t)=>{const o=V(),c=ne(t,o),s=W();return p.exports.useCallback(async g=>{var n;try{const l=C(g);if(!l)return;const{data:d}=await s(F.GET_BRIGHTCOVE_VIDEO_INFO,_.BRIGHTCOVE,I({},l)),h={resource:l.videoId,type:Y.MediaType.MEDIA_TYPE_VIDEO,name:d.name},{data:f}=await s(F.CREATE,_.MEDIA,{data:h}),E=[D(I({},h),{type:J.MEDIA_TYPE_VIDEO,id:String(f.id),media_id:String(f.id)})];if(!c(a,C(E))){const i=C(E);i&&e(i)}}catch(l){const d=Q(l);(n=window.warner)==null||n.log(d.message),t(`${o("ra.manabie-error.cannotUpload")}: ${d.message}`,S.ERROR)}},[s,c,a,e,t,o])},pe=a=>{const{files:e,isBrightCoveOptional:t,variant:o,formUploadFileProps:c={},onChange:s}=a,{multiple:g}=c,[n,l]=p.exports.useState(e!=null?e:[]),d=X(),h=V(),{size:f,unit:E}=q(T),i=ie(n,v=>l([...n,v]),d),u=v=>{const x=ee(n,v);l(x)},U=v=>{const x=g?[...n,...v]:[...v];l(x)};return p.exports.useEffect(()=>{s(n)},[n,s]),r.createElement(m,{container:!0,spacing:2,direction:"column"},r.createElement(m,{item:!0},r.createElement(re,{medias:n,onDelete:u,variant:o})),r.createElement(m,{item:!0},r.createElement(ae,I({onChange:U,maxSize:T,description:h("ra.message.maxFileSizeIs",{fileSize:f,fileUnit:E}),rootDefaultPadding:!1,descDefaultMargin:!1,accept:[y.PDF,y.VIDEO]},c))),r.createElement(m,{item:!0},r.createElement(Z,null)),r.createElement(m,{item:!0},r.createElement(se,{onChange:i,isOptional:t})))};export{pe as F};
