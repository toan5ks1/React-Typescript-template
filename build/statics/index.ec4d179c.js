var wt=Object.defineProperty,Ft=Object.defineProperties;var Ot=Object.getOwnPropertyDescriptors;var re=Object.getOwnPropertySymbols;var Re=Object.prototype.hasOwnProperty,Be=Object.prototype.propertyIsEnumerable;var Me=(e,a,o)=>a in e?wt(e,a,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[a]=o,b=(e,a)=>{for(var o in a||(a={}))Re.call(a,o)&&Me(e,o,a[o]);if(re)for(var o of re(a))Be.call(a,o)&&Me(e,o,a[o]);return e},H=(e,a)=>Ft(e,Ot(a));var Z=(e,a)=>{var o={};for(var i in e)Re.call(e,i)&&a.indexOf(i)<0&&(o[i]=e[i]);if(e!=null&&re)for(var i of re(e))a.indexOf(i)<0&&Be.call(e,i)&&(o[i]=e[i]);return o};import{bd as vt,bc as xt,a8 as ie,bf as K,bh as X,dW as kt,bi as $e,dX as Lt,dY as Ut,r as f,bk as Mt,bl as Rt,bp as q,a1 as Bt,bo as $t,by as De,R as t,dZ as Pt,aS as tt,bR as Ht,d_ as Qt,ai as Gt,ch as V,d$ as zt,e0 as Vt,e1 as Wt,cG as jt,e2 as qt,e3 as we,e4 as Pe,cV as B,cH as Kt,cl as Xt,aJ as h,cs as Yt,aj as U,cc as Jt,cd as v,cR as ye,e5 as Zt,e6 as ea,e7 as ta,aG as Fe,e8 as at,cz as aa,cA as Oe,e9 as ot,ea as oa,aK as te,bj as it,eb as ia,d3 as de,ct as na,dd as nt,ab as st,cU as me,ec as sa,ed as ra,cq as pe,ee as ca,ef as la,eg as ua,eh as da,ei as ma,ej as pa,ek as rt,el as fa,em as ct,en as ga,eo as ha,ep as Sa,eq as ee,cW as Ea,b8 as _a,er as Ta,c$ as ae,es as fe,db as Na,cK as ce,et as Ca,cu as He,d1 as Qe,dc as Ee,dj as O,ak as Ia,eu as ba,cT as ya,cS as Ge,dt as _e,aH as Aa,ev as Da,ew as wa,de as ze,cX as lt,ex as Fa,cM as Oa,cv as va,b as ut,d0 as Ae,d2 as xa,d5 as ka,ey as La,ez as Ua,d9 as Ma,bb as Ra}from"./index.7daee9ef.js";import{b as Q,k as dt,l as Te,u as M,m as Ba,n as $a,o as Ne,p as Pa,q as mt,r as Y,s as Ha,t as Ve,I as Qa,v as Ga,w as za,x as Va,B as Wa,y as ja,E as qa,z as ve,A as Ka,D as Xa,c as oe,N as Ya,F as Ja,G as Za,e as We,f as eo,H as to,h as ao,j as oo,J as je,L as pt,d as ge,C as io,i as no,g as so,M as Ce}from"./useNotificationUserRead.372fec74.js";import{T as ro,g as he}from"./TimePickerAutocompleteHF.e331d49c.js";import{I as co}from"./IconButtonBase.a835a6a3.js";import{U as lo}from"./UploadInput.4c4e4115.js";import{T as uo}from"./ToggleButtonGroupBase.1fda97a3.js";import"./_baseMap.9313eb6b.js";import"./_baseFor.4cbad8e1.js";import"./Draft.ec2d3075.js";import"./useMutationV2.0883e427.js";function mo(e){return xt("MuiSwitch",e)}const po=vt("MuiSwitch",["root","edgeStart","edgeEnd","switchBase","colorPrimary","colorSecondary","sizeSmall","sizeMedium","checked","disabled","input","thumb","track"]);var k=po;const fo=["className","color","edge","size","sx"],go=e=>{const{classes:a,edge:o,size:i,color:c,checked:n,disabled:s}=e,l={root:["root",o&&`edge${K(o)}`,`size${K(i)}`],switchBase:["switchBase",`color${K(c)}`,n&&"checked",s&&"disabled"],thumb:["thumb"],track:["track"],input:["input"]},r=$t(l,mo,a);return X({},a,r)},ho=ie("span",{name:"MuiSwitch",slot:"Root",overridesResolver:(e,a)=>{const{ownerState:o}=e;return[a.root,o.edge&&a[`edge${K(o.edge)}`],a[`size${K(o.size)}`]]}})(({ownerState:e})=>X({display:"inline-flex",width:34+12*2,height:14+12*2,overflow:"hidden",padding:12,boxSizing:"border-box",position:"relative",flexShrink:0,zIndex:0,verticalAlign:"middle","@media print":{colorAdjust:"exact"}},e.edge==="start"&&{marginLeft:-8},e.edge==="end"&&{marginRight:-8},e.size==="small"&&{width:40,height:24,padding:7,[`& .${k.thumb}`]:{width:16,height:16},[`& .${k.switchBase}`]:{padding:4,[`&.${k.checked}`]:{transform:"translateX(16px)"}}})),So=ie(kt,{name:"MuiSwitch",slot:"SwitchBase",overridesResolver:(e,a)=>{const{ownerState:o}=e;return[a.switchBase,{[`& .${k.input}`]:a.input},o.color!=="default"&&a[`color${K(o.color)}`]]}})(({theme:e})=>({position:"absolute",top:0,left:0,zIndex:1,color:e.palette.mode==="light"?e.palette.common.white:e.palette.grey[300],transition:e.transitions.create(["left","transform"],{duration:e.transitions.duration.shortest}),[`&.${k.checked}`]:{transform:"translateX(20px)"},[`&.${k.disabled}`]:{color:e.palette.mode==="light"?e.palette.grey[100]:e.palette.grey[600]},[`&.${k.checked} + .${k.track}`]:{opacity:.5},[`&.${k.disabled} + .${k.track}`]:{opacity:e.palette.mode==="light"?.12:.2},[`& .${k.input}`]:{left:"-100%",width:"300%"}}),({theme:e,ownerState:a})=>X({"&:hover":{backgroundColor:$e(e.palette.action.active,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},a.color!=="default"&&{[`&.${k.checked}`]:{color:e.palette[a.color].main,"&:hover":{backgroundColor:$e(e.palette[a.color].main,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${k.disabled}`]:{color:e.palette.mode==="light"?Lt(e.palette[a.color].main,.62):Ut(e.palette[a.color].main,.55)}},[`&.${k.checked} + .${k.track}`]:{backgroundColor:e.palette[a.color].main}})),Eo=ie("span",{name:"MuiSwitch",slot:"Track",overridesResolver:(e,a)=>a.track})(({theme:e})=>({height:"100%",width:"100%",borderRadius:14/2,zIndex:-1,transition:e.transitions.create(["opacity","background-color"],{duration:e.transitions.duration.shortest}),backgroundColor:e.palette.mode==="light"?e.palette.common.black:e.palette.common.white,opacity:e.palette.mode==="light"?.38:.3})),_o=ie("span",{name:"MuiSwitch",slot:"Thumb",overridesResolver:(e,a)=>a.thumb})(({theme:e})=>({boxShadow:e.shadows[1],backgroundColor:"currentColor",width:20,height:20,borderRadius:"50%"})),To=f.exports.forwardRef(function(a,o){const i=Mt({props:a,name:"MuiSwitch"}),{className:c,color:n="primary",edge:s=!1,size:l="medium",sx:r}=i,u=Rt(i,fo),d=X({},i,{color:n,edge:s,size:l}),m=go(d),p=q.exports.jsx(_o,{className:m.thumb,ownerState:d});return q.exports.jsxs(ho,{className:Bt(m.root,c),sx:r,ownerState:d,children:[q.exports.jsx(So,X({type:"checkbox",icon:p,checkedIcon:p,ref:o,ownerState:d},u,{classes:X({},m,{root:m.switchBase})})),q.exports.jsx(Eo,{className:m.track,ownerState:d})]})});var No=To,Co=De(q.exports.jsx("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM14 13v4h-4v-4H7l5-5 5 5h-3z"}),"CloudUpload"),Io=De(q.exports.jsx("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM8 9h8v10H8V9zm7.5-5-1-1h-5l-1 1H5v2h14V4h-3.5z"}),"DeleteOutlineOutlined"),bo=De(q.exports.jsx("path",{d:"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"}),"InsertLink");const yo=e=>t.createElement(Pt,H(b({optionImage:"avatar",optionLabelKey:"name",optionHelperText:"email"},e),{resource:tt.STUDENTS,"data-testid":"StudentsAutocompleteHF__autocomplete",id:"StudentsAutocompleteHF__autocomplete"}));var Ao=f.exports.memo(yo),ft=(e=>(e.asc="asc",e.ASC="ASC",e.desc="desc",e.DESC="DESC",e))(ft||{}),Do=Ht,wo=Qt;function Fo(e,a){return e&&e.length?wo(e,Do(a,2)):[]}var gt=Fo;function Oo(e,a){const o=e[0];return o?a?[o]:o:a?[]:null}function vo(e,a){return!(a&&Array.isArray(e)?e.length:e)}function xo({searchFields:e,optionHelperText:a,optionLabelKey:o,inputVal:i,filterFields:c}){let s=Pe({},a||o,i);return B(e)&&(e==null||e.forEach(l=>{s=Pe(s,l,i)})),c&&Object.keys(c).length&&(s=b(b({},s),c)),s}const ko=({optionLabelKey:e="name",resource:a,optionHelperText:o,firstOptions:i=[],multiple:c=!0,name:n,setDefaultValue:s,searchFields:l,limitChipText:r,filterFields:u,getOptionSelectedField:d})=>{const[m,p]=f.exports.useState(""),[g,T]=f.exports.useState([]),[N,y]=Gt(!0),_=Q(),{setValue:S,formState:{isDirty:I},clearErrors:A,setError:w}=V(),L=f.exports.useMemo(()=>zt(p,Vt),[p]),z=Kt(),R=f.exports.useRef(!1);Wt(()=>{R.current=!0});const W=f.exports.useMemo(()=>xo({searchFields:l,optionLabelKey:e,optionHelperText:o,inputVal:m,filterFields:u}),[u,m,o,e,l]);f.exports.useEffect(()=>{(async()=>{var F;try{A(n),y(!0);const{data:x=[]}=await z(jt.MANY_REFERENCE,a,{target:"target_id",id:"id",filter:W,pagination:{perPage:30,page:1},sort:{order:ft.DESC,field:"created_at"}});if(!x||!x.length||!Array.isArray(x))return;const E=x.map(C=>b({value:qt(C,e,r==="Ellipsis")},C));R.current||T(E)}catch(x){(F=window.warner)==null||F.log("useAutocompleteReference",x),R.current||w(n,{type:"manual",message:_("ra.message.unableToLoadData")})}finally{R.current||y(!1)}})()},[_,A,m,e,z,a,o,y,w,n,JSON.stringify(W)]);const D=f.exports.useMemo(()=>gt([...i,...g],d),[i,g,d]),G=f.exports.useMemo(()=>Oo(D,c),[D,c]),$=we({defaultValue:G,name:n});return f.exports.useEffect(()=>{!(vo($,c)&&n&&G&&s&&!I)||R.current||S(n,G,{shouldValidate:!0,shouldDirty:!1})},[G,s,c,n,S,$,I]),{loading:N,options:D,setInputVal:L,defaultValue:G}},Lo=T=>{var N=T,{optionLabelKey:e="name",resource:a,optionHelperText:o,firstOptions:i=[],multiple:c=!0,name:n,rules:s,setDefaultValue:l,searchFields:r,limitChipText:u,filterFields:d,onInputChange:m,getOptionSelectedField:p}=N,g=Z(N,["optionLabelKey","resource","optionHelperText","firstOptions","multiple","name","rules","setDefaultValue","searchFields","limitChipText","filterFields","onInputChange","getOptionSelectedField"]);const{options:y,setInputVal:_,loading:S}=ko({optionHelperText:o,optionLabelKey:e,firstOptions:i,resource:a,name:n,multiple:c,setDefaultValue:l,searchFields:r,limitChipText:u,filterFields:d,getOptionSelectedField:p});return t.createElement(Xt,H(b({"data-testid":"AutocompleteReferenceHF",getOptionSelectedField:p},g),{limitChipText:u,name:n,multiple:c,loading:S,optionHelperText:o,optionLabelKey:e,options:y,onInputChange:(I,A,w)=>{_(A),m&&m(I,A,w)},rules:s,filterOptions:I=>I,filterSelectedOptions:!0}))},Uo=e=>t.createElement(Lo,b({},e)),Mo=e=>t.createElement(Uo,H(b({id:"CoursesAutocompleteHF__autocomplete","data-testid":"CoursesAutocompleteHF__autocomplete"},e),{resource:tt.COURSES})),ht=({dateFieldProps:e,timeFieldProps:a,rateOfLayout:o={datePicker:6,timePicker:4}})=>t.createElement(h,{item:!0,container:!0,spacing:1},t.createElement(h,{item:!0,xs:o.datePicker},t.createElement(Yt,b({},e))),t.createElement(h,{item:!0,xs:o.timePicker},t.createElement(U,{minWidth:130},t.createElement(ro,b({},a))))),qe=10240,Ke=255,St=10,Et=2,Ro=10,Xe=4e3,Ye=4e3,Bo=Jt(dt,"questionType",v.NOTIFICATIONS),_t=e=>t.createElement(co,b({"data-testid":"IconButtonDelete__root"},e),t.createElement(Io,null)),xe=()=>{const e=Q(),a=M(v.NOTIFICATIONS);return{questionContent:{validate:o=>{if(!ye(o).trim())return e("resources.input.error.required");if(o.length>Xe)return e("resources.input.error.limitLength",{field:a("label.question"),length:Xe})}},answerContent:o=>({validate:i=>{const c=ye(i).trim();if(!c)return e("resources.input.error.required");if(c.length>Ye)return e("resources.input.error.limitLength",{field:a("label.placeholder.answer"),length:Ye});const n=o.filter(s=>s.content.trim()===c).length>1;if(c&&n)return e("resources.input.error.duplicatedAnswer")}}),expirationDate:({isSchedule:o,scheduleDate:i})=>({validate:c=>{const n=Te(o,i);if(n&&Zt(n,c))return e("resources.input.error.invalidExpirationDate")}}),expirationTime:({isSchedule:o,expirationDate:i,scheduleTime:c,scheduleDate:n})=>({validate:s=>{const l=Te(o,n),r=Te(o,c==null?void 0:c.value);if(!!(l&&i&&r&&s.value)&&ea(l,i)&&ta(r,s.value))return e("resources.input.error.invalidExpirationTime")}})}},$o=({questionIndex:e,answerIndex:a,onDeleteAnswer:o,shouldDisableRemoveAnswer:i})=>{const c=M(v.NOTIFICATIONS),{getValues:n}=V(),s=xe();return t.createElement(h,{"data-testid":"AnswerItem__root",item:!0,display:"flex"},t.createElement(Fe,{inputProps:{"data-testid":"AnswerItem__inputAnswer"},name:`questionFieldArrayItem.${e}.answerFieldArrayItem.${a}.content`,placeholder:c("label.placeholder.answer"),rules:s.answerContent(n(`questionFieldArrayItem.${e}.answerFieldArrayItem`))}),t.createElement(U,{ml:2},t.createElement(_t,{color:"error",onClick:()=>o(a),"data-testid":"AnswerItem__buttonDeleteAnswer",disabled:i})))},Po=({questionIndex:e,minimumAnswers:a=Et,maximumAnswers:o=St})=>{const i=M(v.NOTIFICATIONS),{control:c}=V(),{fields:n,append:s,remove:l}=at({control:c,name:`questionFieldArrayItem.${e}.answerFieldArrayItem`}),r=Ba(n.length,a),u=$a(n.length,o);return t.createElement(h,{item:!0,container:!0,spacing:1,xs:12,"data-testid":"DynamicAnswerSection__root"},t.createElement(h,{item:!0,container:!0,spacing:2,direction:"column"},B(n)&&n.map((d,m)=>t.createElement($o,{key:d.id,questionIndex:e,answerIndex:m,onDeleteAnswer:l,shouldDisableRemoveAnswer:r}))),!u&&t.createElement(h,{item:!0},t.createElement(aa,{"data-testid":"DynamicAnswerSection__buttonAddAnswer",startIcon:t.createElement(Oe,null),onClick:()=>s({})},i("button.addAnswer"))))},Ho=e=>t.createElement(No,b({},e)),ke=n=>{var s=n,{name:e,switchProps:a,defaultChecked:o=!1,onChange:i}=s,c=Z(s,["name","switchProps","defaultChecked","onChange"]);const{control:l}=V();return t.createElement(ot,{name:e,control:l,defaultValue:o,render:({field:{onChange:r,value:u}})=>t.createElement(oa,H(b({checked:u,control:t.createElement(Ho,b({color:"primary","data-testid":"SwitchLabelHF__switchBase",onChange:(d,m)=>{r(d),i&&i(d,m)}},a))},c),{label:t.createElement(te,{"data-testid":"SwitchLabelHF__label",variant:"body2"},c.label)}))})},Qo=({questionIndex:e,onDeleteQuestion:a,minimumAnswers:o,maximumAnswers:i})=>{const[c,n]=f.exports.useState(!0),s=it(),l=M(v.NOTIFICATIONS),r=Q(),u=xe(),d=f.exports.useMemo(()=>Bo.map(g=>({id:g.id,value:r(g.value)})),[r]),{setValue:m}=V(),p=g=>{const T=g.target.value,N=Pa(T),y=T==="QUESTION_TYPE_FREE_TEXT"?[]:mt(o);m(`questionFieldArrayItem.${e}.answerFieldArrayItem`,y),n(!N)};return t.createElement(ia,{"data-testid":"QuestionSection__root"},t.createElement(U,{px:2,py:1,borderBottom:`1px solid ${s.palette.grey[200]}`},t.createElement(h,{container:!0,alignItems:"center",justifyContent:"space-between"},t.createElement(h,{item:!0},t.createElement(de,{maxLength:30,"data-testid":"QuestionSection__questionTitle"},`${l("label.question")} ${e+1}`)),t.createElement(h,{item:!0},t.createElement(_t,{color:"error",onClick:a,"data-testid":"QuestionSection__buttonDeleteQuestion"})))),t.createElement(U,{px:2,py:2},t.createElement(h,{container:!0,spacing:2},t.createElement(h,{item:!0,xs:12},t.createElement(Fe,{inputProps:{"data-testid":"QuestionSection__inputQuestion"},name:`${Ne(e)}.content`,placeholder:l("label.placeholder.question"),rules:u.questionContent})),t.createElement(h,{item:!0,xs:12},t.createElement(ke,{"data-testid":"QuestionSection__switchRequiredQuestion",label:l("label.requiredQuestion"),name:`${Ne(e)}.isRequiredQuestion`})),t.createElement(h,{item:!0,xs:6},t.createElement(na,{"data-testid":"QuestionSection__selectQuestionType",name:`${Ne(e)}.questionType`,label:l("label.questionType"),options:d,onChange:p})),c&&t.createElement(Po,{questionIndex:e,minimumAnswers:o,maximumAnswers:i}))))},Go=({maximumQuestions:e=Ro,minimumAnswers:a=Et,maximumAnswers:o=St})=>{const i=M(v.NOTIFICATIONS),{fields:c,append:n,remove:s}=at({name:"questionFieldArrayItem"}),[l,r,u,d]=we({name:["status","scheduleDate","scheduleTime","expirationDate"]}),m=xe();return t.createElement(h,{container:!0,spacing:2,"data-testid":"DynamicQuestionSection__root"},B(c)&&t.createElement(t.Fragment,null,t.createElement(h,{item:!0,container:!0,xs:12,spacing:2,justifyContent:"space-between"},t.createElement(h,{item:!0,xs:6},t.createElement(ht,{dateFieldProps:{disablePast:!0,name:"expirationDate",toolbarTitle:i("label.notificationDate"),InputProps:{"data-testid":"DynamicQuestionSection__datePickerExpiration"},label:i("label.expirationDate"),rules:m.expirationDate({isSchedule:Y(l),scheduleDate:r})},timeFieldProps:{name:"expirationTime",placeholder:i("label.placeholder.selectTime"),getOptionSelectedField:"value",label:i("label.expirationTime"),rules:m.expirationTime({isSchedule:Y(l),scheduleDate:r,expirationDate:d,scheduleTime:u}),"data-testid":"DynamicQuestionSection__timePickerExpiration"},rateOfLayout:{datePicker:6,timePicker:6}})),t.createElement(ke,{"data-testid":"DynamicQuestionSection__switchAllowResubmission",label:i("label.allowResubmission"),disableMarginRight:!0,name:"isAllowResubmission"})),c.map((p,g)=>t.createElement(h,{item:!0,xs:12,key:p.id,"data-testid":"DynamicQuestionSection__questionSection"},t.createElement(Qo,{questionIndex:g,onDeleteQuestion:()=>s(g),minimumAnswers:a,maximumAnswers:o})))),c.length<e&&t.createElement(h,{item:!0,xs:12},t.createElement(nt,{"data-testid":"DynamicQuestionSection__addQuestionButton",startIcon:t.createElement(Oe,null),fullWidth:!0,onClick:()=>n({questionType:dt.QUESTION_TYPE_MULTIPLE_CHOICE,answerFieldArrayItem:mt(a),order:c.length})},i("button.addQuestion"))))},Je="http://",zo="https://",Ie=e=>e.startsWith(Je)||e.startsWith(zo)?e:st.forURL(Je+e),Vo=e=>{const a=e.getSelection(),o=a.getAnchorKey(),c=e.getCurrentContent().getBlockForKey(o),n=a.getStartOffset(),s=a.getEndOffset();return c.getText().slice(n,s)},Wo=e=>{const{editorState:a,onChange:o}=e,i=M(v.NOTIFICATIONS),[c,n]=f.exports.useState(""),s=f.exports.useCallback((p,g)=>{p==null||p.preventDefault();const N=a.getCurrentContent().createEntity("LINK","MUTABLE",{url:st.forURL(g||Ie(c))}),y=N.getLastCreatedEntityKey(),_=me.EditorState.set(a,{currentContent:N});o(me.RichUtils.toggleLink(_,_.getSelection(),y)),n(Ie(c)),d()},[a,c,o]),l=p=>{let g=Vo(a);if(ca(g)){let N=Ie(g);n(N),s(void 0,N);return}if(p.preventDefault(),!a.getSelection().isCollapsed()){const N=a.getCurrentContent(),y=a.getSelection().getStartKey(),_=a.getSelection().getStartOffset(),I=N.getBlockForKey(y).getEntityAt(_);let A="";I&&(A=N.getEntity(I).getData().url),n(A),u(p.currentTarget)}},[r,u]=f.exports.useState(null),d=()=>{u(null)},m=p=>{p.key==="Enter"&&c.length&&s()};return t.createElement(U,null,t.createElement(Ha,{tooltip:i("insertLink"),onClick:l,active:!1},t.createElement(bo,null)),t.createElement(sa,{open:Boolean(r),anchorEl:r,onClose:d,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"}},t.createElement(U,{display:"flex",p:2,width:400},t.createElement(ra,{"data-testid":"Editor__inputInlineLink",variant:"outlined",label:"Insert Link",size:"small",autoFocus:!0,fullWidth:!0,value:c,onChange:p=>{n(p.target.value)},onKeyPress:m,inputProps:{style:{fontSize:12}}}),t.createElement(pe,{"data-testid":"Editor__buttonAddInlineLink",style:{borderTopLeftRadius:0,borderBottomLeftRadius:0},onClick:s},i("button.addInlineLink")))))},jo="EditorHF",Tt={notifyHF:`${jo}-notifyHF`},qo=ie(la)(()=>({[`& .${Tt.notifyHF}`]:{height:130,overflowY:"auto"}})),Ko={[Ve.INLINE]:[Qa,Ga,za,Va,Wo],[Ve.BLOCK]:[Wa,ja]},Xo=({rules:e,defaultValue:a,name:o,selector:i,placeholder:c})=>{const{control:n,formState:{errors:s}}=V();return t.createElement(qo,{variant:"outlined",fullWidth:!0,"data-js":i},t.createElement(ot,{control:n,name:o,defaultValue:a,rules:e,render:({field:{onChange:l,value:r}})=>t.createElement(qa,{error:!!(s&&s[o]),toolbar:Ko,onChange:l,editorState:r,editorClassName:{wrapperDraft:Tt.notifyHF},placeholder:c})}),s&&s[o]&&t.createElement(ua,{variant:"standard",error:!0},s[o].message))},Yo=e=>{const a=ve(),o=Q(),i=f.exports.useCallback(l=>{l.map(({file:r})=>{const{size:u,unit:d}=ct(e);a(o("ra.manabie-error.uploadedFileIsInvalid",{fileType:da(b(b(b(b({},ma),pa),rt),fa),r.type),fileMaxSize:u,fileUnit:d}),"error")})},[a,o,e]),c=f.exports.useCallback(l=>{i(l)},[i]),{isLoading:n,mutate:s}=Ka({entity:"mediaBob",action:"communicationFilterAndUploadFiles"})({onError:l=>{var r;(r=window.warner)==null||r.warn("useUploadFiles media upload",l.message),a(`${o("ra.manabie-error.cannotUpload")}: ${l.message}`,"error")}});return{onUploadFiles:s,onDropRejected:c,isUploading:n}},Jo=({isSubmittingForm:e=!1,multiple:a=!1,maxSize:o=ga})=>{const[i,c]=f.exports.useState(!1),{setValue:n,control:s}=V(),{onUploadFiles:l,isUploading:r}=Yo(),u=Q(),d=M(v.NOTIFICATIONS),m=we({name:"mediaIds",control:s}),{mediaList:p,isFetchingMediaList:g}=Xa({mediaIds:m}),{size:T,unit:N}=ct(o),y=f.exports.useCallback(I=>{const A=ha(m,I);n("mediaIds",A,{shouldDirty:!0})},[m,n]),_=f.exports.useCallback(I=>{!I||!I.length||l(I,{onSuccess:({mediaIds:A})=>{const w=Sa(m,A);n("mediaIds",w,{shouldDirty:!0})}})},[l,m,n]),S=f.exports.useMemo(()=>g?t.createElement(ee,{height:64,width:"100px"}):m&&B(m)?t.createElement(Ea,{medias:p,onDelete:e?void 0:y,shouldConfirmDelete:!1}):t.createElement(nt,{isLoading:r,disabled:r||e,size:"small","data-testid":"NotificationUpsertForm__buttonUpload",startIcon:t.createElement(Co,{fontSize:"small"}),onClick:()=>c(!0)},u(r?"resources.input.uploading":"ra.common.action.upload")),[g,p,m,r,e,u,y]);return t.createElement(U,{px:2,pt:1},S,t.createElement(_a,{open:i,onClose:()=>c(!1),title:d("label.uploadYourFile"),maxWidth:"md",minWidthBox:"sm",footer:"empty"},t.createElement(lo,{"data-testid":"NotificationUpsertForm__uploadInputContainer",multiple:a,maxSize:o,description:u("ra.message.maxFileSizeIs",{fileSize:T,fileUnit:N}),accept:[rt.PDF],onChange:(I,A)=>{_(I),c(!1)}})))},Zo=e=>{const a=Q(),o=M(v.NOTIFICATIONS),{getValues:i}=V(),c=()=>{const{courses:n,grades:s,students:l}=i();if(e!=null&&e.current)return!(n!=null&&n.length)&&!(s!=null&&s.length)&&!(l!=null&&l.length)};return{title:{validate:n=>{const s=ye(n).trim();if(!s)return a("resources.input.error.required");if(s.length>Ke)return a("resources.input.error.limitLength",{field:o("label.title"),length:Ke})}},content:{validate:n=>{if(Ta(n.getCurrentContent()))return a("resources.input.error.required");if((n==null?void 0:n.getCurrentContent().getPlainText("").length)>qe)return a("resources.input.error.limitLength",{field:o("label.content"),length:qe})}},courses:{validate:()=>{if(c())return a("resources.input.error.required")}},grades:{validate:()=>{if(c())return a("resources.input.error.required")}},students:{validate:()=>{if(c())return a("resources.input.error.required")}},scheduleTime:{validate:n=>{if(!n)return a("resources.input.error.required")}}}},le={scheduleRow:e=>({marginBottom:e.spacing(1)}),dividerSpacing:e=>({marginTop:e.spacing(1),marginBottom:e.spacing(1)})},ei=e=>{const{isEnabled:a}=oe(ae.NOTIFICATION_QUESTIONNAIRE),{isEnabled:o}=oe(ae.NOTIFICATION_SCHEDULE_MANAGEMENT),{getValues:i}=V(),{isSubmittingForm:c,shouldValidateFullForm:n,shouldEnableScheduleMode:s,setEnableScheduleMode:l}=e,r=M(v.NOTIFICATIONS),u=Zo(n),d=(p,g)=>{l(g===O.NOTIFICATION_STATUS_SCHEDULED)},m=f.exports.useCallback(()=>{const p=i("courses"),g=p.map(N=>H(b({},N),{value:N.course_id})),T=fe({firstChoiceLabel:r("label.allCourses"),key:"course_id",keyValue:"name"});return B(p)?gt([T,...g],"course_id"):[T]},[i,r]);return t.createElement(Na,null,t.createElement(h,{container:!0,direction:"column",spacing:2,mb:1,"data-testid":"NotificationUpsertForm__root"},t.createElement(h,{item:!0},t.createElement(ce,null,r("label.target"))),t.createElement(h,{item:!0},t.createElement(Mo,{rules:u==null?void 0:u.courses,size:"small",name:"courses",disableClearable:!1,disableCloseOnSelect:!0,firstOptions:m(),label:r("label.placeholder.selectCourse"),limitChipText:"Ellipsis",getOptionSelectedField:"course_id"})),t.createElement(h,{item:!0},t.createElement(Ca,{rules:u==null?void 0:u.grades,size:"small","data-testid":"NotificationUpsertForm__grades",name:"grades",multiple:!0,firstOptions:fe({firstChoiceLabel:r("label.allGrades"),keyValue:"name"}),label:r("label.placeholder.selectGrade"),limitChipText:"Ellipsis",getOptionSelectedField:"id"})),t.createElement(h,{item:!0},t.createElement(Ao,{rules:u==null?void 0:u.students,freeSolo:!0,name:"students",disableClearable:!1,size:"small",label:r("label.placeholder.selectIndividualRecipient"),limitChipText:"Ellipsis",getOptionSelectedField:"user_id"})),t.createElement(h,{item:!0},t.createElement(He,{size:"small","data-testid":"NotificationUpsertForm__targetGroup",name:"targetGroup",options:[{id:"",value:r("label.all")},{id:Qe.USER_GROUP_PARENT,value:r("label.parent")},{id:Qe.USER_GROUP_STUDENT,value:r("label.student")}]})),o&&t.createElement(t.Fragment,null,t.createElement(h,{item:!0,sx:le.dividerSpacing},t.createElement(Ee,null)),t.createElement(h,{item:!0},t.createElement(ce,null,r("label.deliveryOption"))),t.createElement(h,{item:!0,container:!0},t.createElement(h,{item:!0},t.createElement(He,{size:"small","data-testid":"NotificationUpsertForm__radioGroupDeliveryDateType",name:"status",onChange:d,options:[{id:O.NOTIFICATION_STATUS_DRAFT,value:r("label.now")},{id:O.NOTIFICATION_STATUS_SCHEDULED,value:r("label.schedule")}]})),t.createElement(h,{item:!0,sx:le.scheduleRow},s&&t.createElement(ht,{dateFieldProps:{disablePast:!0,name:"scheduleDate",toolbarTitle:r("label.notificationDate"),InputProps:{"data-testid":"NotificationUpsertForm__scheduledDate"}},timeFieldProps:{name:"scheduleTime",placeholder:r("label.placeholder.selectTime"),rules:u==null?void 0:u.scheduleTime,getOptionSelectedField:"value"}}))),a&&t.createElement(h,{item:!0},t.createElement(ke,{"data-testid":"NotificationUpsertForm__switchImportantNotification",label:r("label.importantNotification"),name:"isImportantNotification"}))),t.createElement(h,{item:!0,sx:le.dividerSpacing},t.createElement(Ee,null)),t.createElement(h,{item:!0},t.createElement(ce,null,`${r("label.content")} *`)),t.createElement(h,{item:!0},t.createElement(Fe,{inputProps:{"data-testid":"NotificationUpsertForm__inputTitle"},name:"title",rules:u==null?void 0:u.title,placeholder:`${r("label.placeholder.notificationTitle")} *`})),t.createElement(h,{item:!0},t.createElement(Xo,{name:"content",rules:u==null?void 0:u.content,selector:Ya.content,placeholder:`${r("label.placeholder.selectContent")}`})),t.createElement(Jo,{isSubmittingForm:c}),a&&t.createElement(t.Fragment,null,t.createElement(h,{item:!0,sx:le.dividerSpacing},t.createElement(Ee,null)),t.createElement(h,{item:!0},t.createElement(ce,null,r("label.questionnaire"))),t.createElement(h,{item:!0},t.createElement(Go,null)))))},ti=e=>{const{onSaveDraft:a,onSave:o,onSaveSchedule:i,shouldFooterDisabled:c,isCreatingNotification:n,isSendingNotification:s,isSavingScheduleNotification:l,shouldEnableScheduleMode:r}=e,u=Q();return r?t.createElement(pe,{disableRipple:!0,"data-testid":"DialogNotificationButtonGroup__buttonSaveSchedule",onClick:i,disabled:c,isLoading:l},u("ra.common.saveSchedule")):t.createElement(t.Fragment,null,t.createElement(U,{mr:2},t.createElement(Ia,{"data-testid":"DialogNotificationButtonGroup__buttonSaveDraft",disableRipple:!0,onClick:a,disabled:c,isLoading:n},u("ra.common.saveDraft"))),t.createElement(pe,{disableRipple:!0,"data-testid":"DialogNotificationButtonGroup__buttonSend",onClick:o,disabled:c,isLoading:s},u("ra.common.send")))},ai=e=>{const{onDiscard:a,onSave:o,onSaveDraft:i,onSaveSchedule:c,isCreatingNotification:n,isSendingNotification:s,isSavingScheduleNotification:l,shouldEnableScheduleMode:r}=e,u=Q(),d=s||n;return t.createElement(h,{container:!0,"data-testid":"NotificationDialogFooter__actions"},t.createElement(h,{item:!0,xs:6},t.createElement(ba,{startIcon:void 0,disabled:d,onClick:a,"data-testid":"NotificationDialogFooter__buttonDiscard"},u("ra.common.action.discard"))),t.createElement(h,{item:!0,xs:6},t.createElement(U,{display:"flex",justifyContent:"flex-end"},t.createElement(ti,{onSave:o,onSaveDraft:i,onSaveSchedule:c,isSavingScheduleNotification:l,isCreatingNotification:n,isSendingNotification:s,shouldFooterDisabled:d,shouldEnableScheduleMode:r}))))},Nt={courses:[],grades:[],students:[],targetGroup:"",title:"",content:me.EditorState.createEmpty(),mediaIds:[],isAllCourses:!1,isAllGrades:!1,notificationId:"",notificationMsgId:"",scheduleDate:new Date,scheduleTime:he(),status:O.NOTIFICATION_STATUS_DRAFT,expirationDate:Ja(7),expirationTime:he(),isAllowResubmission:!1,isImportantNotification:!1},Ze={formData:Nt,status:O.NOTIFICATION_STATUS_DRAFT},oi=({receivers:e,courses:a,notificationInfo:o,notificationMsgDetail:i,questionnaire:c,questionnaireQuestions:n})=>{const s=M(v.NOTIFICATIONS),l=Q();if(!(o!=null&&o.notification_id)||!i)return Ze;const r=ni({receivers:e,courses:a,notificationInfo:o,questionnaire:c,questionnaireQuestions:n,tCommon:l,tNotification:s}),{content:u,media_ids:d=[],title:m}=i;if(!u||!u.raw)return Ze;let p=[];return B(d)&&(p=d),{formData:H(b({},r),{mediaIds:p,title:m,content:ya(u.raw)||me.EditorState.createEmpty()}),status:o.status}},ii=e=>{const{course_filter:a,grade_filter:o,user_group_filter:i}=e;return{targetGroup:i.user_group.length>1?"":i.user_group[0],isAllCourses:a.type===Ge.NOTIFICATION_TARGET_GROUP_SELECT_ALL,isAllGrades:o.type===Ge.NOTIFICATION_TARGET_GROUP_SELECT_ALL}},ni=({receivers:e,courses:a,notificationInfo:o,questionnaire:i,questionnaireQuestions:c,tCommon:n,tNotification:s})=>{const{target_groups:l,notification_id:r,notification_msg_id:u,scheduled_at:d,is_important:m}=o||{},{grade_filter:p}=l,{isAllCourses:g,isAllGrades:T,targetGroup:N}=ii(l),y=d?new Date(d):void 0;let _={notificationId:r,notificationMsgId:u,grades:T?[fe({firstChoiceLabel:s("label.allGrades"),keyValue:"name"})]:[],courses:g?[fe({firstChoiceLabel:s("label.allCourses"),key:"course_id",keyValue:"name"})]:[],students:[],targetGroup:N,isAllCourses:g,isAllGrades:T,status:(o==null?void 0:o.status)||O.NOTIFICATION_STATUS_DRAFT,scheduleDate:y||new Date,scheduleTime:he(y),isImportantNotification:Boolean(m),expirationDate:i==null?void 0:i.expiration_date,expirationTime:he(i==null?void 0:i.expiration_date),isAllowResubmission:Boolean(i==null?void 0:i.resubmit_allowed),questionFieldArrayItem:Za(c)};return!T&&B(p.grades)&&(_.grades=p.grades.map(S=>({id:S,name:n(`resources.choices.grades.${S}`)}))),!g&&B(a)&&(_.courses=a.map(S=>H(b({},S),{value:S.course_id}))),B(e)&&(_.students=e.map(S=>H(b({},S),{value:S.name}))),_},si=({onClose:e,notificationData:a,notificationCategoriesRefetch:o,readCountOfNotificationsRefetch:i,notificationListRefetch:c,resetPaginationOffset:n})=>{const s=f.exports.useRef(!1),[l,r]=_e(!1),[u,d]=_e(!1),[m,p]=_e(!1),[g,T]=f.exports.useState(Y(a==null?void 0:a.status)),N=l||u||m,{onClose:y,open:_,onOpen:S}=We(),{onClose:I,open:A,onOpen:w}=We(),L=Aa({defaultValues:a!=null?a:Nt}),{handleSubmit:z,getValues:R,control:W}=L,{isDirty:D}=Da({control:W}),G=M(v.NOTIFICATIONS),$=Q(),F=R("notificationId"),x=f.exports.useCallback(()=>{c(),o()},[o,c]),{onDiscard:E,onSend:C,onUpsert:P}=eo(),j=f.exports.useCallback(async J=>{try{r(!0);const Se=H(b({},J),{status:O.NOTIFICATION_STATUS_DRAFT}),{notificationId:se}=await P({data:Se,shouldShowCreateNotificationNotify:!1,onClose:e});await C({data:{notificationId:F||se}})}finally{x(),i(),r(!1),e(),n()}},[P,C,F,x,i,e,n,r]),Le=f.exports.useCallback(async J=>{try{d(!0),p(!0),await P({data:J,shouldShowCreateNotificationNotify:!0,shouldShowEditSuccess:!!F,onClose:e})}finally{x(),i(),d(!1),p(!1),n()}},[P,F,e,x,i,n,d,p]),ne=f.exports.useCallback(J=>async()=>{const Se=H(b({},R()),{content:R("content")}),se=to(Se);J===O.NOTIFICATION_STATUS_SENT?await j(se):await Le(se)},[R,j,Le]),It=async()=>{if(F)try{await E({data:{notificationId:F}})}finally{Ue()}e()},bt=f.exports.useCallback(()=>{if(!!F||D){w();return}e()},[D,F,e,w]),Ue=f.exports.useCallback(()=>{e(),x()},[e,x]),yt=f.exports.useCallback(()=>{if(!!F||D){S();return}e()},[F,e,S,D]),At=f.exports.useCallback(async()=>{s.current=!1,await z(ne(O.NOTIFICATION_STATUS_DRAFT))()},[z,ne]),Dt=f.exports.useMemo(()=>Boolean(F)?G("title.editMessage"):G("title.composeMessage"),[F,G]);return t.createElement(t.Fragment,null,t.createElement(wa,{"data-testid":"NotificationUpsertDialog__dialog",title:Dt,open:!0,onClose:bt,onSave:async()=>{s.current=!0,await z(ne(O.NOTIFICATION_STATUS_SENT))()},methods:L,footer:t.createElement(ai,{isSendingNotification:l,isCreatingNotification:u,isSavingScheduleNotification:m,shouldEnableScheduleMode:g,onSaveDraft:At,onSaveSchedule:async()=>{s.current=!0,await z(ne(O.NOTIFICATION_STATUS_SCHEDULED))()},onDiscard:yt})},t.createElement(ei,{shouldValidateFullForm:s,isSubmittingForm:N,setEnableScheduleMode:T,shouldEnableScheduleMode:g})),t.createElement(ze,{"data-testid":"NotificationUpsertDialog__dialogDiscardConfirm",textCancelDialog:$("ra.common.areYouSureWantToDiscardThisMessage"),title:$("ra.common.discardMessage"),textSave:$("ra.common.action.discard"),open:_,onClose:y,onSave:It}),t.createElement(ze,{"data-testid":"NotificationUpsertDialog__dialogDisposeConfirm",textCancelDialog:$("ra.common.areYouSureWantToExitThisForm"),title:$("ra.common.disposeNotification"),textSave:$("ra.common.action.dispose"),open:A,onClose:I,onSave:Ue}))};var Ct=f.exports.memo(si);const ri=e=>{const{status:a,readUsers:o=0,allReceiverUsers:i=0}=e,c=it(),{primary:n}=c.palette.text;if(a===O.NOTIFICATION_STATUS_SENT){const s=o===i,l=s?"body2":"subtitle2",r=s?n:c.palette.warning.main;return t.createElement(U,{color:r,"data-testid":"ReadCountColumn__box"},t.createElement(te,{variant:l},`${o}/${i}`))}return t.createElement(U,{color:n,"data-testid":"ReadCountColumn__box"},t.createElement(te,{variant:"body2"},t.createElement(lt,null)))};var ci=f.exports.memo(ri);const li=({onClose:e,selectedNotificationID:a,notificationCategoriesRefetch:o,readCountOfNotificationsRefetch:i,notificationListRefetch:c,resetPaginationOffset:n})=>{const{notificationInfo:s,courses:l,receivers:r,questionnaire:u,questionnaireQuestions:d,isFetching:m}=ao(a),{notificationMsgDetail:p,isFetching:g}=oo((s==null?void 0:s.notification_msg_id)||void 0),{formData:T}=oi({receivers:r,courses:l,notificationInfo:s,notificationMsgDetail:p,questionnaire:u,questionnaireQuestions:d});return m||g?t.createElement(Fa,{open:!0}):t.createElement(Ct,{notificationData:T,onClose:e,notificationCategoriesRefetch:o,notificationListRefetch:c,readCountOfNotificationsRefetch:i,resetPaginationOffset:n})};var ui=f.exports.memo(li);const et=e=>{const l=e,{status:a,date:o,format:i="yyyy/LL/dd, HH:mm"}=l,c=Z(l,["status","date","format"]),n=M(v.NOTIFICATIONS),s=(r,u)=>u===O.NOTIFICATION_STATUS_SCHEDULED?n("notificationStatus.NOTIFICATION_STATUS_SCHEDULED"):r&&Oa.fromJSDate(new Date(r)).isValid?va(r,i):t.createElement(lt,null);return t.createElement(te,b({"data-testid":"TypographyNotificationDate__root",variant:"body2"},c),s(o,a))},di=(e,a)=>{switch(a){case O.NOTIFICATION_STATUS_DRAFT:return e.draft;case O.NOTIFICATION_STATUS_SENT:return e.sent;case O.NOTIFICATION_STATUS_SCHEDULED:return e.schedule;default:return e.all}},mi=(e,a)=>{let o=0,i=0;if(!e.notification_id||!B(a))return{allReceiverUsers:o,readUsers:i};const c=a.find(n=>n.notification_id===e.notification_id);if(c){const{all_receiver_aggregate:n,read_aggregate:s}=c;n&&n.aggregate&&n.aggregate.count&&(o=n.aggregate.count),s&&s.aggregate&&s.aggregate.count&&(i=s.aggregate.count)}return{allReceiverUsers:o,readUsers:i}},pi=({notificationListHookData:e,notificationCategoriesHookData:a,notificationCategory:o})=>{const{pagination:i,notificationInfoList:c,readCountOfNotifications:n,readCountOfNotificationsLoading:s,notificationListLoading:l,composerList:r,isFetchingComposerList:u,notificationMsgTitles:d,notificationMsgTitlesFetched:m,notificationListRefetch:p,readCountOfNotificationsRefetch:g,resetPaginationOffset:T}=e,{notificationCategories:N,notificationCategoriesLoading:y,notificationCategoriesRefetch:_}=a,[S,I]=f.exports.useState(""),[A,w]=f.exports.useState(!1),L=ve(),z=ut(),{isEnabled:R}=oe(ae.NOTIFICATION_SCHEDULE_MANAGEMENT),W=Q(),D=M(v.NOTIFICATIONS),G=f.exports.useCallback(E=>{const C=E==null?void 0:E.status;if(!C){L(D("message.reloadPage"),"error");return}je(C)&&z.push(`/${Ae.COMMUNICATION}/${v.NOTIFICATIONS}/${S}/show`),(pt(C)||Y(C))&&w(!0)},[z,S,L,D]),{refetch:$}=ge({action:"communicationGetStatusByNotificationId",entity:"infoNotifications"})({notification_id:S},{enabled:Boolean(S),onError:E=>{var C;(C=window.warner)==null||C.warn("NotificationTable component ERROR communicationGetStatusByNotificationId",E),L(W(E.message),"error")},onSuccess:G}),F=f.exports.useCallback((E,C)=>{je(C.status)||(E.preventDefault(),I(C.notification_id),$())},[$]),x=f.exports.useMemo(()=>[{title:D("label.title"),render:E=>{var P;if(!m)return t.createElement(ee,{width:"100%",height:"100%"});if(!d)return null;const C=(P=d.find(j=>j.notification_msg_id===E.notification_msg_id))==null?void 0:P.title;return C?Y(E.status)&&!R?t.createElement(de,{"data-testid":"NotificationTable__titleTypo",variant:"body2",maxLength:24},C):t.createElement(xa,{to:`/${Ae.COMMUNICATION}/${v.NOTIFICATIONS}/${E.notification_id}/show`,"data-testid":"NotificationTable__title",onClick:j=>{F(j,E)}},t.createElement(de,{variant:"body2",maxLength:24,title:C},C)):null},key:"title",cellProps:{style:{width:"20%"}}},{title:D("label.composer"),render:E=>{var P;if(u)return t.createElement(ee,{width:"100%",height:"100%"});if(!r)return null;const C=(P=r.find(j=>j.user_id===E.editor_id))==null?void 0:P.name;return C?t.createElement(de,{maxLength:24,variant:"body2","data-testid":"NotificationList__typographyComposer"},C):null},key:"composer",cellProps:{style:{width:"18%"}}},{title:D("label.audience"),render:E=>{if(E.target_groups&&E.target_groups.user_group_filter&&E.target_groups.user_group_filter.user_group){const C=E.target_groups.user_group_filter.user_group.length===1?String(E.target_groups.user_group_filter.user_group):E.target_groups.user_group_filter.user_group;return t.createElement(te,{variant:"body2","data-testid":"NotificationTable__recipient"},C&&typeof C=="string"?W(`resources.choices.user_group.${C}`):D("label.all"))}return t.createElement(t.Fragment,null)},key:"recipient",cellProps:{style:{width:"12%"}}},{title:D("label.status"),render:E=>t.createElement(U,{position:"relative","data-testid":"NotificationTable__status"},t.createElement(io,{status:E.status,label:D(`notificationStatus.${E==null?void 0:E.status}`)})),key:"status",cellProps:{style:{width:"10%"}}},{title:D("label.read"),render:E=>{if(s)return t.createElement(ee,{width:"100%",height:"100%"});const{allReceiverUsers:C,readUsers:P}=mi(E,n);return t.createElement(ci,{status:E.status,allReceiverUsers:C,readUsers:P})},key:"read",cellProps:{style:{width:"7%"}}},{key:"sentDate",title:D("label.sentDate"),render:E=>E.status?t.createElement(et,{"data-testid":"NotificationTable__sentDate",date:E.sent_at,status:E.status}):null,cellProps:{style:{width:"15%"}}},{title:D("label.lastUpdated"),render:E=>t.createElement(et,{"data-testid":"NotificationTable__lastUpdated",date:E.updated_at}),key:"lastUpdated",cellProps:{style:{width:"15%"}}}],[r,u,R,d,m,F,n,s,W,D]);return t.createElement(t.Fragment,null,t.createElement(ka,{data:c,columns:x,footer:{pagination:H(b({},i),{count:di(N,o)})},withIndex:!0,tableProps:{"data-testid":"Notification__table"},body:{rowKey:"notification_id",loading:l||y,pagination:i},styles:{container:{overflowX:"unset"}}}),A&&t.createElement(ui,{selectedNotificationID:S,onClose:()=>w(!1),notificationCategoriesRefetch:_,notificationListRefetch:p,readCountOfNotificationsRefetch:g,resetPaginationOffset:T}))},be={all:0,draft:0,sent:0,schedule:0},fi=(e=!1)=>{const{isEnabled:a}=oe(ae.NOTIFICATION_SCHEDULE_MANAGEMENT),o=Q(),i=ve(),{refetch:c,data:n,isLoading:s}=ge({entity:"infoNotifications",action:"communicationCountNotificationStatus"})(void 0,{enabled:!Boolean(e),selector:l=>{if(!l)return be;const r=be;return Object.keys(l).forEach(u=>{r[u]=l[u].aggregate.count}),r.all=r.draft+r.sent,a&&(r.all+=r.schedule),r},onError:l=>{var r;(r=window.warner)==null||r.warn("useNotificationCategories",l),i(`${o("ra.notification.item_doesnt_exist")} ${l.message}`,"error")}});return{notificationCategoriesRefetch:c,notificationCategories:n!=null?n:be,notificationCategoriesLoading:s}},gi={data:{notificationInfoList:[],notificationIds:[],notificationEditorIds:[],notificationMsgIds:[]},total:0},hi=e=>{const{result:{isLoading:a,refetch:o},data:i=gi,pagination:c,resetPaginationOffset:n}=no({entity:"infoNotifications",action:"communicationGetListOfInfoNotifications"})({status:e},{enabled:!0,selector:({data:_,total:S})=>{const I=new Set,A=new Set,w=new Set;return B(_)&&_.forEach(L=>{I.add(L.notification_id),L.editor_id&&A.add(L.editor_id),L.notification_msg_id&&w.add(L.notification_msg_id)}),{data:{notificationInfoList:_,notificationIds:[...I],notificationEditorIds:[...A],notificationMsgIds:[...w]},total:S}}}),{notificationInfoList:s,notificationIds:l,notificationEditorIds:r,notificationMsgIds:u}=i.data,{readCountOfNotifications:d,readCountOfNotificationsLoading:m,readCountOfNotificationsRefetch:p}=so({notification_id:pt(e)||Y(e)?[]:l}),{data:g,isLoading:T}=ge({entity:"users",action:"communicationGetUsernames"})({user_id:r},{enabled:B(r),onError:_=>{var S;(S=window.warner)==null||S.warn("useNotificationList notification composerList",_)}}),{data:N,isFetched:y}=ge({entity:"infoNotificationMgs",action:"communicationGetTitlesOfNotificationByNotificationMsgId"})({notification_msg_id:u},{enabled:B(u),onError:_=>{var S;(S=window.warner)==null||S.warn("useNotificationList notification notificationMsgTitles",_)}});return{pagination:c,notificationInfoList:s,readCountOfNotifications:d,readCountOfNotificationsLoading:m,notificationListLoading:a,composerList:g,isFetchingComposerList:T,notificationMsgTitles:N,notificationMsgTitlesFetched:y,readCountOfNotificationsRefetch:p,notificationListRefetch:o,resetPaginationOffset:n}},ue="ALL_STATUS",Si=()=>{const{isEnabled:e}=oe(ae.NOTIFICATION_SCHEDULE_MANAGEMENT),[a,o]=f.exports.useState(!1),i=M(v.NOTIFICATIONS),c=ut(),{status:n}=La(),{notificationCategories:s,notificationCategoriesLoading:l,notificationCategoriesRefetch:r}=fi(a),y=hi(Ce(n)),{resetPaginationOffset:u,readCountOfNotificationsRefetch:d,notificationListRefetch:m}=y,p=Z(y,["resetPaginationOffset","readCountOfNotificationsRefetch","notificationListRefetch"]),g=f.exports.useCallback(_=>()=>{const S=_===ue?void 0:Ua({status:_});c.push({pathname:`/${Ae.COMMUNICATION}/${v.NOTIFICATIONS}`,search:S}),u(),r()},[c,u,r]),T=f.exports.useCallback(_=>l?t.createElement(U,{"data-testid":"NotificationList__categorySkeleton"},t.createElement(ee,{animation:"wave",height:22,width:41})):_,[l]),N=f.exports.useMemo(()=>{const _=ue,S=O.NOTIFICATION_STATUS_DRAFT,I=O.NOTIFICATION_STATUS_SENT,A=O.NOTIFICATION_STATUS_SCHEDULED,w=[{children:T(`${i("label.all")} (${s.all})`),value:ue,"data-testid":"NotificationCategory__ALL",onClick:g(_)},{children:T(i(`notificationStatus.${I}`,{smart_count:2,count:s.sent})),value:I,"data-testid":`NotificationCategory__${I}`,onClick:g(I)},{children:T(i(`notificationStatus.${S}`,{smart_count:2,count:s.draft})),value:S,"data-testid":`NotificationCategory__${S}`,onClick:g(S)}];return e&&w.splice(2,0,{children:T(i(`notificationStatus.${A}`,{smart_count:2,count:s.schedule})),value:A,"data-testid":`NotificationCategory__${A}`,onClick:g(A)}),w},[e,s.all,s.draft,s.schedule,s.sent,g,T,i]);return t.createElement(Ma,{"data-testid":"NotificationList"},t.createElement(Ra,{"data-testid":"NotificationList__header",title:i("title.notification")}),t.createElement(U,{mb:2,display:"flex",alignItems:"center",justifyContent:"space-between"},t.createElement(uo,{"data-testid":"NotificationList__buttonGroupCategory",value:Ce(n)||ue,options:N}),t.createElement(pe,{"data-testid":"NotificationList__buttonCompose",startIcon:t.createElement(Oe,null),onClick:()=>{o(!0)}},i("button.compose"))),t.createElement(pi,{notificationCategory:Ce(n),notificationCategoriesHookData:{notificationCategories:s,notificationCategoriesLoading:l,notificationCategoriesRefetch:r},notificationListHookData:b({resetPaginationOffset:u,readCountOfNotificationsRefetch:d,notificationListRefetch:m},p)}),a&&t.createElement(Ct,{onClose:()=>o(!1),notificationCategoriesRefetch:r,notificationListRefetch:m,readCountOfNotificationsRefetch:d,resetPaginationOffset:u}))};var Fi=Si;export{Fi as default};
