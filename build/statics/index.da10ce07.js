var Z=Object.defineProperty,X=Object.defineProperties;var ee=Object.getOwnPropertyDescriptors;var H=Object.getOwnPropertySymbols;var te=Object.prototype.hasOwnProperty,ae=Object.prototype.propertyIsEnumerable;var j=(t,r,e)=>r in t?Z(t,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[r]=e,b=(t,r)=>{for(var e in r||(r={}))te.call(r,e)&&j(t,e,r[e]);if(H)for(var e of H(r))ae.call(r,e)&&j(t,e,r[e]);return t},h=(t,r)=>X(t,ee(r));import{R as a,d5 as re,g7 as k,aS as P,r as i,d2 as G,d0 as W,aK as L,gw as ne,cd as se,gx as oe,gy as J,eh as le,cv as ie,fF as ce,gq as w,dZ as de,cG as ue,gz as me,g6 as V,g8 as z,cV as M,cM as Q,cc as pe,aH as Te,eG as Oe,fO as ge,aI as ye,gA as Ee,aj as U,aJ as y,cs as K,fP as fe,cl as Se,e5 as be,gB as Fe,gC as A,eq as he,d9 as De,bb as Ae,cO as Le}from"./index.7daee9ef.js";import{T as _e}from"./ToggleButtonGroupBase.1fda97a3.js";const Re=()=>{const t=k(P.ORDERS);return i.exports.useMemo(()=>[{key:"orderNumber",title:`${t("column.orderNumber")}.`,render:({orderSequenceNumber:e,orderId:n})=>a.createElement(G,{to:`/${W.PAYMENT}/${P.ORDERS}/${n}/show`},a.createElement(L,{variant:"body2","data-testid":"OrderManagementTable__orderNumber"},ne(e))),cellProps:{style:{width:"11%"}}},{key:"studentName",title:t("column.studentName"),render:({studentId:e,studentName:n})=>a.createElement(G,{to:`/${W.USER}/${se.STUDENTS}/${e}/show`},a.createElement(L,{variant:"body2","data-testid":"OrderManagementTable__studentName"},n)),cellProps:{style:{width:"17%"}}},{key:"orderStatus",title:t("column.orderStatus"),render:({orderStatus:e})=>a.createElement(oe,{"data-testid":"OrderManagementTable__orderStatus",status:e}),cellProps:{style:{width:"12%"}}},{key:"orderType",title:t("column.orderType"),render:({orderType:e})=>a.createElement(L,{variant:"body2","data-testid":"OrderManagementTable__orderType"},t(`choices.orderType.${J[le(w.OrderType,e)]}`)),cellProps:{style:{width:"12%"}}},{key:"productDetails",title:t("column.productDetails"),render:({productDetails:e})=>a.createElement(L,{variant:"body2","data-testid":"OrderManagementTable__product"},e),cellProps:{style:{width:"32%"}}},{key:"createdDate",title:t("column.createdDate"),render:({createDate:e})=>{const n=ie(ce(e),"yyyy/LL/dd");return a.createElement(L,{variant:"body2","data-testid":"OrderManagementTable__createdDate"},n)},cellProps:{style:{width:"11%"}}}],[t])},ve=({dataSource:t,loading:r,pagination:e})=>{const n=Re();return a.createElement(re,{tableProps:{"data-testid":"OrderManagementTable__root"},data:t!=null?t:[],columns:n,withIndex:{width:"5%"},body:{loading:r,rowKey:"id",pagination:e},footer:{pagination:e}})},Pe=t=>{const r=k(P.ORDERS);return a.createElement(de,h(b({id:"ProductAutocompleteHF_autocomplete","data-testid":"ProductAutocompleteHF_autocomplete",label:r("column.product")},t),{providerTypes:ue.MANY_REFERENCE_AUTOCOMPLETE,resource:me.PRODUCTS}))},Ce=t=>{const{isNoData:r,defaultValue:e,filterFieldObjects:n,onApplySubmit:u,reset:o,watch:D,getValues:m,defaultFilterAppliedObjects:F=[],onSetFilterAppliedObjects:l}=t,c=V(),S=z(),[s,T]=i.exports.useState(F),g=D(),E=i.exports.useCallback(()=>{T([]),l&&l([]),o(e),u(e)},[e,u,l,o]),p=i.exports.useCallback(()=>o(g),[g,o]),d=i.exports.useCallback(f=>{const R=Object.keys(n),C=m();return R.map(v=>{const I=C[v],$=Array.isArray(I)?M(I):!!I;if(!f){const Y=s.some(B=>B.name===v&&B.isApplied);return h(b({},n[v]),{isApplied:$&&Y})}return h(b({},n[v]),{isApplied:$})}).filter(v=>v.isApplied)},[s,n,m]),O=i.exports.useCallback(f=>{const R=n[f].defaultValue,C=h(b({},g),{[f]:R});o(C);const x=d(!1);T(x),l&&(l==null||l(x)),u(C)},[n,d,g,u,l,o]),_=i.exports.useCallback(f=>{if(r){s.some(x=>x.isApplied)&&E(),S(c("ra.message.invalidSearchQueryReturningAllItems"),"info");return}const R=d(!0);T(R),l&&(l==null||l(R)),u(f)},[s,d,E,r,u,l,S,c]);return{filterApplied:s,onReset:E,onApply:_,onDelete:O,onClosePopover:p}},q=t=>{if(!t)return null;const r=new Date(t);return Q.fromJSDate(r).isValid?t.toString():null},xe=pe(J,"orderType",P.ORDERS),N={createdFrom:null,createdTo:null,orderTypeList:[],productsList:[]},Me=t=>({createdFrom:{name:"createdFrom",inputLabel:t("filters.createdFrom"),isApplied:!1,defaultValue:null},createdTo:{name:"createdTo",inputLabel:t("filters.createdTo"),isApplied:!1,defaultValue:null},orderTypeList:{name:"orderTypeList",inputLabel:t("filters.orderType"),isApplied:!1,defaultValue:[]},productsList:{name:"productsList",inputLabel:t("filters.product"),isApplied:!1,defaultValue:[]}}),ke=({onEnterSearchBar:t,onApplySubmit:r})=>{const e=V(),n=k(P.ORDERS),u=Te({defaultValues:N}),o=Me(n),D=i.exports.useMemo(()=>xe.map(O=>({id:O.id,value:e(O.value)})),[e]),{getValues:m,handleSubmit:F,setValue:l}=u,c=m(),S=i.exports.useMemo(()=>Oe(N,c),[c]),s=i.exports.useMemo(()=>ge(c.createdFrom),[c.createdFrom]),{filterApplied:T,onReset:g,onDelete:E,onApply:p}=Ce(b({defaultValue:N,isNoData:S,filterFieldObjects:o,onApplySubmit:r},u)),d=O=>{if(!O||!c.createdTo)return;const _=new Date(O.toString());be(_,c.createdTo)&&l("createdTo",_)};return a.createElement(ye,{methods:u},a.createElement(Ee,{onEnterSearchBar:t,isDisableReset:S,filterNameApplied:T,onReset:g,onDelete:E,onApply:F(p),inputSearchPlaceholder:n("enterStudentName")},a.createElement(U,{width:512,"data-testid":"OrderManagementListFormFilterAdvanced__children"},a.createElement(y,{container:!0,spacing:2},a.createElement(y,{item:!0,xs:12},a.createElement(L,{variant:"subtitle2"},n("title.filters"))),a.createElement(y,{item:!0,xs:6},a.createElement(K,{InputProps:{"data-testid":"OrderManagementListFormFilterAdvanced__createdFrom"},name:o.createdFrom.name,label:o.createdFrom.inputLabel,onChange:d})),a.createElement(y,{item:!0,xs:6},a.createElement(K,{InputProps:{"data-testid":"OrderManagementListFormFilterAdvanced__createdTo"},name:o.createdTo.name,label:o.createdTo.inputLabel,shouldDisableDate:O=>fe(O,c.createdFrom,s),minDate:c.createdFrom?Q.fromJSDate(s):void 0})),a.createElement(y,{item:!0,xs:6},a.createElement(Se,{"data-testid":"OrderManagementListFormFilterAdvanced__orderType",name:o.orderTypeList.name,label:o.orderTypeList.inputLabel,optionLabelKey:"value",multiple:!0,options:D,disableCloseOnSelect:!0,filterSelectedOptions:!0,getOptionSelectedField:"id"})),a.createElement(y,{item:!0,xs:12},a.createElement(Pe,{name:o.productsList.name,disableCloseOnSelect:!0,filterSelectedOptions:!0,getOptionSelectedField:"product_id",limitChipText:"Ellipsis"}))))))},we={keyword:"",currentTime:new Date,orderStatus:w.OrderStatus.ORDER_STATUS_ALL},Ve=()=>{const t=V(),r=z(),[e,n]=i.exports.useState(we),{results:{data:u,isFetching:o,refetch:D},goToFirstPage:m,pagination:F}=Fe({entity:"orderPayment",action:"paymentGetListWithFilter"})(e,{enabled:Boolean(e),onError:s=>{var T;(T=window.warner)==null||T.warn("useOrderList",s),r(`${t("ra.message.unableToLoadData")} order - paymentGetListWithFilter`,"error")}}),l=i.exports.useCallback(s=>{!e.orderStatus&&!s||(n(h(b({},e),{orderStatus:s})),m())},[e,m]),c=i.exports.useCallback(s=>{!e.keyword&&!s||(n(h(b({},e),{keyword:s})),m())},[e,m]),S=i.exports.useCallback(s=>{const{createdFrom:T,createdTo:g,orderTypeList:E,productsList:p}=s,d=M(p)?p.map(f=>f.product_id):[],O=M(E)?E.map(f=>w.OrderType[f.id]):[],_={createdFrom:q(T),createdTo:q(g),orderTypesList:O,productIdsList:d};m(),n(h(b({},e),{filter:_}))},[e,m]);return{onSearch:c,onFilter:S,onCategorize:l,pagination:F,keyword:e.keyword,refreshPage:D,isLoadingOrder:o,orders:u}},Ie=()=>{const t=V(),r=k(P.ORDERS),{orders:e,pagination:n,isLoadingOrder:u,onSearch:o,onFilter:D,refreshPage:m,onCategorize:F}=Ve(),l=!u&&!M(e==null?void 0:e.itemsList)?"empty-icon":"result",[c,S]=i.exports.useState(A.ORDER_STATUS_ALL),s=i.exports.useCallback(p=>()=>{p!==c&&(S(p),F(w.OrderStatus[p]),m())},[m,c,F]),T=i.exports.useCallback((p,d)=>typeof d=="undefined"?a.createElement(U,{"data-testid":"OrderManagementList__categorySkeleton"},a.createElement(he,{animation:"wave",height:22,width:41})):a.createElement(L,{variant:"button"},r(`choices.orderStatus.${p}`,{smart_count:2,count:d})),[r]),g=i.exports.useMemo(()=>[{value:A.ORDER_STATUS_ALL,total:e==null?void 0:e.totalItems},{value:A.ORDER_STATUS_SUBMITTED,total:e==null?void 0:e.totalOfSubmitted},{value:A.ORDER_STATUS_PENDING,total:e==null?void 0:e.totalOfPending},{value:A.ORDER_STATUS_REJECTED,total:e==null?void 0:e.totalOfRejected},{value:A.ORDER_STATUS_VOIDED,total:e==null?void 0:e.totalOfVoided},{value:A.ORDER_STATUS_INVOICED,total:e==null?void 0:e.totalOfInvoiced}],[e==null?void 0:e.totalItems,e==null?void 0:e.totalOfInvoiced,e==null?void 0:e.totalOfPending,e==null?void 0:e.totalOfRejected,e==null?void 0:e.totalOfSubmitted,e==null?void 0:e.totalOfVoided]),E=i.exports.useMemo(()=>g.map(({value:d,total:O})=>({value:d,children:T(d,O),onClick:s(d),"data-testid":`OrderStatus__${d}`})),[g,T,s]);return a.createElement(De,{"data-testid":"OrderManagementList"},a.createElement(Ae,{title:r("name")}),a.createElement(y,{container:!0,direction:"column",spacing:2},a.createElement(y,{item:!0,xs:12},a.createElement(ke,{onApplySubmit:D,onEnterSearchBar:o})),a.createElement(y,{item:!0,container:!0,spacing:1},a.createElement(y,{item:!0,xs:12},a.createElement(U,{alignItems:"center"},a.createElement(_e,{value:c,options:E}))),a.createElement(y,{item:!0,xs:12},a.createElement(Le,{height:"page",variant:l,content:t("resources.common.noResult"),helperText:t("resources.common.noResultSearchAndFilter")},a.createElement(ve,{dataSource:e==null?void 0:e.itemsList,loading:u,pagination:n}))))))};var Be=Ie;export{Be as default};
