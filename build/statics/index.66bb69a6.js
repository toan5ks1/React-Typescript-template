var z=Object.defineProperty,Q=Object.defineProperties;var W=Object.getOwnPropertyDescriptors;var v=Object.getOwnPropertySymbols;var R=Object.prototype.hasOwnProperty,F=Object.prototype.propertyIsEnumerable;var P=(e,s,a)=>s in e?z(e,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[s]=a,c=(e,s)=>{for(var a in s||(s={}))R.call(s,a)&&P(e,a,s[a]);if(v)for(var a of v(s))F.call(s,a)&&P(e,a,s[a]);return e},d=(e,s)=>Q(e,W(s));var $=(e,s)=>{var a={};for(var t in e)R.call(e,t)&&s.indexOf(t)<0&&(a[t]=e[t]);if(e!=null&&v)for(var t of v(e))s.indexOf(t)<0&&F.call(e,t)&&(a[t]=e[t]);return a};import{N as J,r as o,R as r,aj as B,gA as X,aJ as g,aK as _,aS as x,gd as U,ge as Z,dq as Y,dr as A,bp as D,d2 as ee,d0 as te,d5 as se,cX as ae,hi as j,eG as N,eC as re,cH as oe,cG as ne}from"./index.7daee9ef.js";import{a as I,u as le,c as ue,b as ie}from"./usePagination.d47dd214.js";import{u as ce}from"./hooks.2cceb9b7.js";var de=function(){return J(function(e){return e.admin.ui.viewVersion})},me=de,p=(e=>(e.SYSTEM="system",e.NON_SYSTEM="non-system",e))(p||{});const pe=({filter:e,onFilterByKeyword:s,onFilterBySystemStatus:a})=>{const t=I(),n=o.exports.useMemo(()=>[{id:"",value:t("resources.common.all")},{id:p.SYSTEM,value:t("ra.boolean.true")},{id:p.NON_SYSTEM,value:t("ra.boolean.false")}],[t]);return r.createElement(B,{display:"flex",justifyContent:"space-between",mb:2},r.createElement(X,{inputSearchPlaceholder:t("resources.common.enterYourKeyword"),onEnterSearchBar:s},r.createElement(B,{width:"100px"},r.createElement(g,{item:!0,container:!0,spacing:1},r.createElement(g,{item:!0,xs:12},r.createElement(_,{variant:"subtitle2"},t(`resources.${x.SCHOOLS}.list.filter.system`))),r.createElement(g,{item:!0,xs:12},r.createElement(U,{defaultValue:e.systemStatus,"data-testid":"SchoolList__Filter_system",options:n,onChange:a,displayEmpty:!0,input:r.createElement(Z,{margin:"dense",value:e.systemStatus})}))))))};var b={},ye=A.exports;Object.defineProperty(b,"__esModule",{value:!0});var K=b.default=void 0,Se=ye(Y),he=D.exports,fe=(0,Se.default)((0,he.jsx)("path",{d:"M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"}),"Check");K=b.default=fe;var w={},ve=A.exports;Object.defineProperty(w,"__esModule",{value:!0});var V=w.default=void 0,_e=ve(Y),Ee=D.exports,ge=(0,_e.default)((0,Ee.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Clear");V=w.default=ge;const xe=()=>{const e=le(x.SCHOOLS),s=I(),a=o.exports.useCallback(t=>t||r.createElement(ae,null),[]);return o.exports.useMemo(()=>[{key:"name",title:e("list.name"),render:t=>r.createElement(ee,{"data-testid":"TableSchool__name",to:{pathname:`/${te.PLATFORM}/schools/${t==null?void 0:t.school_id}/show/`}},r.createElement(_,{variant:"body2"},a(t.name))),cellProps:{style:{width:"50%"}}},{key:"country",title:e("list.country"),render:t=>r.createElement(_,{variant:"body2","data-testid":"SchoolList_Table_country"},s(`resources.configs.choices.countries.${t==null?void 0:t.country}`)),cellProps:{style:{width:"20%"}}},{key:"system",title:e("list.system"),render:t=>t!=null&&t.is_system_school?r.createElement(K,null):r.createElement(V,null),cellProps:{style:{width:"3%",textAlign:"center"}}},{key:"phone",title:e("list.phone"),render:t=>r.createElement(_,{variant:"body2","data-testid":"SchoolList_Table_phone"},a(t==null?void 0:t.phone_number)),cellProps:{style:{width:"30%"}}}],[s,e,a])},be=({data:e,loading:s,pagination:a})=>{const t=xe();return r.createElement(se,{body:{loading:s,rowKey:"school_id",pagination:a},footer:{pagination:a},data:e,columns:t,tableProps:{"data-testid":"SchoolList__table"},withIndex:!0})},we=()=>{const[e,s]=o.exports.useState(""),[a,t]=o.exports.useState(""),n=o.exports.useMemo(()=>({keyword:e,systemStatus:a}),[e,a]),l=o.exports.useCallback(u=>{s(u)},[s]),y=o.exports.useCallback(u=>{const{value:S}=u.target;t(S)},[t]);return{filter:n,onFilterByKeyword:l,onFilterBySystemStatus:y}},Te=e=>({isSystem:o.exports.useMemo(()=>{if(e===p.SYSTEM)return!0;if(e===p.NON_SYSTEM)return!1},[e])});function Le(e,s){return d(c({},e),{payload:d(c({},e.payload),{pagination:{page:s.page+1,perPage:(s==null?void 0:s.limit)||0}})})}function Me(e,s){const C=ue(s),{setOffset:a,setLimit:t}=C,n=$(C,["setOffset","setLimit"]),l=oe(),{resource:y,payload:u,type:S}=Le(e,n),m=j(u),[h,f]=ce({data:[],error:null,total:void 0,loading:!0,loaded:!1,refetch:()=>{}}),E=me(),T=j(E),L=o.exports.useRef(0),M=ie();o.exports.useEffect(()=>{if(N(m,u)&&T===E)return;const{filter:O,pagination:k,sort:H}=u;N(m==null?void 0:m.filter,O)||(k.page=1,a(0)),f(i=>d(c({},i),{loading:!0,loaded:!1}));const G=++L.current;(async()=>{try{const i=await l(S,y,{filter:O,pagination:k,sort:H});if(G<L.current)return;Array.isArray(i.data)||(i.data=[]),f(d(c({},i),{loading:!1,loaded:!0,refetch:()=>{}}))}catch(i){f({data:[],error:i,loading:!1,loaded:!0,refetch:()=>{}}),M(i.message,re.ERROR)}})()},[m,e,l,y,u,S,E,T,f,a,M]);const q=o.exports.useMemo(()=>d(c({},n),{count:typeof h.total=="number"?h.total:0}),[h,n]);return{result:h,pagination:q}}const Ce=e=>{const s=(e==null?void 0:e.keyword)||"",{isSystem:a}=Te(e==null?void 0:e.systemStatus),{result:{data:t,loading:n},pagination:l}=Me({type:ne.LIST,resource:x.SCHOOLS,payload:{filter:{name:s,phone_number:s,is_system_school:a}}});return{data:t,loading:n,pagination:l}},Oe=()=>{const{filter:e,onFilterByKeyword:s,onFilterBySystemStatus:a}=we(),{data:t,loading:n,pagination:l}=Ce(e);return r.createElement(r.Fragment,null,r.createElement(pe,{filter:e,onFilterByKeyword:s,onFilterBySystemStatus:a}),r.createElement(be,{data:t,loading:n,pagination:l}))};var $e=Oe;export{Oe as SchoolList,$e as default};
