var b=Object.defineProperty,P=Object.defineProperties;var w=Object.getOwnPropertyDescriptors;var E=Object.getOwnPropertySymbols;var A=Object.prototype.hasOwnProperty,F=Object.prototype.propertyIsEnumerable;var S=(e,t,r)=>t in e?b(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,v=(e,t)=>{for(var r in t||(t={}))A.call(t,r)&&S(e,r,t[r]);if(E)for(var r of E(t))F.call(t,r)&&S(e,r,t[r]);return e},y=(e,t)=>P(e,w(t));import{dq as O,dr as k,bp as V,r as c,eo as B,g5 as z,g6 as g,g7 as u,aS as m,g8 as j,u as H,eC as h,R as o,aj as I,g9 as C,ek as L,ga as W,gb as q,em as U,b8 as G,cc as J,gc as D,cV as N,aJ as R,gd as X,ge as Z,cq as $,d9 as K,bb as Q}from"./index.7daee9ef.js";import{U as Y}from"./UploadInput.4c4e4115.js";import{M as ee}from"./MediaListing.c26c4fa3.js";import{i as te}from"./infer-mutation.50915866.js";import"./useMutationV2.0883e427.js";var f={},ae=k.exports;Object.defineProperty(f,"__esModule",{value:!0});var T=f.default=void 0,re=ae(O),oe=V.exports,se=(0,re.default)((0,oe.jsx)("path",{d:"M10.09 15.59 11.5 17l5-5-5-5-1.41 1.41L12.67 11H3v2h9.67l-2.58 2.59zM19 3H5c-1.11 0-2 .9-2 2v4h2V5h14v14H5v-4H3v4c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"}),"ExitToAppOutlined");T=f.default=se;const ne=e=>{const[t,r]=c.exports.useState(e||[]);return{files:t,setFiles:r,onChange:a=>{r([...t,...a])},onRemove:a=>{const p=B(t,a);r(p)}}};var _=(e=>(e.IMPORT_MASTER="IMPORT_MASTER",e))(_||{});const ie={importMasterData(e){return{type:_.IMPORT_MASTER,payload:e}}};z(({master:e})=>e.fileImport,e=>Object.values(e).filter(t=>t.isImporting));const le=()=>{const e=g(),t=u(m.MASTERS),r=j(),i=H(),n=c.exports.useCallback((s,l)=>{i(ie.importMasterData({file:s,isImporting:l}))},[i]),{mutateAsync:a}=te({entity:"masterImportPayment",action:"paymentImportMasterData"})({onSuccess:s=>{s.errorsList&&s.errorsList.length?r(t("message.importedFailure"),h.ERROR):r(t("message.importedSuccess"))},onError:s=>{var l;(l=window.warner)==null||l.warn("Imported master data failure",s),r(e(s.message),h.ERROR)}}),p=c.exports.useCallback(async(s,l)=>{n(s,!0);try{await a({payload:{file:s,category:l}})}catch{}finally{n(s,!1)}},[a,n]),d=c.exports.useCallback(async(s,l)=>{await Promise.all(s.map(async M=>await p(M,l)))},[p]);return{onImportFile:p,onImportFiles:d}},ce=({onClose:e,category:t})=>{const r=g(),{size:i,unit:n}=U(C),{files:a,onChange:p,onRemove:d}=ne(),{onImportFiles:s}=le(),l=async()=>{await s(a,t),e()};return o.createElement(o.Fragment,null,o.createElement(I,{mb:2},o.createElement(ee,{medias:a,onDelete:d})),o.createElement(Y,{multiple:!0,maxSize:C,description:r("ra.message.maxFileSizeIs",{fileSize:i,fileUnit:n}),accept:[L.CSV],onChange:p}),o.createElement(W,null,o.createElement(q,{onSave:l,onClose:e,footerConfirmButtonProps:{disabled:a.length===0},textSave:r("ra.common.action.uploadFile")})))},pe=({open:e,onClose:t,category:r})=>{const i=u(m.MASTERS);return o.createElement(G,{"data-testid":"MasterImportDialog__root",open:e,onClose:t,title:i("title.import"),maxWidth:"md",minWidthBox:"sm",footer:"portal"},o.createElement(ce,{category:r,onClose:t}))};function me(e=!1){const[t,r]=c.exports.useState(e),i=c.exports.useCallback(a=>{a&&a.preventDefault&&a.preventDefault(),a&&a.stopPropagation&&a.stopPropagation(),r(!0)},[]),n=c.exports.useCallback(a=>{a&&a.preventDefault&&a.preventDefault(),a&&a.stopPropagation&&a.stopPropagation(),r(!1)},[]);return c.exports.useEffect(()=>{r(e)},[e]),{open:t,onOpen:i,onClose:n}}const x=J(D,"masterData",m.MASTERS),ue=()=>{const e=g(),[t,r]=c.exports.useState(D.AccountingCategory),i=c.exports.useMemo(()=>N(x)?x.map(a=>y(v({},a),{id:a.id,value:e(a.value)})):[],[e]);return{category:t,categoryOptions:i,onChange:a=>{r(a.target.value)}}},de=()=>{const e=u(m.MASTERS),{open:t,onOpen:r,onClose:i}=me(),{category:n,categoryOptions:a,onChange:p}=ue();return o.createElement(R,{container:!0,"data-testid":"MasterDataContainer_container"},o.createElement(R,{item:!0,xs:3},o.createElement(X,{"data-testid":"MasterView__typeSelect",displayEmpty:!0,input:o.createElement(Z,{margin:"dense",size:"small"}),placeholder:e("placeholder.masterData"),options:a,onChange:p,value:n}),o.createElement(I,{mt:2},o.createElement($,{"data-testid":"MasterView__importButton",fullWidth:!0,onClick:r,disabled:!n},o.createElement(T,null),e("button.import")))),n&&o.createElement(pe,{category:n,open:t,onClose:i}))},ge=()=>{const e=u(m.MASTERS);return o.createElement(K,null,o.createElement(Q,{title:e("name")}),o.createElement(de,null))};var he=ge;export{ge as MasterDataView,he as default};
