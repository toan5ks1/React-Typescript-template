var F=Object.defineProperty;var E=Object.getOwnPropertySymbols;var b=Object.prototype.hasOwnProperty,R=Object.prototype.propertyIsEnumerable;var O=(t,r,e)=>r in t?F(t,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[r]=e,y=(t,r)=>{for(var e in r||(r={}))b.call(r,e)&&O(t,e,r[e]);if(E)for(var e of E(r))R.call(r,e)&&O(t,e,r[e]);return t};import{r as l,ch as T,gq as C,R as a,g6 as v,g7 as x,aS as M,ai as I,fG as _,de as A,ey as L,gD as k,d7 as q,gE as N,b as V,gF as W,aH as w,cp as B}from"./index.7daee9ef.js";import{u as H,a as Y,O as G,b as Q,P as $}from"./OrderUpsertForm.355b1b9f.js";import{u as j,t as z}from"./useOrderMutation.5c896db6.js";import{u as J}from"./useFetchStudentInfo.0fff90f4.js";import"./AccordionSummaryBase.51fee70a.js";import"./IconButtonBase.a835a6a3.js";import"./toInteger.9a87c39c.js";import"./intersection.1a672747.js";import"./_castArrayLikeObject.2e9ca1e4.js";import"./isArrayLikeObject.979eb0a9.js";import"./_baseRest.fb013a79.js";import"./infer-mutation.50915866.js";const K=({isOpen:t,children:r,isLoading:e,onSave:o,onClose:s})=>{const c=v(),i=x(M.ORDERS),[d,u]=I(!1),p=l.exports.useCallback(()=>{u(!0)},[u]);return a.createElement(_,{title:i("title.createOrder"),open:t,onClose:p,onSave:o,"data-testid":"OrderUpsertDialog__dialog",isShowingBackdrop:e,footer:a.createElement(Q,{onCancel:p,onSubmit:o})},r,a.createElement(A,{open:d,onClose:()=>u(!1),onSave:()=>{s(),u(!1)},textSave:c("ra.common.action.leave")}))},X=({isOpen:t,onClose:r})=>{const[e,o]=l.exports.useState(null),s=l.exports.useRef(),c=H(),{formState:i,getValues:d,handleSubmit:u}=T();l.exports.useEffect(()=>{if(e!==null&&i.submitCount){const{isError:n}=c.productArrayTable.validate(d().productFieldArrayItem);!n&&o(null)}},[i,d,e,c.productArrayTable]);const p=n=>{var m;n==="ra.manabie-error.specified.orderMismatch"&&((m=s.current)==null||m.remove())},{onUpsert:g,isOnUpsertLoading:P}=j({onUpsertError:p}),{getProductPluginsMap:f}=Y(),S=l.exports.useCallback(n=>{const{isError:m,errorMessage:h}=c.productArrayTable.validate(n.productFieldArrayItem);if(m){o(h);return}const D=z(n,C.OrderType.ORDER_TYPE_NEW,f);g({data:D})},[f,g,c.productArrayTable]),U=()=>{var n;o(null),(n=s.current)==null||n.remove()};return a.createElement(K,{isOpen:t,onSave:u(S),isLoading:P,onClose:r},a.createElement(G,{onLocationChange:U,productErrorMessage:e,productListSectionRef:s}))},Z=({studentInfo:t})=>{const r=V(),{search:e}=W(),o=w({defaultValues:{student:t,productFieldArrayItem:[]}}),s=()=>{const i=new URLSearchParams(e).get("redirectUrl");i?r.push(i):r.goBack()};return a.createElement(B,y({},o),a.createElement(X,{isOpen:!0,onClose:s}))},ee=()=>{const{studentId:t}=L(),r=typeof t=="string"?t:void 0,{currentCurrency:e}=k(),{data:o,isFetching:s}=J({studentId:r});return s?a.createElement(q,null):typeof o=="undefined"?a.createElement(N,{"data-testid":"OrderManagementUpsert__notfound"}):a.createElement($,{currency:e,orderType:C.OrderType.ORDER_TYPE_NEW},a.createElement(Z,{studentInfo:o}))};var ge=ee;export{ge as default};
