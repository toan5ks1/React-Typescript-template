var v=Object.defineProperty,O=Object.defineProperties;var _=Object.getOwnPropertyDescriptors;var R=Object.getOwnPropertySymbols;var z=Object.prototype.hasOwnProperty,B=Object.prototype.propertyIsEnumerable;var D=(t,e,a)=>e in t?v(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a,c=(t,e)=>{for(var a in e||(e={}))z.call(e,a)&&D(t,a,e[a]);if(R)for(var a of R(e))B.call(e,a)&&D(t,a,e[a]);return t},h=(t,e)=>O(t,_(e));import{r as n,eB as k,c2 as I,eh as $,ei as L,ej as V,ek as G,el as H,aS as K,cG as N,em as Q,eC as S,e1 as W,dQ as q,eD as J,R as g,aj as X,eE as Y,aK as Z}from"./index.7daee9ef.js";import{u as ee}from"./useMutationV2.0883e427.js";const ae=n.exports.createContext({readOnly:!1}),te=()=>n.exports.useContext(ae),A=t=>{const e=k(),a=I(),i=n.exports.useCallback(o=>{o.map(({file:s})=>{const{size:x,unit:r}=Q(t);e(a("ra.manabie-error.uploadedFileIsInvalid",{fileType:$(c(c(c(c({},L),V),G),H),s.type),fileMaxSize:x,fileUnit:r}),"error")})},[e,a,t]),m=n.exports.useCallback(o=>{i(o)},[i]),{isLoading:f,mutate:l,mutateAsync:p}=ee({entity:K.MEDIA,action:N.UPLOAD_FILES},{onError:o=>{var s;(s=window.warner)==null||s.log(o.message),e(`${a("ra.manabie-error.cannotUpload")}: ${o.message}`,S.ERROR)}}),d=n.exports.useCallback((o,s)=>l({data:o},s),[l]),y=n.exports.useCallback((o,s)=>p({data:o},s),[p]);return{onUploadFiles:d,onUploadFilesAsync:y,onDropRejected:m,isUploading:f}},se=({customFilterFn:t,customUploadFn:e,autoUpload:a,onChange:i})=>{const{onUploadFilesAsync:m}=A(),f=k(),l=I(),[p,d]=n.exports.useState(!1),y=n.exports.useRef(!1);return W(()=>{y.current=!0}),{onDropAccepted:n.exports.useCallback(async s=>{var x;t&&(s=t(s));try{d(!0);let r=[];e&&await e(s),a&&(r=(await m(s)).attachments.map(E=>E.resource)),i&&i(s,r)}catch(r){const b=q(r);(x=window.warner)==null||x.log(b.message),f(`${l("ra.manabie-error.cannotUpload")}: ${b.message}`,S.ERROR)}finally{y.current||d(!1)}},[t,e,a,i,m,f,l]),uploading:p}},ie=t=>{const{accept:e,maxSize:a,minSize:i,noStyles:m=!1,multiple:f=!1,show:l,description:p,children:d,onChange:y,customFilterFn:o,customUploadFn:s,disabled:x,autoUpload:r,rootDefaultPadding:b=!0,descDefaultMargin:E=!0}=t;if(r&&s)throw new Error("We only have customUploadFn or autoUpload");const{onDropAccepted:C,uploading:U}=se({autoUpload:r,customFilterFn:o,customUploadFn:s,onChange:y}),{readOnly:T}=te(),{onDropRejected:F}=A(a),{getRootProps:P,getInputProps:M,acceptedFiles:j,isDragActive:w}=J({accept:e,maxSize:a,minSize:i,multiple:f,onDropAccepted:C,onDropRejected:F,disabled:U||T||x});return g.createElement(g.Fragment,null,g.createElement(X,h(c({},P()),{sx:u=>c({padding:b?u.spacing(3):u.spacing(2,3)},!m&&{width:"100%",minHeight:82,border:"1px dashed rgba(33, 150, 243, 0.5)",borderRadius:u.spacing(.5),background:"rgba(33, 150, 243, 0.08)",display:"flex",justifyContent:"center",alignItems:"center",cursor:"pointer","&:focus":{outline:"unset"}}),"data-testid":"UploadInput"}),g.createElement("input",c({"data-testid":"UploadInput__inputFile"},M())),n.exports.isValidElement(d)?n.exports.cloneElement(d,{isDragActive:w,uploading:U}):g.createElement(Y,{isDragActive:w,uploading:U})),p&&g.createElement(Z,{sx:u=>({display:"inline-block",color:u.palette.text.secondary,margin:E?u.spacing(1.5,0):u.spacing(1.1,0,0,0)}),variant:"caption","data-testid":"UploadInput__description"},p),l?g.createElement(l,{files:j}):null)};export{ie as U,te as a,A as u};
