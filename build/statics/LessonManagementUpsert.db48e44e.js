var as=Object.defineProperty,os=Object.defineProperties;var is=Object.getOwnPropertyDescriptors;var me=Object.getOwnPropertySymbols;var qe=Object.prototype.hasOwnProperty,$e=Object.prototype.propertyIsEnumerable;var xe=(e,t,s)=>t in e?as(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,g=(e,t)=>{for(var s in t||(t={}))qe.call(t,s)&&xe(e,s,t[s]);if(me)for(var s of me(t))$e.call(t,s)&&xe(e,s,t[s]);return e},U=(e,t)=>os(e,is(t));var Q=(e,t)=>{var s={};for(var n in e)qe.call(e,n)&&t.indexOf(n)<0&&(s[n]=e[n]);if(e!=null&&me)for(var n of me(e))t.indexOf(n)<0&&$e.call(e,n)&&(s[n]=e[n]);return s};import{e_ as cs,bU as ft,bv as us,e$ as ds,f0 as ls,f1 as ms,c2 as ps,R as o,cA as _s,aj as V,cK as ve,aJ as N,eu as fs,dd as gs,df as Ee,eI as v,dg as gt,f2 as J,cV as A,cM as Me,r as h,eF as Ss,aR as hs,aU as ys,aV as Ls,aW as Es,b$ as Ts,c0 as bs,c1 as Is,aX as As,aY as D,aZ as G,f3 as Te,a$ as j,f4 as St,dM as ht,f5 as ke,f6 as ws,f7 as Ve,dO as Be,f8 as vs,cZ as yt,f9 as Ms,fa as Cs,u as Rs,fb as Os,fc as Fs,fd as Lt,dh as Ns,fe as Ds,dD as Ps,dx as Qe,ff as Us,dC as Gs,dE as Et,dw as xs,dF as qs,dG as We,dy as $s,dz as ks,fg as Tt,fh as Vs,fi as Bs,fj as Qs,fk as bt,fl as It,fm as Ws,fn as At,L as ee,aK as wt,fo as He,b9 as ce,eG as vt,fp as Hs,ed as Re,fq as Ys,cR as js,cd as K,dv as Ks,ef as Mt,e9 as ue,cG as Ct,ai as Oe,ch as de,d$ as zs,e0 as Xs,e1 as Zs,fr as Js,e3 as be,e4 as Ye,cH as Rt,aS as le,fs as en,ft as Ot,cN as he,eR as Ft,cL as Nt,fu as tn,fv as sn,fw as nn,du as rn,fx as an,fy as on,eg as cn,fz as un,cz as dn,fA as ln,cY as mn,aH as Dt,cp as pn,fB as Pt,eq as Ut,eQ as Fe,cj as Gt,b8 as xt,fC as _n,cO as fn,eb as gn,fD as Sn,bR as qt,ev as hn,e7 as je,db as yn,dc as Ke,aI as Ln,eh as ze,fE as Xe,fF as Ze,cv as Ie,dQ as $t,dm as Je,eU as et,fG as En}from"./index.7daee9ef.js";import{F as Tn}from"./FormUploadMaterials.c32fc30a.js";import{T as ie}from"./TypographyMaxLines.88e560ab.js";import{_ as bn}from"./_baseFlatten.b9c8ce3e.js";import{_ as kt}from"./_baseRest.fb013a79.js";import{i as In}from"./isArrayLikeObject.979eb0a9.js";import{l as Vt}from"./last.e1193f3d.js";import{_ as An,a as wn}from"./_castArrayLikeObject.2e9ca1e4.js";var vn=cs,Mn=ds,Cn=ls,Rn=ft,On=us,Fn=ms,Nn=200;function Dn(e,t,s,n){var r=-1,a=Mn,i=!0,c=e.length,u=[],d=t.length;if(!c)return u;s&&(t=Rn(t,On(s))),n?(a=Cn,i=!1):t.length>=Nn&&(a=Fn,i=!1,t=new vn(t));e:for(;++r<c;){var p=e[r],_=s==null?p:s(p);if(p=n||p!==0?p:0,i&&_===_){for(var m=d;m--;)if(t[m]===_)continue e;u.push(p)}else a(t,_,n)||u.push(p)}return u}var Pn=Dn;const Un=e=>{const d=e,{title:t,ButtonDeleteProps:s,ButtonAddProps:n,shouldShowDeleteButton:r=!0,children:a}=d,i=Q(d,["title","ButtonDeleteProps","ButtonAddProps","shouldShowDeleteButton","children"]),c=ps(),u={startIcon:o.createElement(_s,null),children:c("ra.common.action.add")};return o.createElement(V,g({display:"flex",justifyContent:"space-between",alignItems:"center",mb:2.25},i),o.createElement(V,null,o.createElement(ve,null,t)),o.createElement(V,null,a||o.createElement(N,{container:!0,spacing:2},r&&o.createElement(N,{item:!0},o.createElement(fs,g({"data-testid":"TableAction__buttonDelete"},s))),o.createElement(N,{item:!0},o.createElement(gs,g(g({"data-testid":"TableAction__buttonAdd"},u),n))))))};var Gn=(e=>(e.ATTENDANCE_STATUS="attendance_status",e.ATTENDANCE_REMARK="attendance_remark",e.BUTTON_PREVIOUS_REPORT="lesson_previous_report_action",e.LINK_VIEW_STUDY_PLAN="lesson_view_study_plan_action",e))(Gn||{}),xn=(e=>(e.AUTOCOMPLETE="AUTOCOMPLETE",e.TEXT_FIELD="TEXT_FIELD",e.TEXT_FIELD_PERCENTAGE="TEXT_FIELD_PERCENTAGE",e.TEXT_FIELD_AREA="TEXT_FIELD_AREA",e.TYPOGRAPHY="TYPOGRAPHY",e))(xn||{}),qn=(e=>(e.ATTENDANCE_STATUS="ATTENDANCE_STATUS",e.ATTENDANCE_REMARK="ATTENDANCE_REMARK",e.BUTTON_PREVIOUS_REPORT="BUTTON_PREVIOUS_REPORT",e.LINK_VIEW_STUDY_PLAN="LINK_VIEW_STUDY_PLAN",e))(qn||{}),$n=(e=>(e.AUTOCOMPLETE="AUTOCOMPLETE",e.TEXT_FIELD="TEXT_FIELD",e.TEXT_FIELD_PERCENTAGE="TEXT_FIELD_PERCENTAGE",e.TEXT_FIELD_AREA="TEXT_FIELD_AREA",e.TYPOGRAPHY="TYPOGRAPHY",e.BUTTON_PREVIOUS_REPORT="BUTTON_PREVIOUS_REPORT",e.LINK_VIEW_STUDY_PLAN="LINK_VIEW_STUDY_PLAN",e))($n||{});const kn=Ee(v.StudentAttendStatus);function Vn(e,t){return e.every(s=>t.indexOf(s)===-1)}function Ne(e={},t,s=["_NONE"]){return Object.keys(e).filter(n=>Vn(s,n)).map(n=>({id:n,name:`resources.choices.${t}.${n}`}))}Ne(gt.Subject,"subjects");Ne(gt.Country,"countries");const Bn=Ne(J.DateOfWeek,"dayOfWeek"),Qn=e=>e&&e.key&&e.label&&Object.keys(e).length===2,Li=e=>Number.isNaN(Number(e))?0:Number(e),Ei=e=>String(e).toLowerCase()==="true",Ti=e=>typeof e=="string"?e:"";function bi(e){return Array.isArray(e)&&A(e)?e:[]}const Ii=e=>e.reduce((n,r)=>{var i;const a=(i=r.teacher.users)==null?void 0:i.name;return a&&n.push(a),n},[]).join(", "),Wn=(e,t)=>{const s=new Date(e).getDay();return t(Bn[s].name)},Ai=(e,t)=>{const s=Me.fromISO(`${e}`),r=Me.fromISO(`${t}`).diff(s,["hours","minutes"]);return r.hours*60+r.minutes};function Hn(e,t){return typeof t=="undefined"?"undefined":["function","bigint","symbol"].includes(typeof t)?t.toString():t}function Yn(e,t){return JSON.stringify(e,Hn,t)}const tt=e=>{const{children:t}=e;return o.createElement(V,{my:1},t)};function q(){const{i18nProvider:{translate:e}}=Ss();return h.exports.useCallback((t,s,n)=>{const r=hs(t)?"":t;return(n==null?void 0:n.lowercase)&&s&&typeof s=="object"&&Object.keys(s).forEach(a=>{var i;typeof s[a]=="string"&&(s[a]=e((i=s[a])==null?void 0:i.toString()).toLowerCase())}),e(r,s)||""},[e])}function z(e){const t=q();return h.exports.useCallback((s,n)=>t(`resources.${e}.${s}`,n||{smart_count:1}),[e,t])}var jn=(e=>(e.TYPOGRAPHY="TYPOGRAPHY",e.TYPOGRAPHY_WITH_VALUE="TYPOGRAPHY_WITH_VALUE",e.TYPOGRAPHY_WITH_VALUE_PERCENTAGE="TYPOGRAPHY_WITH_VALUE_PERCENTAGE",e))(jn||{});const Kn=e=>["STUDENT_ATTEND_STATUS_ATTEND","STUDENT_ATTEND_STATUS_ABSENT","STUDENT_ATTEND_STATUS_INFORMED_ABSENT","STUDENT_ATTEND_STATUS_LATE","STUDENT_ATTEND_STATUS_INFORMED_LATE","STUDENT_ATTEND_STATUS_LEAVE_EARLY"].map(s=>({key:s,label:e(`studentAttendanceStatus.${s}`)})),wi=(e,t)=>`lessonReportDetails.${e}.dynamicFields.${t}`,vi="FEATURE_NAME_INDIVIDUAL_LESSON_REPORT";var zn=(e=>(e.LESSON_REPORT_SUBMITTING_STATUS_SUBMITTED="LESSON_REPORT_SUBMITTING_STATUS_SUBMITTED",e.LESSON_REPORT_SUBMITTING_STATUS_DRAFT="LESSON_REPORT_SUBMITTING_STATUS_DRAFT",e))(zn||{});class W{constructor(t,s,n){this.appConfigs=t,this.serviceName=s,this.doQuery=n,this.baseURL=this.appConfigs.getEndpoints()[this.serviceName]}_call(t){return this.doQuery(t,this.baseURL)}}class R extends Error{constructor({serviceName:t,errors:s,action:n}){super("ra.message.manabie-error.invalid_params"),this.name="InvalidParamError",this.serviceName=t,this.errors=s,this.action=n}toString(){const t={errorName:this.name,serviceName:this.serviceName,errors:this.errors||[],action:this.action};return Yn(t,2)}}class X{constructor(t,s,n){const r=s.getEndpoints().gRPC;this.UnInitializedClient=t,this.configs=s,this.options=n,this.previousUrl=r,this.client=new t(r,{},n)}_call(t,...s){const n=this.configs.getEndpoints().gRPC;return n!==this.previousUrl&&(this.client=new this.UnInitializedClient(n,{},this.options),this.previousUrl=n),this.client[t](...s)}}const Xn=ys(0);function Zn(){const[e=0,t]=Xn();return{version:e,reload:h.exports.useCallback(()=>t(e+1),[t,e])}}function k(e){var t,s;return{mutation:(t=e.mutation)!=null?t:{},query:(s=e.query)!=null?s:{}}}let pe={},_e={};function Bt(e){return function(s){if(pe[`${s.entity}_${s.action}`])return pe[`${s.entity}_${s.action}`];function n(r,a){var d,p,_;const{version:i}=Zn(),c=`${s.entity}_${s.action}`,u={request:r,version:i};return g({queryKey:[c,u]},Ts([c,u],async m=>{var S;try{return await e[s.entity].query[s.action](r)}catch(l){if(!(l instanceof R)){const f=bs(m.queryKey);(S=window.warner)==null||S.warn(`UseQuery ${f}`,l)}throw l}},{enabled:a.enabled,cacheTime:(d=a.cacheFor)!=null?d:0,staleTime:(p=a.markDataAsStaleAfter)!=null?p:3e5,select:a.selector,retry:(_=a.retry)!=null?_:0,notifyOnChangeProps:a.rerenderOnChangeProps,keepPreviousData:!0,refetchOnWindowFocus:!1,onError:a.onError,onSuccess:a.onSuccess}))}return pe[`${s.entity}_${s.action}`]=n,pe[`${s.entity}_${s.action}`]}}function Jn(e){return function(s){return function(r){const a=Ls();return Es(async i=>await e[s.entity].mutation[s.action](i),U(g({},r),{onMutate:r==null?void 0:r.onBeforeMutate,onSuccess:async(i,c,u)=>{var d;r!=null&&r.invalidateKey&&await a.invalidateQueries(r==null?void 0:r.invalidateKey),await((d=r==null?void 0:r.onSuccess)==null?void 0:d.call(r,i,c,u))}}))}}}const er=()=>({limit:10,offsetInteger:0,offsetString:""}),tr=(e=10)=>({total:0,rowsPerPage:e,currentPage:0});function sr(e){return function(s){if(_e[`${s.entity}_${s.action}`])return _e[`${s.entity}_${s.action}`];const n=Bt(e);function r(a,i){var L,O;const w=i,{defaultPaging:c=er(),onSuccess:u}=w,d=Q(w,["defaultPaging","onSuccess"]),[p,_]=h.exports.useState(c),m=h.exports.useRef(tr(c.limit)),S=U(g({},a),{paging:p}),l=n(s)(S,U(g({},d),{onSuccess(F){const b=F.totalItems||0;if(m.current.total=b,u)return u(F)}})),f=h.exports.useCallback(F=>{var P,$;if(l.isFetching)return;const{currentPage:b}=m.current;F>b&&((P=l.data)==null?void 0:P.nextPage)&&_(l.data.nextPage),F<b&&(($=l.data)==null?void 0:$.previousPage)&&_(l.data.previousPage),m.current.currentPage=F},[(L=l.data)==null?void 0:L.nextPage,(O=l.data)==null?void 0:O.previousPage,l.isFetching]),E=h.exports.useCallback(F=>{if(l.isFetching)return;const b=Number.parseInt(F);m.current.currentPage=0,m.current.rowsPerPage=b,_(U(g({},c),{limit:b}))},[c,l.isFetching]),I=h.exports.useCallback(()=>{m.current.currentPage=0,_(U(g({},c),{limit:m.current.rowsPerPage}))},[c]),{currentPage:M,total:C,rowsPerPage:T}=m.current,y={page:M,count:C,offset:C<T?C:M*T,limit:T,rowsPerPage:T,onPageChange:(F,b)=>f(b),onRowsPerPageChange:F=>E(F.target.value)};return{results:l,pagination:y,goToFirstPage:I}}return _e[`${s.entity}_${s.action}`]=r,_e[`${s.entity}_${s.action}`]}}function Qt(e){return Promise.resolve(e)}function oe(e){if(!!e)return`%${e}%`}const fe=e=>e&&Array.isArray(e)?e.map(t=>t):[],Wt=e=>e.split(".").pop()||"",nr=e=>e.replace(`.${Wt(e)}`,""),rr=e=>e.media_id!==void 0,ar=e=>{const t=[],s=[];for(let n=0;n<e.length;n++){const r=e[n];if(rr(r)){t.push(r.media_id);continue}r instanceof File&&s.push(r)}return{alreadyUploadedMediaIds:t,filesNeedToBeUploaded:s}},De=e=>{const t=Object.keys(e),s=[];return t.forEach(n=>{Boolean(e[n])||s.push({field:n})}),s},Ht=e=>{const t=Object.keys(e),s=[];return t.forEach(n=>{typeof e[n]!="number"&&s.push({field:n})}),s},st=e=>{const{startTime:t,endTime:s,centerId:n,teacherIdsList:r,studentInfoListList:a,teachingMedium:i,teachingMethod:c,savingOption:u}=e,d=[];return n||d.push({field:"centerId"}),t||d.push({field:"startTime"}),s||d.push({field:"endTime"}),u?Object.values(v.CreateLessonSavingMethod).includes(u.method)||d.push({field:"savingOption"}):d.push({field:"savingOption"}),Object.values(J.LessonTeachingMedium).includes(i)||d.push({field:"teachingMedium"}),Object.values(J.LessonTeachingMethod).includes(c)||d.push({field:"teachingMethod"}),A(r)||d.push({field:"teacherIdsList"}),A(a)||d.push({field:"studentInfoListList"}),d},nt=(e,t)=>{const{lessonId:s,lessonReportId:n,detailsList:r}=e.data,a=[];return s||a.push({field:"lessonId",fieldValueIfNotSensitive:s}),typeof n=="undefined"&&a.push({field:"lessonReportId",fieldValueIfNotSensitive:n}),r.forEach(i=>{const{studentId:c,courseId:u,attendanceStatus:d}=i;c||a.push({field:"studentId"}),u||a.push({field:"courseId",fieldValueIfNotSensitive:u}),t&&!d&&a.push({field:"attendanceStatus",fieldValueIfNotSensitive:d})}),a};function or(){return Qt({data:null})}async function H(e,t){return Is.PROFILE?As.request({body:e,url:`${t}/v1/graphql`}):or()}const Yt=D`
    fragment CourseAttrs on courses {
        course_id
        name
        icon
        grade
        subject
        country
        school_id
        display_order
    }
`,ir=D`
    query CoursesMany($course_id: [String!] = []) {
        courses(where: { course_id: { _in: $course_id } }) {
            ...CourseAttrs
        }
    }
    ${Yt}
`,cr=D`
    query CoursesManyReference($name: String, $limit: Int = 10, $offset: Int = 0) {
        courses(
            limit: $limit
            offset: $offset
            order_by: { created_at: desc, display_order: asc, name: asc, course_id: asc }
            where: { name: { _ilike: $name } }
        ) {
            ...CourseAttrs
        }
        courses_aggregate(where: { name: { _ilike: $name } }) {
            aggregate {
                count
            }
        }
    }
    ${Yt}
`;class ur extends W{async getMany(t){var n;return(n=(await this._call({query:ir,variables:t})).data)==null?void 0:n.courses}async getManyReference(t){var i;const{name:s,limit:n,offset:r}=t;return(i=(await this._call({query:cr,variables:{name:oe(s),limit:n,offset:r}})).data)==null?void 0:i.courses}}const rt=new ur(G,"bobGraphQL",H),dr=k({query:{coursesGetMany:({course_id:e})=>{const t=!e,s=Array.isArray(e)&&!A(e);if(t||s)throw new R({action:"coursesGetMany",serviceName:"bobGraphQL",errors:[{field:"course_id"}]});return rt.getMany({course_id:e})},coursesGetManyReference:e=>{const{limit:t,offset:s}=e,n=Ht({limit:t,offset:s});if(A(n))throw new R({action:"coursesGetManyReference",serviceName:"bobGraphQL",errors:n});return rt.getManyReference(e)}}}),lr=D`
    fragment LessonGroupAttrs on lesson_groups {
        media_ids
        lesson_group_id
    }
`,mr=D`
    query LessonGroupById($lesson_group_id: String!) {
        lesson_groups(where: { lesson_group_id: { _eq: $lesson_group_id } }) {
            ...LessonGroupAttrs
        }
    }
    ${lr}
`;class pr extends W{async getOne(t){var n;return(n=(await this._call({query:mr,variables:t})).data)==null?void 0:n.lesson_groups[0]}}const _r=new pr(G,"bobGraphQL",H),fr=k({query:{lessonGroupsGetOne:({lesson_group_id:e})=>{if(!e)throw new R({action:"lessonGroupsGetOne",serviceName:"bobGraphQL",errors:[{field:"lesson_group_id"}]});return _r.getOne({lesson_group_id:e})}}}),gr=D`
    query LessonMemberByUserIdAndCourseIdAndLessonIdV2(
        $user_id: String!
        $course_id: String!
        $lesson_id: String!
    ) {
        lesson_members(
            where: {
                user_id: { _eq: $user_id }
                course_id: { _eq: $course_id }
                lesson_id: { _eq: $lesson_id }
            }
        ) {
            attendance_remark
            attendance_status
        }
    }
`;class Sr extends W{async getOneByUserIdAndCourseIdAndLessonId(t){var n;return(n=(await this._call({query:gr,variables:t})).data)==null?void 0:n.lesson_members[0]}}const hr=new Sr(G,"bobGraphQL",H),yr=k({query:{lessonMembersGetOneLessonMemberByUserIdAndCourseIdAndLessonId:e=>{const t=De(e);if(A(t))throw new R({action:"lessonMembersGetOneLessonMemberByUserIdAndCourseIdAndLessonId",serviceName:"bobGraphQL",errors:t});return hr.getOneByUserIdAndCourseIdAndLessonId(e)}}}),Lr=D`
    query LessonReportByLessonId($lesson_id: String!) {
        lesson_reports(where: { lesson_id: { _eq: $lesson_id } }) {
            lesson_id
            lesson_report_id
            report_submitting_status
            partner_form_config {
                form_config_id
                feature_name
                form_config_data
            }
            lesson_report_details {
                lesson_report_detail_id
                student {
                    student_id
                }
                partner_dynamic_form_field_values {
                    dynamic_form_field_value_id
                    value_type
                    int_value
                    int_set_value
                    int_array_value
                    string_value
                    string_set_value
                    string_array_value
                    bool_value
                    field_render_guide
                    field_id
                }
            }
        }
    }
`,Er=D`
    query PreviousLessonReportByCourseIdAndStudentIdAndReportIdAndLessonIdV2(
        $report_user_id: String!
        $report_course_id: String!
        $report_id: String
        $report_lesson_id: String
    ) {
        get_previous_report_of_student_v3(
            args: {
                report_course_id: $report_course_id
                report_user_id: $report_user_id
                report_id: $report_id
                report_lesson_id: $report_lesson_id
            }
        ) {
            form_config_id
            lesson_report_id
            lesson_id
        }
    }
`;class Tr extends W{async getOne(t){var n;return(n=(await this._call({query:Lr,variables:t})).data)==null?void 0:n.lesson_reports[0]}async getOneByCourseIdAndStudentIdAndReportIdAndLessonIdV2(t){var n;return(n=(await this._call({query:Er,variables:t})).data)==null?void 0:n.get_previous_report_of_student_v3[0]}}const at=new Tr(G,"bobGraphQL",H),br=e=>e.map(s=>{let n=new v.DynamicFieldValue;const{valueType:r,dynamicFieldId:a,fieldRenderGuide:i,boolValue:c,intValue:u,stringValue:d}=s,{intArrayValue:p,intSetValue:_,stringArrayValue:m,stringSetValue:S}=s;switch(n.setValueType(r),n.setDynamicFieldId(a),n.setFieldRenderGuide(i),r){case v.ValueType.VALUE_TYPE_BOOL:n.setBoolValue(c);break;case v.ValueType.VALUE_TYPE_INT:n.setIntValue(u);break;case v.ValueType.VALUE_TYPE_STRING:n.setStringValue(d);break;case v.ValueType.VALUE_TYPE_INT_ARRAY:{const l=new v.DynamicFieldValue.IntArrayValue,f=fe(p==null?void 0:p.arrayValueList);l.setArrayValueList(f),n.setIntArrayValue(l);break}case v.ValueType.VALUE_TYPE_INT_SET:{const l=new v.DynamicFieldValue.IntSetValue,f=fe(_==null?void 0:_.arrayValueList);l.setArrayValueList(f),n.setIntSetValue(l);break}case v.ValueType.VALUE_TYPE_STRING_ARRAY:{const l=new v.DynamicFieldValue.StringArrayValue,f=fe(m==null?void 0:m.arrayValueList);l.setArrayValueList(f),n.setStringArrayValue(l);break}case v.ValueType.VALUE_TYPE_STRING_SET:default:{const l=new v.DynamicFieldValue.StringSetValue,f=fe(S==null?void 0:S.arrayValueList);l.setArrayValueList(f),n.setStringSetValue(l);break}}return n});function ot(e){const t=new v.WriteLessonReportRequest,{lessonId:s,lessonReportId:n,detailsList:r}=e,a=r.map(i=>{const c=new v.WriteLessonReportRequest.LessonReportDetail,{courseId:u,studentId:d,attendanceStatus:p,attendanceRemark:_}=i,m=br(i.fieldValuesList);return c.setCourseId(u),c.setStudentId(d),c.setAttendanceStatus(p),c.setAttendanceRemark(_),c.setFieldValuesList(m),c});return t.setLessonId(s),t.setLessonReportId(n),t.setDetailsList(a),t}function Ir(e){const t=new v.DeleteLessonReportRequest;return t.setLessonReportId(e),t}class Ar extends X{async submitLessonReport({data:t}){const s=ot(t);return(await this._call("submitLessonReport",s)).toObject()}async saveDraftLessonReport({data:t}){const s=ot(t);return(await this._call("saveDraftLessonReport",s)).toObject()}async deleteLessonReport({data:t}){const s=Ir(t.lessonReportId);return(await this._call("deleteLessonReport",s)).toObject()}}const Ae=new Ar(Te.LessonReportModifierServicePromiseClient,G,j);function wr(e){const t=new v.GetPartnerDomainRequest;return t.setType(e.type),t}class vr extends X{async retrievePartnerDomain(t){const s=wr(t);return(await this._call("retrievePartnerDomain",s)).toObject()}}const Mr=new vr(Te.LessonReportReaderServicePromiseClient,G,j),jt=k({query:{lessonReportsGetOne:({lesson_id:e})=>{if(!e)throw new R({action:"lessonReportsGetOne",serviceName:"bobGraphQL",errors:[{field:"lesson_id"}]});return at.getOne({lesson_id:e})},lessonReportsGetOneByCourseIdAndStudentIdAndReportIdAndLessonId:e=>{const{report_course_id:t,report_user_id:s}=e,n=De({report_course_id:t,report_user_id:s});if(A(n))throw new R({action:"lessonReportsGetOneByCourseIdAndStudentIdAndReportIdAndLessonId",serviceName:"bobGraphQL",errors:n});return at.getOneByCourseIdAndStudentIdAndReportIdAndLessonIdV2(e)},lessonReportsRetrievePartnerDomain:e=>{if(!e.type)throw new R({action:"lessonReportsRetrievePartnerDomain",errors:[{field:"type"}],serviceName:"bobGraphQL"});return Mr.retrievePartnerDomain(e)}},mutation:{lessonReportsSubmit:e=>{const t=nt(e,!0);if(A(t))throw new R({action:"lessonReportsSubmit",serviceName:"bobGraphQL",errors:t});return Ae.submitLessonReport(e)},lessonReportsSaveDraft:e=>{const t=nt(e,!1);if(A(t))throw new R({action:"lessonReportsSaveDraft",serviceName:"bobGraphQL",errors:t});return Ae.saveDraftLessonReport(e)},lessonReportsDelete:e=>{if(!e.data.lessonReportId)throw new R({action:"lessonReportsDelete",serviceName:"bobGraphQL",errors:[{field:"lessonReportId"}]});return Ae.deleteLessonReport(e)}}});function Cr(e){const{keyword:t,paging:s,filter:n}=e,r=new v.RetrieveStudentSubscriptionRequest,a=s?St(s):void 0,i=new v.RetrieveStudentSubscriptionFilter;return i.setCourseIdList((n==null?void 0:n.courseIdList)||[]),i.setGradeList((n==null?void 0:n.gradeList)||[]),r.setKeyword(t),r.setPaging(a),r.setFilter(i),r}function Rr(e){const t=new v.GetStudentCourseSubscriptionsRequest,s=e.map(n=>{const r=new v.GetStudentCourseSubscriptionsRequest.StudentCourseSubscription;return r.setCourseId(n.courseId),r.setStudentId(n.studentId),r});return t.setSubscriptionsList(s),t}class Or extends X{async retrieveStudentSubscription(t){const s=Cr(t);return(await this._call("retrieveStudentSubscription",s)).toObject()}async getStudentCourseSubscriptions(t){const s=Rr(t);return(await this._call("getStudentCourseSubscriptions",s)).toObject()}}const it=new Or(Te.StudentSubscriptionServicePromiseClient,G,j),Fr=k({query:{lessonStudentSubscriptionsRetrieveStudentSubscription:e=>{if(!(e!=null&&e.paging))throw new R({action:"lessonStudentSubscriptionsRetrieveStudentSubscription",serviceName:"bobGraphQL",errors:[{field:"paging"}]});return it.retrieveStudentSubscription(e)},lessonStudentSubscriptionsGetStudentCourseSubscription:e=>it.getStudentCourseSubscriptions(e)}}),Nr=D`
    query LessonByLessonIdForLessonManagement($lesson_id: String!) {
        lessons(where: { lesson_id: { _eq: $lesson_id } }) {
            lesson_id
            center_id
            lesson_group_id
            teaching_medium
            teaching_method
            lesson_type
            scheduling_status
            start_time
            end_time
            lessons_teachers {
                teacher {
                    users {
                        user_id
                        name
                        email
                    }
                }
            }
            lesson_members {
                attendance_remark
                attendance_status
                course {
                    course_id
                    name
                    subject
                }
                user {
                    user_id
                    name
                    email
                    student {
                        current_grade
                    }
                }
            }
        }
    }
`;class Dr extends W{async getOneForLessonManagement(t){var n;return(n=(await this._call({query:Nr,variables:t})).data)==null?void 0:n.lessons[0]}}const Pr=new Dr(G,"bobGraphQL",H),Kt=(e,t)=>{if(e.setStartTime(Be(t.startTime)),e.setEndTime(Be(t.endTime)),e.setTeachingMedium(t.teachingMedium),e.setTeachingMethod(t.teachingMethod),e.setTeacherIdsList(t.teacherIdsList),e.setCenterId(t.centerId),t.savingOption){const r=new v.CreateLessonRequest.SavingOption;r.setMethod(t.savingOption.method),e.setSavingOption(r)}const s=t.studentInfoListList.map(r=>{const a=new v.CreateLessonRequest.StudentInfo;return a.setCourseId(r.courseId),a.setStudentId(r.studentId),a.setAttendanceStatus(r.attendanceStatus),a});e.setStudentInfoListList(s);const n=t.mediaIds.map(r=>{const a=new v.Material;return a.setMediaId(r),a});e.setMaterialsList(n)};function Ur(e){const t=new v.CreateLessonRequest;return Kt(t,e),t}function Gr(e){if(!e.lessonId)throw ht;const t=new v.UpdateLessonRequest;return t.setLessonId(e.lessonId),Kt(t,e),t}function xr(e){const t=new v.DeleteLessonRequest;return t.setLessonId(e),t}function qr(e){if(!e.paging)throw ht;const t=new v.RetrieveLessonsRequestV2,s=St(e.paging),n=ke(e.currentTime);t.setPaging(s),t.setCurrentTime(n),t.setLessonTime(e.lessonTime),t.setKeyword(e.keyword),t.setLocationIdsList(e.locationIdsList);const r=e.filter;if(!r)return t;const a=new v.RetrieveLessonsFilterV2;a.setDateOfWeeksList(r.dateOfWeeksList),a.setTimeZone(r.timeZone),a.setCenterIdsList(r.centerIdsList),a.setCourseIdsList(r.courseIdsList),a.setGradesList(r.gradesList),a.setStudentIdsList(r.studentIdsList),a.setTeacherIdsList(r.teacherIdsList);const i=r.fromDate?ke(r.fromDate):null;a.setFromDate(i);const c=r.toDate?ws(r.toDate):null;if(a.setToDate(c),r.fromTime){const u=Ve(r.fromTime);a.setFromTime(u)}if(r.toTime){const u=Ve(r.toTime);a.setToTime(u)}return t.setFilter(a),t}class $r extends X{async createLesson({data:t}){const s=Ur(t);return(await this._call("createLesson",s)).toObject()}async updateLesson({data:t}){const s=Gr(t);return(await this._call("updateLesson",s)).toObject()}async deleteLesson({data:t}){const s=xr(t.lessonId);return(await this._call("deleteLesson",s)).toObject()}async retrieveLessons(t){const s=qr(t);return(await this._call("retrieveLessons",s)).toObject()}}const ge=new $r(Te.LessonManagementServicePromiseClient,G,j),zt=k({query:{lessonsGetOne:({lesson_id:e})=>{if(!e)throw new R({action:"lessonsGetOne",serviceName:"bobGraphQL",errors:[{field:"lesson_id"}]});return Pr.getOneForLessonManagement({lesson_id:e})},lessonsRetrieve:e=>{if(!(e!=null&&e.paging))throw new R({action:"lessonsRetrieve",serviceName:"bobGraphQL",errors:[{field:"paging"}]});return ge.retrieveLessons(e)}},mutation:{lessonsCreate:e=>{const t=st(e);if(A(t))throw new R({action:"lessonsCreate",serviceName:"bobGraphQL",errors:t});return ge.createLesson({data:e})},lessonsUpdate:e=>{const t=st(e);if(e!=null&&e.lessonId||t.push({field:"lessonId"}),A(t))throw new R({action:"lessonsUpdate",serviceName:"bobGraphQL",errors:t});return ge.updateLesson({data:e})},lessonsDelete:e=>{if(!e.lessonId)throw new R({action:"lessonsUpdate",serviceName:"bobGraphQL",errors:[{field:"lessonId"}]});return ge.deleteLesson({data:e})}}}),kr=D`
    query LocationByLocationId($location_id: String!) {
        locations(where: { location_id: { _eq: $location_id } }) {
            location_id
            name
        }
    }
`,Vr=D`
    query LocationListByIds($location_ids: [String!] = []) {
        locations(where: { location_id: { _in: $location_ids } }) {
            name
            location_id
        }
    }
`;class Br extends W{async getOne(t){var n;return(n=(await this._call({query:kr,variables:t})).data)==null?void 0:n.locations[0]}async getMany(t){var n;return(n=(await this._call({query:Vr,variables:t})).data)==null?void 0:n.locations}}const ct=new Br(G,"bobGraphQL",H),Qr=k({query:{locationsGetOne:({location_id:e})=>{if(!e)throw new R({action:"locationsGetOne",serviceName:"bobGraphQL",errors:[{field:"location_id"}]});return ct.getOne({location_id:e})},locationsGetMany:({location_ids:e})=>{const t=!e,s=Array.isArray(e)&&!A(e);if(t||s)throw new R({action:"locationsGetMany",serviceName:"bobGraphQL",errors:[{field:"location_ids"}]});return ct.getMany({location_ids:e})}}}),Wr=D`
    fragment MediaAttrs on media {
        media_id
        resource
        type
        name
    }
`,Hr=D`
    query MediasMany($media_id: [String!] = []) {
        media(where: { media_id: { _in: $media_id } }) {
            ...MediaAttrs
            conversion_tasks(order_by: { created_at: desc }, limit: 1) {
                status
            }
        }
    }
    ${Wr}
`;class Yr extends W{async getMany(t){var n;return(n=(await this._call({query:Hr,variables:t})).data)==null?void 0:n.media}}const jr=new Yr(G,"bobGraphQL",H),Kr=k({query:{mediaGetMany:e=>A(e.media_id)?jr.getMany(e):Qt(void 0)}}),zr=D`
    query PartnerDynamicFormFieldValuesByLessonReportDetailsIdAndStudentId(
        $user_id: String!
        $report_id: String!
    ) {
        get_partner_dynamic_form_field_values_by_student(
            args: { report_id: $report_id, user_id: $user_id }
        ) {
            value_type
            string_value
            string_set_value
            string_array_value
            int_set_value
            int_array_value
            field_id
            bool_value
            int_value
        }
    }
`;class Xr extends W{async getOneByLessonReportDetailsIdAndStudentId(t){var n;return(n=(await this._call({query:zr,variables:t})).data)==null?void 0:n.get_partner_dynamic_form_field_values_by_student}}const Zr=new Xr(G,"bobGraphQL",H),Jr=k({query:{partnerDynamicFormFieldValuesGetOneByLessonReportDetailsIdAndStudentId:e=>{const t=De(e);if(A(t))throw new R({action:"partnerDynamicFormFieldValuesGetOneByLessonReportDetailsIdAndStudentId",serviceName:"bobGraphQL",errors:t});return Zr.getOneByLessonReportDetailsIdAndStudentId(e)}}}),ea=D`
    query PartnerFormConfigsOne($feature_name: String, $school_id: Int) {
        partner_form_configs(
            where: {
                _and: [{ feature_name: { _eq: $feature_name }, partner_id: { _eq: $school_id } }]
            }
            order_by: { created_at: desc }
            limit: 1
        ) {
            form_config_id
            form_config_data
        }
    }
`,ta=D`
    query PartnerFormConfigById($form_config_id: String!) {
        partner_form_configs(where: { form_config_id: { _eq: $form_config_id } }) {
            form_config_data
        }
    }
`;class sa extends W{async getOneLatestConfig(t){var n;return(n=(await this._call({query:ea,variables:t})).data)==null?void 0:n.partner_form_configs[0]}async getOne(t){var n;return(n=(await this._call({query:ta,variables:t})).data)==null?void 0:n.partner_form_configs[0]}}const ut=new sa(G,"bobGraphQL",H),na=k({query:{partnerFormConfigsGetOne:e=>{if(!e.form_config_id)throw new R({action:"partnerFormConfigsGetOne",serviceName:"bobGraphQL",errors:[{field:"form_config_id"}]});return ut.getOne(e)},partnerFormConfigsGetOneLatestConfig:e=>{if(!e.feature_name)throw new R({action:"partnerFormConfigsGetOneLatestConfig",serviceName:"bobGraphQL",errors:[{field:"feature_name"}]});return ut.getOneLatestConfig(e)}}}),ra=D`
    fragment StudentUserAttrs on users {
        user_id
        name
        email
        avatar
    }
`,aa=D(`
    fragment StudentWithoutGradeFrg on users {
        user_id
        name
        email
        phone_number
        country
        last_login_date
    }
`),oa=D`
    query StudentsMany($user_ids: [String!] = []) {
        users(where: { user_group: { _eq: "USER_GROUP_STUDENT" }, user_id: { _in: $user_ids } }) {
            ...StudentUserAttrs
        }
    }
    ${ra}
`,ia=D`
    query GradesOfStudentsList($student_ids: [String!] = []) {
        students(where: { student_id: { _in: $student_ids } }) {
            student_id
            current_grade
            enrollment_status
        }
    }
`,ca=D`
    query StudentsListByFiltersWithoutGradeAndAggregate(
        $name: String
        $email: String
        $limit: Int = 10
        $offset: Int = 0
        $order_by: users_order_by! = { created_at: desc }
        $student_ids: [String!]
        $grades: [smallint!]
        $enrollment_status: String
        $last_login_date: Boolean
    ) {
        users(
            where: {
                name: { _ilike: $name }
                email: { _ilike: $email }
                user_id: { _in: $student_ids }
                user_group: { _eq: "USER_GROUP_STUDENT" }
                last_login_date: { _is_null: $last_login_date }
                student: {
                    current_grade: { _in: $grades }
                    enrollment_status: { _eq: $enrollment_status }
                }
            }
            limit: $limit
            offset: $offset
            order_by: [$order_by]
        ) {
            ...StudentWithoutGradeFrg
        }
    }
    ${aa}
`,ua=D`
    query CountStudentWithFilter(
        $name: String
        $email: String
        $grades: [smallint!]
        $student_ids: [String!]
        $enrollment_status: String
        $last_login_date: Boolean
    ) {
        users_aggregate(
            where: {
                name: { _ilike: $name }
                email: { _ilike: $email }
                user_id: { _in: $student_ids }
                user_group: { _eq: "USER_GROUP_STUDENT" }
                last_login_date: { _is_null: $last_login_date }
                student: {
                    current_grade: { _in: $grades }
                    enrollment_status: { _eq: $enrollment_status }
                }
            }
        ) {
            aggregate {
                count(columns: user_id)
            }
        }
    }
`;class da extends W{async getMany(t){var r;const{user_ids:s}=t;return(r=(await this._call({query:oa,variables:{user_ids:s}})).data)==null?void 0:r.users}async getGradesOfStudentsList(t){var n;return(n=(await this._call({query:ia,variables:{student_ids:t.student_ids}})).data)==null?void 0:n.students}async getListWithFilter(t){var u;const c=t,{name:s,email:n,grades:r}=c,a=Q(c,["name","email","grades"]);return(u=(await this._call({query:ca,variables:U(g({},a),{grades:r,name:oe(s),email:oe(n)})})).data)==null?void 0:u.users}async getCountStudentWithFilter(t){const c=t,{name:s,email:n,grades:r}=c,a=Q(c,["name","email","grades"]);return(await this._call({query:ua,variables:U(g({},a),{grades:r,name:oe(s),email:oe(n)})})).data}}const Se=new da(G,"bobGraphQL",H),la=k({query:{studentsGetMany:e=>{const{user_ids:t}=e,s=!t,n=Array.isArray(t)&&!A(t);if(s||n)throw new R({action:"studentsGetMany",serviceName:"bobGraphQL",errors:[{field:"user_ids"}]});return Se.getMany(e)},studentsGetGradesOfStudent:e=>{const{student_ids:t}=e,s=!t,n=Array.isArray(t)&&!A(t);if(s||n)throw new R({action:"studentsGetGradesOfStudent",serviceName:"bobGraphQL",errors:[{field:"student_ids"}]});return Se.getGradesOfStudentsList(e)},studentsGetListWithFilter:e=>Se.getListWithFilter(e),studentsGetCountStudentWithFilter:e=>Se.getCountStudentWithFilter(e)}}),ma=D`
    query TeacherMany($user_id: [String!] = [], $school_id: Int = 0) {
        find_teacher_by_school_id(
            args: { school_id: $school_id }
            where: { user_id: { _in: $user_id } }
        ) {
            name
            email
            user_id
        }
    }
`;class pa extends W{async getMany(t){var n;return(n=(await this._call({query:ma,variables:t})).data)==null?void 0:n.find_teacher_by_school_id}}const _a=new pa(G,"bobGraphQL",H),fa=k({query:{teachersGetMany:e=>{const{user_id:t}=e,s=!t,n=Array.isArray(t)&&!A(t);if(s||n)throw new R({action:"teachersGetMany",serviceName:"bobGraphQL",errors:[{field:"user_id"}]});return _a.getMany(e)}}}),ga=D`
    fragment CourseStudentAttrs on course_students {
        student_id
        course_id
    }
`,Sa=D`
    query CourseStudentsListByCourseIds($course_ids: [String!]) {
        course_students(
            order_by: { created_at: desc }
            where: { course_id: { _in: $course_ids } }
        ) {
            ...CourseStudentAttrs
        }
        course_students_aggregate(where: { course_id: { _in: $course_ids } }) {
            aggregate {
                count
            }
        }
    }
    ${ga}
`;class ha extends W{async getListWithFilter(t){return(await this._call({query:Sa,variables:t})).data}}const ya=new ha(G,"eurekaGraphQL",H),La=k({query:{courseStudentsGetListWithFilter:e=>{const{course_ids:t}=e,s=!t,n=Array.isArray(t)&&!A(t);if(s||n)throw new R({action:"courseStudentsGetListWithFilter",serviceName:"eurekaGraphQL",errors:[{field:"course_ids",fieldValueIfNotSensitive:t}]});return ya.getListWithFilter(e)}}});function Ea(e){return Promise.resolve(e)}function Ta(e){var n,r;if(!e)return{created_at:vs.Desc};const t=yt(e);if(!((n=t[0])!=null&&n.order)||!((r=t[0])!=null&&r.field))return e;let s={};return t.map(a=>{s[a.field]=a.order.toLowerCase()}),s}const ba=D`
    fragment StudentAttrsWithListStudentId on student_packages {
        properties
        student_package_id
        student_id
        end_at
        start_at
    }
`,Ia=D`
    query User_StudentPackagesByListStudentIdV2(
        $student_ids: [String!] = []
        $order_by: student_packages_order_by! = { created_at: desc }
    ) {
        student_packages(where: { student_id: { _in: $student_ids } }, order_by: [$order_by]) {
            ...StudentAttrsWithListStudentId
            location_ids
        }
    }
    ${ba}
`;class Aa extends W{async getList(t){var n;return(n=(await this._call({query:Ia,variables:t})).data)==null?void 0:n.student_packages}}const wa=new Aa(G,"fatimaGraphQL",H),Xt=k({query:{studentPackagesGetList:e=>{const{filter:t={},sort:s}=e,{student_ids:n}=t,r=!n,a=Array.isArray(n)&&!A(n);if(r||a)throw new R({action:"studentPackagesGetList",serviceName:"fatimaGraphQL",errors:[{field:"student_ids"}]});return wa.getList({student_ids:t.student_ids,order_by:Ta(s)})}}});function va(e){const t=new Cs.RetrieveLowestLevelLocationsRequest;return t.setName(e.name),t.setLimit(e.limit),t.setOffset(e.offset),t}class Ma extends X{async retrieveLowestLevelLocations(t){const s=va(t);return{data:(await this._call("retrieveLowestLevelLocations",s)).toObject().locationsList}}}const Ca=new Ma(Ms.MasterDataReaderServicePromiseClient,G,j),Ra=k({query:{locationsRetrieveLowestLevelLocations:e=>{const{limit:t,offset:s}=e,n=Ht({limit:t,offset:s});if(A(n))throw new R({action:"locationsRetrieveLowestLevelLocations",serviceName:"masterGraphQL",errors:n});return Ca.retrieveLowestLevelLocations(e)}}}),Zt={media:Kr,courses:dr,lessons:zt,students:la,teachers:fa,locations:Qr,lessonGroups:fr,lessonReports:jt,lessonMembers:yr,partnerFormConfigs:na,lessonStudentSubscriptions:Fr,partnerDynamicFormFieldValues:Jr,studentPackages:Xt,courseStudents:La,locationsMaster:Ra},ye=Bt(Zt),Oa=sr(Zt),Fa={showSnackbar(e){return{type:"SHOW_SNACKBAR",payload:e}},hideSnackbar(){return{type:"HIDE_SNACKBAR"}}},Na=e=>typeof e=="object"?g({},e):{key:e};function se(){const e=Rs();return h.exports.useCallback((s,n)=>{const{key:r,options:a}=Na(s);e(Fa.showSnackbar({message:r,options:a,severity:n}))},[e])}function Da(e){const t=new Fs.ConvertMediaRequest;return e.mediaList=e.mediaList.filter(s=>s.type===Lt.MEDIA_TYPE_PDF),e.mediaList.forEach(s=>{const n=new Ns.Media;n.setType(Ds.MediaType[s.type]),n.setResource(s.resource),s.name&&n.setName(s.name),s.media_id&&n.setMediaId(s.media_id),t.addMedia(n)}),t}class Pa extends X{async convertMedia({data:t}){const s=Da(t);return await this._call("convertMedia",s),{data:{id:null}}}}const Ua=new Pa(Os.ClassModifierServicePromiseClient,G,j),Ga=k({mutation:{classesConvertMedia:e=>{var t;if(!A((t=e.data)==null?void 0:t.mediaList))throw new R({action:"classesConvertMedia",serviceName:"bobGraphQL",errors:[{field:"mediaList"}]});return Ua.convertMedia(e)}}});function xa(e){const t=new Qe.UpsertMediaRequest;return yt(e).forEach(n=>{const r=new Qe.Media;r.setName(n.name),r.setResource(n.resource),r.setType(n.type),t.addMedia(r)}),t}class qa extends X{async upsertMedia(t){const s=xa(t),r=(await this._call("upsertMedia",s)).toObject();return{data:U(g({},r),{id:r.mediaIdsList[0]})}}}const $a=new qa(Ps.ClassPromiseClient,G,j);function ka(e){const{name:t,type:s}=e,n=new $s.ResumableUploadURLRequest,r=new ks.Duration;return r.setSeconds(30*60),n.setExpiry(r),n.setPrefixName(nr(t).replace(/\s/g,"")),n.setFileExtension(Wt(t)),n.setAllowOrigin(window.location.origin),n.setContentType(s),n}const Va=({apiRequestUrl:e,videoId:t})=>{const s=new Tt.FinishUploadBrightCoveRequest;return s.setApiRequestUrl(e),s.setVideoId(t),s},Ba=e=>{const t=new Tt.CreateBrightCoveUploadUrlRequest;return t.setName(e),t};class Qa extends X{async finishUploadBrightcove(t){const s=Va(t);await this._call("finishUploadBrightCove",s)}async createBrightCoveUploadUrl(t){const s=Ba(t);return(await this._call("createBrightCoveUploadUrl",s)).toObject()}async uploadBrightcove(t){return Promise.all(t.map(async s=>{const n=await this.createBrightCoveUploadUrl(s.name);return await Et.put(n.signedUrl,s,{headers:{"Content-Type":""}}),await this.finishUploadBrightcove(n),n.videoId}))}}const Wa=new Qa(Us.CourseServicePromiseClient,G,j);class Ha extends X{async putResumableUrl({resumableUploadUrl:t,file:s}){await Et.put(t,s,{})}async generateResumableUploadURL(t){try{return await Promise.all(t.files.map(async n=>{if(n.size>xs)throw new Error("resources.input.pleaseUploadFileSizeSmaller");const r=ka(n),a=await this._call("generateResumableUploadURL",r),i=a.getResumableUploadUrl();return await this.putResumableUrl({resumableUploadUrl:i,file:n}),{gRPC:a.toObject(),file:n}}))}catch(s){throw s}}async uploadFiles(t){const{others:s,videos:n}=qs({files:t}),a=(await this.generateResumableUploadURL({files:s})).map(p=>We({url:p.gRPC.downloadUrl,name:p.file.name,type:p.file.type})),i=await Wa.uploadBrightcove(n),c=n.map((p,_)=>{const{name:m,type:S}=p,l=i[_];return We({name:m,type:S,url:l})}),u=[...a,...c];return{mediaIds:(await $a.upsertMedia(u)).data.mediaIdsList,attachments:u}}async filterAndUploadFiles(t){const{alreadyUploadedMediaIds:s,filesNeedToBeUploaded:n}=ar(t||[]);let r=s,a=[];if(n&&A(n)){const i=await this.uploadFiles(n);r=[...r,...i.mediaIds],a=i.attachments}return{data:{attachments:a,mediaIds:r}}}}const Ya=new Ha(Gs.UploadServicePromiseClient,G,j),Jt=k({mutation:{uploadFilterAndUploadFiles:e=>A(e)?Ya.filterAndUploadFiles(e):Ea({data:{attachments:[],mediaIds:[]}})}});function ja(e){const{courseId:t,lessonGroupId:s,mediaIds:n,newMediaIds:r}=e,a=new Qs.AttachMaterialsToCourseRequest;return a.setCourseId(t),a.setLessonGroupId(s),a.setMaterialIdsList([...n,...r]),a}class Ka extends X{async attachMaterialsToCourse({courseId:t,lessonGroupId:s,mediaIds:n,files:r}){if(!t||!s)throw new Bs("Invalid request");const{data:{mediaIds:a}}=await Jt.mutation.uploadFilterAndUploadFiles(r),i=ja({courseId:t,lessonGroupId:s,mediaIds:n,newMediaIds:a});return await this._call("attachMaterialsToCourse",i),{data:{newMediaIds:a,mediaIds:n}}}}const za=new Ka(Vs.CourseModifierServicePromiseClient,G,j),Xa=k({mutation:{coursesAttachMaterialsToCourse:e=>{const{courseId:t,lessonGroupId:s}=e,n=[];if(t||n.push({field:"courseId",fieldValueIfNotSensitive:t}),s||n.push({field:"lessonGroupId",fieldValueIfNotSensitive:s}),A(n))throw new R({action:"coursesAttachMaterialsToCourse",serviceName:"yasuoGraphQL",errors:n});return za.attachMaterialsToCourse(e)}}}),Za={classes:Ga,courses:Xa,lessons:zt,lessonReports:jt,studentPackage:Xt,upload:Jt},Ce=Jn(Za),es=h.exports.forwardRef((e,t)=>{const Y=e,{label:s,options:n,loading:r,disabled:a,required:i,helperText:c,placeholder:u,optionLabelKey:d,onChange:p,renderTags:_,error:m,name:S,optionImage:l,optionHelperText:f,disableCloseOnSelect:E=!1,size:I="small",limitChipText:M=10,startAdornment:C,renderOption:T,getOptionSelectedField:y,translateFLag:w}=Y,L=Q(Y,["label","options","loading","disabled","required","helperText","placeholder","optionLabelKey","onChange","renderTags","error","name","optionImage","optionHelperText","disableCloseOnSelect","size","limitChipText","startAdornment","renderOption","getOptionSelectedField","translateFLag"]),O=q(),F=M==="Ellipsis"||w,b=h.exports.useMemo(()=>w?O:x=>x,[w,O]),P=h.exports.useCallback((x,B)=>typeof _=="function"?_(x,B):o.createElement(o.Fragment,null,x.map((Z,ae)=>{const Ge=b(re(Z,d,!0));return o.createElement(V,{key:`${Ge}-${ae}`,sx:{padding:"2px"},maxWidth:"100%","data-testid":"AutocompleteBase__tagBox"},o.createElement(bt,g({avatar:eo(Z,d,l),label:M==="Ellipsis"?Ge:It(b(re(Z,d,F)),M)},B({index:ae}))))})),[M,l,d,_,b,F]),$=h.exports.useCallback((x,B,Z)=>{if(T)return T(x,B,Z);const ae=b(re(B,d,F));return o.createElement(V,g({component:"li",display:"flex",alignItems:"center",gap:2,"data-testid":"AutocompleteBase__option",key:Ws()},x),l&&o.createElement(N,{item:!0},o.createElement(At,{size:"huge",src:ee(B,l),text:re(B,d,F)})),o.createElement(N,{item:!0},o.createElement(wt,{variant:"body1",sx:He},ae),f&&o.createElement(ce,{variant:"caption",component:"p",sx:He,"data-testid":`AutocompleteSuggestionItem__helperText__${ae}`},b(ee(B,f,F)))))},[f,l,d,T,F,b]),te=h.exports.useCallback((x,B)=>Ja(y)(x,B),[y]);return o.createElement(Hs,U(g({disableClearable:!0,isOptionEqualToValue:te},L),{fullWidth:!0,disableCloseOnSelect:E,disabled:a,options:n,loading:r,getOptionLabel:x=>b(re(x,d,F)),renderOption:$,renderTags:P,ListboxProps:g({"data-testid":"AutocompleteBase__listBox"},L.ListboxProps),renderInput:x=>o.createElement(Re,U(g({},x),{fullWidth:!0,size:I,helperText:c,error:m,required:i,variant:"outlined",label:s?O(s):"",name:S,placeholder:u,inputProps:g({"data-testid":"AutocompleteBase__input"},x.inputProps),FormHelperTextProps:{variant:"standard"},InputProps:U(g({},x.InputProps),{startAdornment:C||x.InputProps.startAdornment,endAdornment:o.createElement(o.Fragment,null,r?o.createElement(Ys,{"data-testid":"AutocompleteBase__loading",color:"inherit",size:15}):x.InputProps.endAdornment)})})),onChange:p}))});function re(e,t,s){return typeof t=="function"?t(e):s?ee(e,t):js(It(ee(e,t),30))}function Ja(e="id"){return(t,s)=>vt(ee(t,e,t),ee(s,e,s))}function eo(e,t,s){if(!!s)return o.createElement(At,{src:ee(e,s),text:re(e,t)})}const to=e=>{const r=e,{onChange:t}=r,s=Q(r,["onChange"]),n=z(K.LESSON_MANAGEMENT);return o.createElement(es,U(g({},s),{optionLabelKey:"label",options:Kn(n),onChange:(a,i)=>{Qn(i)&&t(i)}}))};function so(){return{featureController:Ks}}const Mi=(e,t=!0)=>{const{featureController:s}=so(),[n,r]=h.exports.useState(s.isFeatureEnabled(e));return h.exports.useEffect(()=>{!t||s.subscribeToRemoteChanges(()=>{r(s.isFeatureEnabled(e))})},[s,t,e]),{isEnabled:n}},no=Array.from(Array(17).keys()),ts=()=>{const e=no.map(s=>({id:s,name:`resources.choices.grades.${s}`}));return{choiceGrades:h.exports.useMemo(()=>{const s=[...e],n=s.shift();return n&&s.push(n),s},[e])}};function ss(){const{choiceGrades:e}=ts();return{getStudentGradeName:h.exports.useCallback(s=>{var n;return(n=e.find(r=>r.id===s))==null?void 0:n.name},[e])}}const ns=_=>{var m=_,{size:e="small",rules:t,defaultValue:s,required:n,optionLabelKey:r,disableClearable:a,multiple:i,name:c,onChange:u,shouldShowHelperText:d=!0}=m,p=Q(m,["size","rules","defaultValue","required","optionLabelKey","disableClearable","multiple","name","onChange","shouldShowHelperText"]);const S=h.exports.useMemo(()=>typeof s!="undefined"?s:i?[]:null,[i,s]);return o.createElement(Mt,{variant:"outlined",fullWidth:!0,size:e},o.createElement(ue,{name:c,rules:t,render:M=>{var C=M,{field:T}=C,y=T,{onChange:l,value:f}=y,E=Q(y,["onChange","value"]),{fieldState:{error:I}}=C;return o.createElement(es,g(g({required:n,multiple:i,value:f!=null?f:null,size:e,defaultValue:S,optionLabelKey:r,disableClearable:a,error:Boolean(I),helperText:I&&d?I.message:void 0,onChange:(w,L,O)=>{if(!(i&&O==="createOption"))return u&&u(w,L,O),l(L)}},p),E))}}))};function ro(e,t){const s=e[0];return s?t?[s]:s:t?[]:null}function ao(e,t){return!(t&&Array.isArray(e)?e.length:e)}function oo({searchFields:e,optionHelperText:t,optionLabelKey:s,inputVal:n,filterFields:r}){let i=Ye({},t||s,n);return A(e)&&(e==null||e.forEach(c=>{i=Ye(i,c,n)})),r&&Object.keys(r).length&&(i=g(g({},i),r)),i}const io=({optionLabelKey:e="name",resource:t,optionHelperText:s,firstOptions:n=[],multiple:r=!0,name:a,setDefaultValue:i,searchFields:c,limitChipText:u,filterFields:d,providerTypes:p=Ct.MANY_REFERENCE})=>{const[_,m]=h.exports.useState(""),[S,l]=h.exports.useState([]),[f,E]=Oe(!0),I=q(),{setValue:M,formState:{isDirty:C},clearErrors:T,setError:y}=de(),w=h.exports.useMemo(()=>zs(m,Xs),[m]),L=Rt(),O=h.exports.useRef(!1);Zs(()=>{O.current=!0});const F=h.exports.useMemo(()=>oo({searchFields:c,optionLabelKey:e,optionHelperText:s,inputVal:_,filterFields:d}),[d,_,s,e,c]);h.exports.useEffect(()=>{(async()=>{var te;try{T(a),E(!0);const{data:Y=[]}=await L(p,t,{target:"target_id",id:"id",filter:F,pagination:{perPage:30,page:1},sort:{order:Js.DESC,field:"created_at"}});if(!Y||!Y.length||!Array.isArray(Y))return;const x=Y.map(B=>g({value:re(B,e,u==="Ellipsis")},B));O.current||l(x)}catch(Y){(te=window.warner)==null||te.log("useAutocompleteReference",Y),O.current||y(a,{type:"manual",message:I("ra.message.unableToLoadData")})}finally{O.current||E(!1)}})()},[I,T,_,e,L,t,s,E,y,a,JSON.stringify(F)]);const b=h.exports.useMemo(()=>[...n,...S],[n,S]),P=h.exports.useMemo(()=>ro(b,r),[b,r]),$=be({defaultValue:P,name:a});return h.exports.useEffect(()=>{!(ao($,r)&&a&&P&&i&&!C)||O.current||M(a,P,{shouldValidate:!0,shouldDirty:!1})},[P,i,r,a,M,$,C]),{loading:f,options:b,setInputVal:w,defaultValue:P}},co=l=>{var f=l,{optionLabelKey:e="name",resource:t,optionHelperText:s,firstOptions:n=[],multiple:r=!0,name:a,rules:i,setDefaultValue:c,searchFields:u,limitChipText:d,filterFields:p,onInputChange:_,providerTypes:m}=f,S=Q(f,["optionLabelKey","resource","optionHelperText","firstOptions","multiple","name","rules","setDefaultValue","searchFields","limitChipText","filterFields","onInputChange","providerTypes"]);const{options:E,setInputVal:I,loading:M}=io({optionHelperText:s,optionLabelKey:e,firstOptions:n,resource:t,name:a,multiple:r,setDefaultValue:c,searchFields:u,limitChipText:d,filterFields:p,providerTypes:m});return o.createElement(ns,U(g({"data-testid":"AutocompleteReferenceHF"},S),{limitChipText:d,name:a,multiple:r,loading:M,optionHelperText:s,optionLabelKey:e,options:E,onInputChange:(C,T,y)=>{C&&(I(T),_&&_(C,T,y))},rules:i,filterOptions:C=>C,filterSelectedOptions:!0,onChange:()=>I("")}))},Pe=e=>o.createElement(co,g({},e)),uo=e=>o.createElement(Pe,U(g({},e),{optionLabelKey:"name","data-testid":"LocationsLowestLevelAutocompleteHF__autocomplete",id:"LocationsLowestLevelAutocompleteHF__autocomplete",resource:le.LOCATIONS,searchFields:["name"]})),lo=e=>o.createElement(Pe,U(g({},e),{optionLabelKey:"name",optionHelperText:"email","data-testid":"TeachersAutocompleteHF__autocomplete",id:"TeachersAutocompleteHF__autocomplete",resource:le.TEACHERS,searchFields:["name","email"]})),rs=e=>typeof e=="string",mo=e=>o.createElement(en,g({},e)),po=e=>{const t="yyyy/LL/dd",T=e,{id:s,name:n,rules:r,inputFormat:a=t,size:i="small",onAccept:c,onChange:u,shouldShowHelperText:d=!0,DialogProps:p,label:_}=T,m=Q(T,["id","name","rules","inputFormat","size","onAccept","onChange","shouldShowHelperText","DialogProps","label"]),{getValues:S}=de(),[l,f]=Oe(!1),E=S(n)?Ot(S(n)):null,I=()=>f(!0),M=q(),C=(y,{onChange:w})=>{E||(w(null),u&&u(null)),y&&(w(he(y)),u&&u(y),c&&c(y)),f(!1)};return o.createElement(ue,{name:n,render:({field:y,fieldState:{error:w}})=>o.createElement(mo,g({toolbarFormat:"yyyy/LL/dd",DialogProps:g({"aria-label":"DatePickerHF__dialog"},p),value:y.value,inputFormat:a,rightArrowButtonText:"Next month",leftArrowButtonText:"Previous month",open:l,onClose:()=>f(!1),onAccept:L=>{C(L,y)},onChange:L=>{y.onChange(he(L)),u&&u(L)},cancelText:M("ra.common.action.cancel"),okText:M("ra.common.action.OK"),renderInput:L=>{var O;return o.createElement(Re,U(g({},L),{variant:"outlined",id:s,name:n,size:i,helperText:Boolean(w)&&d?w==null?void 0:w.message:"",FormHelperTextProps:{variant:"standard"},required:(O=m.InputProps)==null?void 0:O.required,error:Boolean(w),onClick:I,inputProps:g({"data-testid":"DatePickerHF__input"},L.inputProps),InputProps:g({readOnly:!0,endAdornment:o.createElement(Ft,{position:"end"},o.createElement(Nt,{"data-testid":"DatePickerHF__openPickerButton",edge:"end",onClick:I,role:"button",sx:{width:44,height:44}},o.createElement(tn,null)))},L.InputProps)}))},label:rs(_)?M(_):_},m)),rules:r})},_o=e=>o.createElement(sn,g({},e)),dt=e=>{const t="HH:mm",T=e,{name:s,rules:n,inputFormat:r=t,size:a="small",onAccept:i,onChange:c,DialogProps:u,id:d,InputLabelProps:p,label:_}=T,m=Q(T,["name","rules","inputFormat","size","onAccept","onChange","DialogProps","id","InputLabelProps","label"]),{getValues:S}=de(),l=q(),f=S(s)?Ot(S(s)):null,[E,I]=Oe(!1),M=()=>I(!0),C=(y,{onChange:w})=>{f||(w(null),c&&c(null)),y&&(w(he(y)),c&&c(y),i&&i(y)),I(!1)};return o.createElement(ue,{name:s,render:({field:y,fieldState:{error:w}})=>o.createElement(_o,g({ampm:!0,value:y.value,DialogProps:g({"aria-label":"TimePickerHF__dialog"},u),inputFormat:r,open:E,onClose:()=>I(!1),onAccept:L=>C(L,y),onChange:L=>{y.onChange(he(L)),c&&c(L)},cancelText:l("ra.common.action.cancel"),okText:l("ra.common.action.OK"),renderInput:L=>{var O;return o.createElement(Re,U(g({},L),{variant:"outlined",size:a,name:s,id:d,InputLabelProps:g(g({},L.InputLabelProps),p),FormHelperTextProps:{variant:"standard"},helperText:w?w.message:"",required:(O=m.InputProps)==null?void 0:O.required,error:Boolean(w),onClick:M,InputProps:g({readOnly:!0,endAdornment:o.createElement(Ft,{position:"end"},o.createElement(Nt,{size:"large",edge:"end",sx:{width:44,height:44},onClick:M},o.createElement(nn,null)))},L.InputProps)}))},label:rs(_)?l(_):_},m)),rules:n})},fo=e=>o.createElement(rn,g({},e)),go=e=>o.createElement(an,g({},e)),lt=n=>{var r=n,{size:e="small",sxRadio:t}=r,s=Q(r,["size","sxRadio"]);const m=s,{defaultValue:a="",name:i,onChange:c,options:u,rules:d}=m,p=Q(m,["defaultValue","name","onChange","options","rules"]),_=q();return o.createElement(Mt,{variant:"outlined",fullWidth:!0,size:e},o.createElement(ue,{rules:d,defaultValue:a,name:i,render:({field:{onChange:S,value:l},fieldState:{error:f}})=>o.createElement("div",null,o.createElement(go,g({onChange:(E,I)=>{S(E),c&&c(E,I)},row:!0,defaultValue:`${a}`,value:l},p),o.createElement(N,{container:!0,spacing:1},u.map(E=>o.createElement(N,{item:!0,key:E.id},o.createElement(on,{control:o.createElement(fo,{sx:t,"data-testid":`Radio__${E.id}`,size:e,color:"primary"}),label:_(E.value),name:E.value,value:`${E.id}`}))))),f&&o.createElement(cn,{variant:"standard",error:!0},f.message))}))};function So(e,t,s,n){const{register:r,setValue:a}=de(),[i,c]=h.exports.useState(t);return h.exports.useEffect(()=>{r(e,s),a(e,t)},[]),[i,h.exports.useCallback(u=>{c(u),a(e,u,n)},[e,a,n])]}const ho=e=>{const[t,s]=So("materialsList",e.defaultMaterialsList||[]);return o.createElement(Tn,{files:t,onChange:s,variant:"outlined",isBrightCoveOptional:!0,formUploadFileProps:{multiple:!0}})},yo=e=>o.createElement(Pe,U(g({id:"CoursesAutocompleteHF__autocomplete","data-testid":"CoursesAutocompleteHF__autocomplete"},e),{resource:le.COURSES})),Lo=s=>{var n=s,{firstOptions:e}=n,t=Q(n,["firstOptions"]);const{choiceGrades:r}=ts(),a=e?un([e,...r]):[...r],i=q();return o.createElement(ns,g({id:"GradesAutocompleteHF__autocomplete","data-testid":"GradesAutocompleteHF__autocomplete",key:"grade",label:i(`resources.${le.STUDENTS}.colGrade`),options:a,optionLabelKey:"name",isOptionEqualToValue:(c,u)=>c.id===u.id,translateFLag:!0},t))},Eo=e=>{const{filterNameApplied:t,onDelete:s,onClearAll:n}=e,r=q();return o.createElement(V,{display:"flex",alignItems:"center"},o.createElement(wt,{variant:"body2"},`${r("resources.common.youFilterBy")} :`),o.createElement(V,{mx:1,display:"flex"},t.map(a=>{const i=a.chipLabel?a.chipLabel:r(a.inputLabel);return o.createElement(V,{key:a.name,mx:.5},o.createElement(bt,{"data-testid":"FormFilterAdvancedChipList__chipItem",label:i,onDelete:()=>s(a.name)}))})),o.createElement(dn,{"data-testid":"FormFilterAdvancedChipList__buttonClearAll",onClick:n},r("resources.button.clearAll")))},To="560px",bo=e=>{const t=q(),{children:s,isDisableReset:n,isDisableApply:r,filterNameApplied:a,onEnterSearchBar:i,onReset:c,onDelete:u,onApply:d,onClosePopover:p,inputSearchPlaceholder:_=t("resources.common.enterYourKeyword"),defaultSearchKeyword:m="",width:S}=e,l=h.exports.useMemo(()=>!!s,[s]);return o.createElement(V,{"data-testid":"FormFilterAdvanced__root"},o.createElement(V,{sx:{width:S==="fullWidth"?"100%":To,maxWidth:"100%"},display:"flex",alignItems:"center"},o.createElement(V,{flexGrow:1,display:"flex"},o.createElement(ln,{isCustom:l,placeholder:_,onEnter:i,"data-testid":"FormFilterAdvanced__textField",defaultValue:m}),l&&o.createElement(mn,{dropdownContent:s,onResetFilter:c,onApplyFilter:d,onClosePopover:p,isDisableReset:n,isDisableApply:r},t("ra.common.action.filter")))),A(a)&&o.createElement(V,{mt:2},o.createElement(Eo,{filterNameApplied:a,onClearAll:c,onDelete:u})))},Io=e=>{const{isNoData:t,defaultValue:s,filterFieldObjects:n,onApplySubmit:r,reset:a,watch:i,getValues:c,defaultFilterAppliedObjects:u=[],onSetFilterAppliedObjects:d}=e,p=q(),_=se(),[m,S]=h.exports.useState(u),l=i(),f=h.exports.useCallback(()=>{S([]),d&&d([]),a(s),r(s)},[s,r,d,a]),E=h.exports.useCallback(()=>a(l),[l,a]),I=h.exports.useCallback(T=>{const y=Object.keys(n),w=c();return y.map(O=>{const F=w[O],b=Array.isArray(F)?A(F):!!F;if(!T){const P=m.some($=>$.name===O&&$.isApplied);return U(g({},n[O]),{isApplied:b&&P})}return U(g({},n[O]),{isApplied:b})}).filter(O=>O.isApplied)},[m,n,c]),M=h.exports.useCallback(T=>{const y=n[T].defaultValue,w=U(g({},l),{[T]:y});a(w);const L=I(!1);S(L),d&&(d==null||d(L)),r(w)},[n,I,l,r,d,a]),C=h.exports.useCallback(T=>{if(t){m.some(L=>L.isApplied)&&f(),_(p("ra.message.invalidSearchQueryReturningAllItems"),"info");return}const y=I(!0);S(y),d&&(d==null||d(y)),r(T)},[m,I,f,t,r,d,_,p]);return{filterApplied:m,onReset:f,onApply:C,onDelete:M,onClosePopover:E}},Ci=e=>{if(!e)return null;const t=new Date(e);return Me.fromJSDate(t).isValid?e.toString():null},ne={grades:{name:"grades",inputLabel:"resources.lesson_management.columns.grade",isApplied:!1,defaultValue:[]},courses:{name:"courses",inputLabel:"resources.lesson_management.course",isApplied:!1,defaultValue:[]}},Ao=e=>{const{onApplySubmit:t,onEnterSearchBar:s}=e,n={courses:ne.courses.defaultValue,grades:ne.grades.defaultValue},r=Dt({defaultValues:n}),{courses:a,grades:i}=be(g({},r)),c=h.exports.useMemo(()=>!(A(a)||A(i)),[a,i]),{filterApplied:u,onDelete:d,onApply:p,onReset:_,onClosePopover:m}=Io(g({defaultValue:n,isNoData:c,filterFieldObjects:ne,onApplySubmit:t},r));return o.createElement(pn,g({},r),o.createElement(bo,{isDisableReset:c,filterNameApplied:u,onEnterSearchBar:s,onDelete:d,onReset:_,onApply:r.handleSubmit(p),onClosePopover:m},o.createElement(V,{width:512},o.createElement(N,{container:!0,spacing:2},o.createElement(N,{item:!0,xs:6},o.createElement(Lo,{label:ne.grades.inputLabel,name:ne.grades.name,size:"small",disableCloseOnSelect:!0,filterSelectedOptions:!0,multiple:!0,fullWidth:!0,getOptionSelectedField:"id"})),o.createElement(N,{item:!0,xs:6},o.createElement(yo,{label:ne.courses.inputLabel,name:ne.courses.name,size:"small",disableCloseOnSelect:!0,filterSelectedOptions:!0,getOptionSelectedField:"course_id"}))))))},wo=({content:e,loading:t=!1,dataTestId:s="TableStudentSubscriptions__rowContent"})=>t?o.createElement(Ut,null):o.createElement(Fe,{variant:"body2","data-testid":s},e),vo=e=>{const{studentInfoList:t,pagination:s,onSelect:n,selectedStudentInfoList:r,isLoadingStudentsCourses:a,isLoadingGrades:i}=e,c=z(K.LESSON_MANAGEMENT),u=q(),{getStudentGradeName:d}=ss(),p=h.exports.useMemo(()=>[{key:"studentNameKey",title:c("columns.studentName"),render:m=>o.createElement(ie,{variant:"body2",maxLines:2,"data-testid":"TableStudentSubscriptions__studentName"},m.student.studentName),cellProps:{style:{width:"auto"}}},{key:"courseNameKey",title:c("columns.courseName"),render:m=>o.createElement(ie,{variant:"body2",maxLines:2,"data-testid":"TableStudentSubscriptions__courseName"},m.course.courseName),cellProps:{style:{width:"35%"}}},{key:"gradeNameKey",title:c("columns.grade"),render:m=>wo({content:u(d(m.grade)||""),loading:i,dataTestId:"TableStudentSubscriptions__grade"}),cellProps:{style:{width:"10%"}}}],[d,i,c,u]);return o.createElement(Pt,{columns:p,data:t,listSelectedItems:r,onSelect:_=>n(_),body:{loading:a,skeCount:3,rowKey:"studentSubscriptionId",pagination:s},footer:{pagination:s},withIndex:!0,tableProps:{"data-testid":"TableStudentSubscriptions__tableContainer"}})},Mo=new Map;function Co(e){const t=se(),{data:s=Mo,isFetching:n,refetch:r}=ye({entity:"students",action:"studentsGetGradesOfStudent"})({student_ids:e},{enabled:A(e),selector(a){const i=new Map;return(a||[]).forEach(c=>{i.set(c.student_id,c)}),i},onError:a=>{var i;(i=window.warner)==null||i.warn("useGetGradeOfStudents get student",a),t("ra.message.unableToLoadData","error")}});return{mapGradeOfStudents:s,isLoading:n,refetch:r}}const Ro={grades:[],courses:[]},mt={limit:5,offsetInteger:0,offsetString:""},Oo=(e=mt.limit)=>{const[t,s]=h.exports.useState(""),[n,r]=h.exports.useState(Ro),a=n.courses.map(b=>b.course_id),i=n.grades.map(b=>`${b.id}`),c=q(),u=se(),d={filter:{courseIdList:a,gradeList:i,classIdList:[],locationIdList:[]},keyword:t},{results:{data:p,isFetching:_},goToFirstPage:m,pagination:S}=Oa({entity:"lessonStudentSubscriptions",action:"lessonStudentSubscriptionsRetrieveStudentSubscription"})(d,{enabled:Boolean(d),defaultPaging:U(g({},mt),{limit:e}),onError:b=>{var P;u(c("ra.message.unableToLoadData"),"error"),(P=window.warner)==null||P.warn(`Error useLessonStudentSubscriptionsListFilter student subscriptions: ${b.message}`)}}),l=h.exports.useMemo(()=>p?p.itemsList:[],[p]),f=h.exports.useMemo(()=>l.map(b=>b.studentId),[l]),E=h.exports.useMemo(()=>l.map(b=>b.courseId),[l]),{data:I,isFetching:M}=ye({entity:"students",action:"studentsGetMany"})({user_ids:f},{enabled:A(f),onError:b=>{var P;u(c("ra.message.unableToLoadData"),"error"),(P=window.warner)==null||P.warn(`Error useLessonStudentSubscriptionsListFilter students: ${b.message}`)}}),{data:C,isFetching:T}=ye({entity:"courses",action:"coursesGetMany"})({course_id:E},{enabled:A(E),onError(b){var P;u(c("ra.message.unableToLoadData"),"error"),(P=window.warner)==null||P.warn(`Error useLessonStudentSubscriptionsListFilter courses: ${b.message}`)}}),{mapGradeOfStudents:y,isLoading:w}=Co(f);return{data:h.exports.useMemo(()=>!C||!I||!A(C)||!A(I)?[]:l.reduce((P,$)=>{var B;const te=I.find(Z=>Z.user_id===$.studentId),Y=C.find(Z=>Z.course_id===$.courseId),x=(B=y.get($.studentId))==null?void 0:B.current_grade;return te&&Y&&P.push({studentSubscriptionId:$.studentId+$.courseId,student:{studentId:$.studentId,studentName:te.name},course:{courseId:$.courseId,courseName:Y.name},grade:x,attendanceStatus:v.StudentAttendStatus.STUDENT_ATTEND_STATUS_EMPTY,locationId:Gt($.locationIdsList)}),P},[]),[C,I,l,y]),pagination:S,isFetchingStudentsCourses:_||M||T,isLoadingGrades:_||w,handleEnterSearchBar:b=>{b!==t&&(s(b),m())},handleApplyFilterCriteria:b=>{vt(n,b)||(r(b),m())}}},Fo=e=>{const{open:t,onSave:s,onClose:n,selectedStudentInfoList:r}=e,[a,i]=h.exports.useState(r),c=q(),u=z(K.LESSON_MANAGEMENT),{data:d,isFetchingStudentsCourses:p,isLoadingGrades:_,pagination:m,handleEnterSearchBar:S,handleApplyFilterCriteria:l}=Oo(),f=()=>{i(r),n()},E=!p&&!A(d)?"empty-icon":"result";return o.createElement(xt,{onClose:f,onSave:()=>s(a),title:u("addStudent"),open:t,fullWidth:!0,maxWidth:"md",minWidthBox:"md",textSave:c("ra.common.action.add"),"data-testid":"DialogAddStudentSubscriptions__dialogContainer"},o.createElement(_n,null,o.createElement(N,{container:!0,spacing:2},o.createElement(N,{item:!0,xs:12},o.createElement(Ao,{onApplySubmit:l,onEnterSearchBar:S})),o.createElement(N,{item:!0,xs:12},o.createElement(fn,{variant:E,content:c("resources.common.noResult"),helperText:c("resources.common.noResultSearchAndFilter"),height:"dialog"},o.createElement(gn,null,o.createElement(vo,{studentInfoList:d,selectedStudentInfoList:a,pagination:m,onSelect:i,isLoadingStudentsCourses:p,isLoadingGrades:_})))))))},No=e=>{const t=q(),s=se(),{data:n=[],isFetching:r}=ye({entity:"locations",action:"locationsGetMany"})({location_ids:e},{enabled:A(e),onError(a){var i;(i=window.warner)==null||i.warn("useGetManyLocation error: ",a),s(`${t("ra.message.unableToLoadData")} ${a.message}`,"error")}});return{data:n,isLoading:r}},Do=e=>{const{studentsList:t,updateStudentAttendance:s,onSelect:n,selectedStudentsList:r,errorMessage:a}=e,i=!1,c=z(K.LESSON_MANAGEMENT),u=q(),{getStudentGradeName:d}=ss(),p=h.exports.useMemo(()=>t.reduce((l,f)=>{const E=f==null?void 0:f.locationId;return E&&l.push(E),l},[]),[t]),{data:_,isLoading:m}=No(p),S=h.exports.useMemo(()=>[{key:"name",title:c("columns.studentName"),render:l=>o.createElement(ie,{maxLines:2,variant:"body2","data-testid":"TableLessonManagementUpsertStudentsInfo__columnStudentName"},l.student.studentName),cellProps:{style:{width:"29%"}}},{key:"grade",title:c("columns.grade"),render:l=>o.createElement(Fe,{variant:"body2","data-testid":"TableLessonManagementUpsertStudentsInfo__columnGrade"},u(d(l.grade)||"")),cellProps:{style:{width:"10%"}}},{key:"course",title:c("course"),render:l=>o.createElement(ie,{maxLines:2,variant:"body2","data-testid":"TableLessonManagementUpsertStudentsInfo__columnCourseName"},l.course.courseName),cellProps:{style:{width:"23%"}}},{key:"attendance",title:c("attendance"),render:(l,f)=>{if(f===void 0)return;const E=Object.keys(kn)[l.attendanceStatus],M=E==="STUDENT_ATTEND_STATUS_EMPTY"?null:{key:E,label:c(`studentAttendanceStatus.${E}`)};return o.createElement(to,{value:M,onChange:C=>s(l.studentSubscriptionId,v.StudentAttendStatus[C.key]),"data-testid":"TableLessonManagementUpsertStudentsInfo__autocompleteAttendance",limitChipText:"Ellipsis",disableClearable:!1,clearIcon:o.createElement(Sn,{fontSize:"small"}),componentsProps:{clearIndicator:{"data-testid":"TableLessonManagementUpsertStudentsInfo__iconClear",onClick:()=>s(l.studentSubscriptionId,v.StudentAttendStatus.STUDENT_ATTEND_STATUS_EMPTY)}},getOptionSelectedField:"key"})}},{key:"center",title:c("columns.center"),render:l=>{if(m)return o.createElement(Ut,null);const f=(l==null?void 0:l.locationId)||"",E=_.find(I=>I.location_id===f);return E&&o.createElement(ie,{maxLines:2,variant:"body2","data-testid":"TableLessonManagementUpsertStudentsInfo__columnCenterName"},E.name)},cellProps:{style:{width:"10%"}}}],[_,d,m,c,s,u]);return o.createElement(Pt,{errorMessage:a,tableProps:{"data-testid":"TableLessonManagementUpsertStudentsInfo__root"},columns:S,showHeader:!0,body:{loading:i,skeCount:3,rowKey:"studentSubscriptionId"},data:t,onSelect:n||void 0,listSelectedItems:r,withIndex:!0})};var Po=Pn,Uo=bn,Go=qt,xo=kt,we=In,qo=Vt,$o=xo(function(e,t){var s=qo(t);return we(s)&&(s=void 0),we(e)?Po(e,Uo(t,1,we,!0),Go(s,2)):[]}),pt=$o,ko=ft,Vo=An,Bo=qt,Qo=kt,Wo=wn,_t=Vt,Ho=Qo(function(e){var t=_t(e),s=ko(e,Wo);return t===_t(s)?t=void 0:s.pop(),s.length&&s[0]===e[0]?Vo(s,Bo(t,2)):[]}),Yo=Ho;const jo=e=>{const{studentsList:t,updateStudentList:s,updateStudentAttendance:n,error:r}=e,a=q(),i=z(K.LESSON_MANAGEMENT),c=se(),[u,d]=h.exports.useState(!1),[p,_]=h.exports.useState([]),m="studentSubscriptionId",S=f=>{const E=pt(f,t,m),I=Yo(t,f,m);s([...I,...E]),d(!1),A(f)&&c(i("messages.addedStudentsSuccessfully"))},l=()=>{const f=pt(t,p,m);s(f),_([])};return o.createElement(o.Fragment,null,o.createElement(Un,{title:i("studentInfo"),"data-testid":"TableStudents__action",ButtonAddProps:{onClick:()=>d(!0)},ButtonDeleteProps:{startIcon:null,children:a("ra.action.remove"),onClick:l,disabled:!A(p)}}),o.createElement(Do,{studentsList:t,updateStudentAttendance:n,onSelect:_,selectedStudentsList:p,errorMessage:r==null?void 0:r.message}),u&&o.createElement(Fo,{open:u,onClose:()=>d(!1),onSave:S,selectedStudentInfoList:t}))},Ko=()=>{const e=q();return o.createElement(ue,{name:"learners",rules:{validate:t=>{if(!A(t))return e("resources.input.error.required")}},render:({fieldState:{error:t},field:{onChange:s,value:n}})=>{const r=(a,i)=>{const c=n.map(u=>u.studentSubscriptionId===a?U(g({},u),{attendanceStatus:i}):u);s(c)};return o.createElement(jo,{studentsList:n,updateStudentList:s,updateStudentAttendance:r,error:t})}})},zo=e=>{const{render:t}=e,s=q(),n=z(K.LESSON_MANAGEMENT),{errors:r}=hn(),{clearErrors:a}=de(),[i,c]=be({name:["startTime","endTime"]}),u=h.exports.useMemo(()=>({validate:_=>{if(!je(c,_))return s("resources.input.error.timeMustComeBefore",{startTime:n("startTime"),endTime:n("endTime")});ee(r,"endTime")&&a("endTime")}}),[a,c,r,s,n]),d=h.exports.useMemo(()=>({validate:_=>{if(!je(_,i))return s("resources.input.error.timeMustComeBefore",{startTime:n("startTime"),endTime:n("endTime")});ee(r,"startTime")&&a("startTime")}}),[a,r,i,s,n]),p=h.exports.useMemo(()=>t({validateRules:{startTime:u,endTime:d}}),[t,d,u]);return o.createElement(o.Fragment,null,p)};var Xo=(e=>(e[e.LESSON_INFO=0]="LESSON_INFO",e[e.REPORTS=1]="REPORTS",e))(Xo||{});Ee(v.LessonTime);const Le=Ee(J.LessonTeachingMedium),Ue=Ee(J.LessonTeachingMethod);var Zo=(e=>(e[e.FUTURE_LESSON=0]="FUTURE_LESSON",e[e.PAST_LESSON=1]="PAST_LESSON",e))(Zo||{});const Jo=e=>{const{lessonData:t}=e,s=q(),n=z(K.LESSON_MANAGEMENT);return o.createElement(yn,{"data-testid":"LessonManagementUpsertForm__root"},o.createElement(N,{container:!0,spacing:2},o.createElement(N,{item:!0,xs:12},o.createElement(ve,null,n("generalInfo"))),o.createElement(N,{item:!0,xs:6},o.createElement(po,{name:"date",label:n("columns.lessonDate"),InputProps:{required:!0,"data-testid":"LessonManagementUpsertForm__lessonDate"}})),o.createElement(N,{item:!0,xs:6},o.createElement(ei,null)),o.createElement(zo,{render:({validateRules:r})=>o.createElement(o.Fragment,null,o.createElement(N,{item:!0,xs:6},o.createElement(dt,{name:"startTime",label:n("startTime"),InputProps:{required:!0,"data-testid":"LessonManagementUpsertForm__lessonStartTime"},rules:r.startTime})),o.createElement(N,{item:!0,xs:6},o.createElement(dt,{name:"endTime",label:n("endTime"),InputProps:{required:!0,"data-testid":"LessonManagementUpsertForm__lessonEndTime"},rules:r.endTime})))}),o.createElement(N,{item:!0,xs:12},o.createElement(V,null,o.createElement(ce,{variant:"caption"},n("columns.teachingMedium")),o.createElement(lt,{name:"teachingMedium","data-testid":"LessonManagementUpsertForm__radioTeachingMedium",options:[{id:Le.LESSON_TEACHING_MEDIUM_OFFLINE,value:n("LESSON_TEACHING_MEDIUM_OFFLINE")},{id:Le.LESSON_TEACHING_MEDIUM_ONLINE,value:n("LESSON_TEACHING_MEDIUM_ONLINE")}]}))),o.createElement(N,{item:!0,xs:12},o.createElement(V,null,o.createElement(ce,{variant:"caption"},n("columns.teachingMethod")),o.createElement(lt,{name:"teachingMethod","data-testid":"LessonManagementUpsertForm__radioTeachingMethod",options:[{id:Ue.LESSON_TEACHING_METHOD_INDIVIDUAL,value:n("LESSON_TEACHING_METHOD_INDIVIDUAL")}]}))),o.createElement(N,{item:!0,xs:6},o.createElement(lo,{required:!0,label:n("columns.teacher"),name:"teachers",optionLabelKey:"id",disableCloseOnSelect:!0,limitChipText:"Ellipsis",multiple:!0,rules:{required:s("resources.input.error.required")},getOptionSelectedField:"user_id"})),o.createElement(N,{item:!0,xs:6},o.createElement(uo,{required:!0,label:n("columns.center"),name:"center",limitChipText:"Ellipsis",multiple:!1,rules:{required:s("resources.input.error.required")},getOptionSelectedField:"locationId"})),o.createElement(N,{item:!0,xs:12},o.createElement(tt,null,o.createElement(Ke,null))),o.createElement(N,{item:!0,xs:12},o.createElement(Ko,null)),o.createElement(N,{item:!0,xs:12},o.createElement(tt,null,o.createElement(Ke,null))),o.createElement(N,{item:!0,xs:12},o.createElement(V,null,o.createElement(ve,null,n("materialInfo")),o.createElement(ho,{defaultMaterialsList:t==null?void 0:t.materialsList})))))},ei=()=>{const e=q(),t=z(K.LESSON_MANAGEMENT),s=be({name:"date",defaultValue:new Date}),n=Wn(s,e);return o.createElement(o.Fragment,null,o.createElement(ce,{variant:"caption"},t("dayOfTheWeek")),o.createElement(Fe,{variant:"body2"},n))},ti=e=>{const{defaultValues:t,render:s}=e,n=Dt({defaultValues:t}),r=h.exports.useMemo(()=>s({handleSubmit:n.handleSubmit}),[n.handleSubmit,s]);return o.createElement(Ln,{methods:n},r)},Ri=(e,t,s)=>{if(!A(e))return[];const n=[];return e.map(r=>{const a=ze(J.LessonTeachingMethod,r.teachingMethod),i=ze(J.LessonTeachingMedium,r.teachingMedium),c={id:r.id,teachingMethod:a,teachingMedium:i};if(!c.teacherNames&&t&&!Xe.exports.isEmpty(t)){const u=[];r.teacherIdsList.forEach(d=>{t[d]&&u.push(t[d])}),c.teacherNames=u.join(", ")}if(!c.centerName&&s&&!Xe.exports.isEmpty(s)){const u=s[r.centerId]||"";c.centerName=u}if(!c.lessonDate&&!c.lessonTime){const u=Ze(r.startTime),d=Ze(r.endTime),p=Ie(u,"HH:mm"),_=Ie(d,"HH:mm");c.lessonDate=Ie(u,"yyyy/LL/dd"),c.lessonTime=`${p} - ${_}`}n.push(c)}),n},si=(e,t)=>t.map(n=>{var r;return n.teacher.users?g({},n.teacher.users):((r=window.warner)==null||r.warn(`Missing teacher for lesson: ${e}`),{name:"Missing teacher name",user_id:""})})||[],ni=(e,t)=>{if(!t||!A(t))return;const s=t.find(n=>{var i;const r=n.courseId===((i=e.course)==null?void 0:i.course_id),a=n.studentId===e.user.user_id;return r&&a});return s?Gt(s.locationIdsList):void 0},ri=(e,t)=>e.map(n=>{var c,u,d;const r=n.attendance_status?v.StudentAttendStatus[n.attendance_status]:v.StudentAttendStatus.STUDENT_ATTEND_STATUS_EMPTY,a=((c=n.course)==null?void 0:c.course_id)||"MISSING COURSE ID",i=n.user.user_id+a;return{course:{courseId:a,courseName:((u=n.course)==null?void 0:u.name)||"MISSING COURSE NAME"},grade:(d=n.user.student)==null?void 0:d.current_grade,student:{studentName:n.user.name,studentId:n.user.user_id},attendanceStatus:r,studentSubscriptionId:i,locationId:ni(n,t)}}),ai=e=>e?Object.keys(Ue).includes(e):!1,oi=e=>e?Object.keys(Le).includes(e):!1,ii=(e,t,s)=>{const{lesson_id:n,lessons_teachers:r,teaching_method:a,teaching_medium:i,center_id:c,start_time:u,end_time:d,lesson_members:p,studentSubscriptions:_}=e;return{teachers:si(n,r),teachingMethod:ai(a)?a:"LESSON_TEACHING_METHOD_INDIVIDUAL",teachingMedium:oi(i)?i:"LESSON_TEACHING_MEDIUM_ONLINE",center:{locationId:c||"",name:t||"MISSING CENTER NAME"},date:u,startTime:new Date(u),endTime:new Date(d),method:v.CreateLessonSavingMethod.CREATE_LESSON_SAVING_METHOD_ONE_TIME,materialsList:s||[],learners:ri(p,_)}},ci=({onError:e})=>{const t=se(),s=Rt(),{mutate:n}=Ce({entity:"classes",action:"classesConvertMedia"})({onError:e});return{convertMedia:async a=>{var i;if(!(!a||!a.length))try{const c=await s(Ct.LIST,le.MEDIA,{filter:{media_id:a,type:Lt.MEDIA_TYPE_PDF,converted_images:!0},pagination:{perPage:a.length,page:1},sort:{field:"created_at",order:"ASC"}}),u=c==null?void 0:c.data;A(u)&&n({data:{mediaList:u}})}catch(c){const u=$t(c);t(`Error during file conversion for ${a.toString()}`,"error"),(i=window.warner)==null||i.warn(`Error during file conversion for ${a.toString()}`,u.message,u)}}}},ui=(e,t,s)=>{const n=Je(e.date,e.startTime),r=Je(e.date,e.endTime),a=e.learners.map(u=>({attendanceStatus:u.attendanceStatus,courseId:u.course.courseId,studentId:u.student.studentId,locationId:u.locationId||""})),i=e.teachers.map(u=>u.user_id);return{lessonId:s,startTime:n,endTime:r,centerId:e.center.locationId,mediaIds:t,teachingMedium:J.LessonTeachingMedium[e.teachingMedium],teachingMethod:J.LessonTeachingMethod[e.teachingMethod],studentInfoListList:a,teacherIdsList:i,savingOption:{method:e.method},classId:"",courseId:""}},di=e=>{const{lessonId:t,onError:s,onSuccess:n}=e,r=se(),a=z(K.LESSON_MANAGEMENT),{mutate:i,isLoading:c}=Ce({entity:"lessons",action:t?"lessonsUpdate":"lessonsCreate"})({onError:s,onSuccess:(m,S)=>n==null?void 0:n(S)}),{convertMedia:u}=ci({onError:m=>{var S;(S=window.warner)==null||S.error("LessonManagementUpsert error during file conversion",m),r(a("message.error.convertFile"),"error")}}),{mutateAsync:d}=Ce({entity:"upload",action:"uploadFilterAndUploadFiles"})({onError:m=>{var S;(S=window.warner)==null||S.error("LessonManagementUpsert error during file conversion",m)}}),p=h.exports.useCallback(async m=>{const{data:{mediaIds:S}}=await d(m.materialsList);await u(S);const l=ui(m,S,t);i(l)},[u,d,t,i]);return{upsertLessonWithMiddleWares:h.exports.useCallback(async m=>{const{data:S,middleWares:l}=m;if(!A(l)){await p(S);return}!l.map(I=>{var M;return I.middleWareFunction(S)?!0:((M=I.onFalse)==null||M.call(I),!1)}).includes(!1)&&await p(S)},[p]),isLoading:c}},Oi=e=>{const{isOpen:t,onUpsertSuccessfully:s,onCloseUpsertDialog:n,lesson:r,centerName:a,mediasList:i}=e,c=r&&ii(r,a,i),u=q(),d=se(),p=z(K.LESSON_MANAGEMENT),[_,m]=et(!1),[S,l]=et(!1),f=h.exports.useMemo(()=>({teachers:[],teachingMethod:Ue.LESSON_TEACHING_METHOD_INDIVIDUAL,teachingMedium:Le.LESSON_TEACHING_MEDIUM_OFFLINE,date:new Date,startTime:new Date,endTime:new Date,method:v.CreateLessonSavingMethod.CREATE_LESSON_SAVING_METHOD_ONE_TIME,materialsList:[],learners:[]}),[]),{upsertLessonWithMiddleWares:E}=di({lessonId:r==null?void 0:r.lesson_id,onError:T=>{var y;m(!1),d(u("ra.manabie-error.unknown"),"error"),(y=window.warner)==null||y.error(`Error LessonManagementUpsert: ${T==null?void 0:T.message}`)},onSuccess:async T=>{await s(T),d(p(`messages.success.${r?"editLesson":"addLesson"}`)),m(!1)}}),I={middleWareFunction:T=>!T.learners.map(L=>L==null?void 0:L.locationId).find(L=>typeof L=="string"&&L!==T.center.locationId),onFalse:()=>{m(!1),l(!0)}},M={middleWareFunction:T=>{const y=T.learners.map(L=>L.student.studentId),w=new Set(y);return y.length===w.size},onFalse:()=>{m(!1),d(p("messages.pleaseAddOnlyOneStudentCourse"),"error")}},C=async T=>{var y;try{m(!0),await E({data:T,middleWares:[I,M]})}catch(w){m(!1);const L=$t(w);d(u("ra.manabie-error.unknown"),"error"),(y=window.warner)==null||y.error(`Error LessonManagementUpsert: ${L==null?void 0:L.message}`)}};return o.createElement(ti,{defaultValues:c||f,render:({handleSubmit:T})=>o.createElement(o.Fragment,null,o.createElement(En,{title:p(r?"editTitle":"createTitle"),open:t,onClose:n,onSave:T(C),isShowingBackdrop:_,dialogCancelConfirmProps:{textSave:u("ra.action.leave")},"data-testid":"LessonManagementUpsert__dialog",footerConfirmButtonProps:{disabled:_}},o.createElement(Jo,{lessonData:c})),o.createElement(xt,{open:S,textSave:u("ra.action.close"),shouldShowCancelButton:!1,onSave:()=>l(!1),onClose:()=>l(!1),title:p("actions.alert")},o.createElement(ce,null,p("cannotSaveLessonPleaseAddStudentFromSameCenter"))))})};export{to as A,Io as B,$n as C,xn as D,po as E,bo as F,dt as G,lo as H,uo as I,Lo as J,yo as K,Gn as L,Oa as M,Ri as N,Ci as O,Zo as P,kn as S,Un as T,tt as W,jn as a,qn as b,q as c,se as d,Ce as e,zn as f,Qn as g,Kn as h,ye as i,Ti as j,Ei as k,wi as l,Li as m,bi as n,Mi as o,vi as p,Wn as q,Ai as r,Ii as s,ss as t,z as u,Oi as v,Xo as w,Bn as x,ns as y,Pe as z};
