import{r as i,iM as R,aS as c,fi as g,N as n,eX as T,hV as C,hp as q,e1 as N,d0 as V,R as S,d7 as Z}from"./index.7daee9ef.js";import{u as M,a as O,b as v,Q as $,c as B}from"./useUpsertQuiz.843c5758.js";import{u as G}from"./useNavigation.f38e637f.js";import{r as L,v as _,x as b,u as P}from"./useShowSnackbar.da46e481.js";import{c as Y,e as F,f as J}from"./Delete.9e106999.js";import{u as W}from"./useStandaloneQuery.29e2103e.js";import"./UploadInput.4c4e4115.js";import"./useMutationV2.0883e427.js";import"./infer-query.264ca744.js";import"./useDialog.8ab3e0e0.js";import"./classCallCheck.4ad2061f.js";import"./useNotifyForm.ee77e08e.js";import"./Draft.ec2d3075.js";import"./useSafeState.fc2ddfd3.js";const X=()=>{const e=L(),u=_(),{quiz:s}=W(),[l,r]=i.exports.useState("");return{checkExternalIdIsValid:i.exports.useCallback(async o=>{if(o===""||R(o))return r(e(`resources.${c.QUIZZES}.mappedIdMustNotContainWhiteSpaces`)),!1;try{const t=await s.syllabusQuizGetByExternalId({external_id:o});if(t!=null&&t.length)return r(e(`resources.${c.QUIZZES}.duplicateExternalId`)),!1}catch(t){b.error("[useCheckQuizExternalId]",t);const d=g.isAppError(t)?e(t.message):e("ra.manabie-error.unknown");return u(d,"error"),!1}return r(""),!0},[e,s,u]),externalIdError:l}},le=()=>{const e=L(),u=P(c.QUIZZES),s=_(),l=G(),r=n(Y),a=n(F),o=n(J),t=n(p=>p.quiz.quizOnReview),d=n(p=>p.quiz.pdfUrl),{onCloseReview:w,onAddNewQuiz:z,onClearState:y}=M(),{checkExternalIdIsValid:E,externalIdError:Q}=X(),{isFetching:U,searchURL:f,id:h}=O({action:T.CREATE}),{upsertQuiz:x,isLoading:k}=v();i.exports.useEffect(()=>{a||!r||z({loId:r.lo_id,schoolId:r.school_id,isLo:r.type===C.LEARNING_OBJECTIVE_TYPE_LEARNING,kind:r.type===C.LEARNING_OBJECTIVE_TYPE_EXAM_LO?q.QuizType.QUIZ_TYPE_MCQ:void 0})},[r,a,z]),N(()=>{y()});const m=i.exports.useCallback(()=>{l.push(`/${V.SYLLABUS}/${c.LOS}/${h}/show${f}`)},[h,l,f]),A=i.exports.useCallback(async()=>{!a.externalId||!await E(a.externalId)||x({quiz:a},{onSuccess:()=>{m(),s(e("ra.common.createdSuccess",{smart_count:e(`resources.${c.QUIZZES}.question`)},{lowercase:!0}))},onError:I=>{if(b.warn("[QUIZ create]",I.message),g.isAppError(I))return s(e(I.message),"error");s(e("ra.common.createdFail"),"error")}})},[a,E,x,m,s,e]);return U?S.createElement(Z,null):S.createElement($,{disabled:!o||!!Q,loading:k,expandActionSpace:Boolean(d),quizOnReview:t,onSubmit:A,onCancel:m,onCloseReview:w,title:e("ra.page.create",{name:u("question")})},S.createElement(B,{disabled:k,pdfUrl:d,externalIdProps:{externalIdError:Q,checkExternalId:E}}))};export{le as default};
