import{ci as F,ch as P,e3 as R,r as E,R as e,aj as b,aJ as r,db as x,aK as G,ek as h,aG as A,ct as k,hM as w,hN as L,cG as U,d0 as $,cR as B,hl as V,aH as H,ew as O,af as D}from"./index.7daee9ef.js";import{r as N,u as J,S as p,v as W,w as Y,x as j}from"./useShowSnackbar.da46e481.js";import{F as K}from"./FormUploadMaterials.c32fc30a.js";import{u as z}from"./useHookFormField.c60f8756.js";import{u as Q}from"./useNavigation.f38e637f.js";const X=()=>{const m=N(),t=J(F.ASSIGNMENTS),{getValues:l,setValue:d,trigger:c}=P(),g=R({name:"is_required_grade"}),[n,o]=z("files",l("files")),a={name:{required:{value:!0,message:m("resources.input.error.required")}},maxGrade:{required:{value:!0,message:m("resources.input.error.required")},min:1}},u=E.exports.useMemo(()=>[{id:p.requireTextNoteSubmission,name:t("requireTextNoteSubmission")},{id:p.requireAttachmentSubmission,name:t("requireAttachmentSubmission")},{id:p.requireRecordedVideoSubmission,name:t("requireRecordedVideoSubmission")},{id:p.allowLateSubmission,name:t("allowLateSubmission")},{id:p.allowResubmission,name:t("allowResubmission")}],[t]),S=E.exports.useMemo(()=>[{id:"true",value:t("value")},{id:"false",value:t("doesNotRequireGrading")}],[t]),i=({target:{value:s}})=>{d("is_required_grade",JSON.parse(s)),c("max_grade")};return e.createElement(b,{"data-testid":"AssignmentForm__root",height:520},e.createElement(r,{container:!0,spacing:3},e.createElement(r,{item:!0,sm:12,md:4},e.createElement(x,null,e.createElement(G,{variant:"h6"},t("attachment")),e.createElement(b,{mt:2},e.createElement(K,{files:n,isBrightCoveOptional:!0,formUploadFileProps:{multiple:!0,accept:[h.PDF,h.AUDIO,h.IMAGE,h.VIDEO]},onChange:o})))),e.createElement(r,{item:!0,sm:12,md:8},e.createElement(x,null,e.createElement(G,{variant:"h6"},t("assignmentInfo")),e.createElement(b,{mt:2},e.createElement(r,{container:!0,spacing:6},e.createElement(r,{item:!0,sm:12},e.createElement(A,{name:"name",label:t("name"),rules:a.name,inputProps:{"data-testid":"AssignmentForm__name",id:"name"}})),e.createElement(r,{container:!0,item:!0,spacing:3},e.createElement(r,{item:!0,sm:6},e.createElement(k,{id:"is_required_grade",name:"is_required_grade",label:t("gradingMethod"),options:S,onChange:i,"data-testid":"AssignmentForm__gradingMethod"})),e.createElement(r,{item:!0,sm:6},g&&e.createElement(A,{name:"max_grade",label:t("maxGrade"),type:"number",inputProps:{min:1,"data-testid":"AssignmentForm__maxGrade"},rules:a.maxGrade,InputProps:{id:"max_grade"}}))),e.createElement(r,{item:!0,sm:12},e.createElement(A,{multiline:!0,rows:4,name:"instruction",inputProps:{"data-testid":"AssignmentForm__instruction",id:"instruction"}})),e.createElement(r,{item:!0,sm:12},e.createElement(w,{row:!0},u.map(s=>e.createElement(L,{key:s.id,name:`settings.${s.id}`,label:s.name,checkBoxProps:{id:`settings_${s.id}`,name:`settings.${s.id}`}}))))))))))},Z=m=>{const{action:t,searchUrl:l}=m,d=N(),c=W(),g=Q(),n=t===U.CREATE,{mutate:o,isLoading:a}=Y({entity:"assignment",action:"ASSIGNMENT_UPSERT"})({onSuccess:({assignmentIdsList:i})=>{const s=d(n?"ra.common.createdSuccess":"ra.common.updatedSuccess",{smart_count:`resources.${F.ASSIGNMENTS}.assignment`},{lowercase:!0});c(s,"success"),g.push(`/${$.SYLLABUS}/${F.ASSIGNMENTS}/${i[0]}/show${l}`)},onError:i=>{j.error(`${t} assignment failed`,i),c(n?"ra.common.createdFail":"ra.common.updatedFail","error")}}),u=E.exports.useCallback(i=>{const{assignment_id:s,content:_,display_order:T,instruction:f,is_required_grade:q,max_grade:M,name:v,files:y,settings:I}=i,C=n?0:Number(T);return{name:v,files:y,settings:I,assignmentId:s,content:{loIdList:_.lo_id,topicId:_.topic_id},displayOrder:C,instruction:B(f),requiredGrade:Boolean(q),maxGrade:Number(M),assignmentType:V.AssignmentType.ASSIGNMENT_TYPE_LEARNING_OBJECTIVE}},[n]);return{upsertAssignment:E.exports.useCallback((i,s)=>{if(a)return;const _=u(i);o(_,s)},[u,o,a]),isLoading:a}},ie=m=>{const{action:t,assignment:l,searchUrl:d,title:c,onClose:g}=m,n=H({defaultValues:l}),{upsertAssignment:o,isLoading:a}=Z({action:t,searchUrl:d}),u=E.exports.useCallback(S=>{o(S,{})},[o]);return e.createElement(O,{title:c,open:!0,footerConfirmButtonProps:{disabled:a},methods:n,onClose:g,onSave:n.handleSubmit(u)},e.createElement(X,null),a&&e.createElement(b,{mt:2},e.createElement(D,{"aria-hidden":!a})))};export{ie as A};
