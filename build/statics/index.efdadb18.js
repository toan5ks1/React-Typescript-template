var ee=Object.defineProperty,te=Object.defineProperties;var ae=Object.getOwnPropertyDescriptors;var C=Object.getOwnPropertySymbols;var k=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable;var P=(a,t,n)=>t in a?ee(a,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):a[t]=n,y=(a,t)=>{for(var n in t||(t={}))k.call(t,n)&&P(a,n,t[n]);if(C)for(var n of C(t))G.call(t,n)&&P(a,n,t[n]);return a},L=(a,t)=>te(a,ae(t));var w=(a,t)=>{var n={};for(var r in a)k.call(a,r)&&t.indexOf(r)<0&&(n[r]=a[r]);if(a!=null&&C)for(var r of C(a))t.indexOf(r)<0&&G.call(a,r)&&(n[r]=a[r]);return n};import{by as ne,bp as re,cd as S,R as e,aj as p,bb as se,cR as ie,aJ as N,b9 as oe,cI as Y,r as b,cS as W,cT as ce,cU as le,cV as f,cW as ue,aK as v,cX as de,cY as me,c5 as pe,cZ as Ee,a8 as Ne,c_ as ge,c$ as D,d0 as _e,d1 as Te,d2 as q,d3 as be,d4 as Se,d5 as ye,d6 as Ie,d7 as he,d8 as we,d9 as xe,da as Re,db as Ae,cK as z,dc as Ce,dd as Oe,de as fe,cj as K}from"./index.7daee9ef.js";import{a as ve,u as h,C as Ue,b as Z,E as $e,K as H,c as F,i as j,d as M,e as Be,f as De,g as Fe,h as Qe,j as Pe}from"./useNotificationUserRead.372fec74.js";import{A as ke,a as Ge}from"./AccordionSummaryBase.51fee70a.js";import"./_baseMap.9313eb6b.js";import"./_baseFor.4cbad8e1.js";import"./Draft.ec2d3075.js";import"./IconButtonBase.a835a6a3.js";var Le=ne(re.exports.jsx("path",{d:"M10.01 21.01c0 1.1.89 1.99 1.99 1.99s1.99-.89 1.99-1.99h-3.98zM12 6c2.76 0 5 2.24 5 5v7H7v-7c0-2.76 2.24-5 5-5zm0-4.5c-.83 0-1.5.67-1.5 1.5v1.17C7.36 4.85 5 7.65 5 11v6l-2 2v1h18v-1l-2-2v-6c0-3.35-2.36-6.15-5.5-6.83V3c0-.83-.67-1.5-1.5-1.5zM11 8h2v4h-2zm0 6h2v2h-2z"}),"NotificationImportantOutlined");function We(){return ve(["answer 1","answer 2","answer 3","answer 4","answer 5","answer 6","answer 7"])}const qe=({notificationInfo:a,notificationMsgDetail:t})=>{const n=h(S.NOTIFICATIONS);return e.createElement(p,{display:"flex",flexDirection:"row",mb:3,alignItems:"center"},e.createElement(p,{mr:2},e.createElement(Ue,{label:n(`notificationStatus.${a==null?void 0:a.status}`),status:a==null?void 0:a.status})),e.createElement(p,null,e.createElement(se,{disablePadding:!0,"data-testid":"HeaderNotification__title",title:ie(t==null?void 0:t.title)})))},$=({label:a,children:t,xsLabel:n=1,xsValue:r=11})=>{const s=h(S.NOTIFICATIONS);return e.createElement(N,{container:!0,item:!0},e.createElement(N,{item:!0,xs:n},e.createElement(oe,{"data-testid":"GeneralInfoRow__label",variant:"caption"},`${s(a)}:`)),e.createElement(N,{item:!0,xs:r},t))},x={root:{display:"table-row","&:first-of-type > *":{paddingTop:0}},tableCell:a=>({display:"table-cell",paddingTop:a.spacing(2)}),rowTitle:{textAlign:"right",whiteSpace:"nowrap"},cellItem:a=>({marginLeft:a.spacing(1)})},O=r=>{var s=r,{rowLabel:a,rowItems:t}=s,n=w(s,["rowLabel","rowItems"]);return e.createElement(p,L(y({sx:x.root},n),{"data-testid":"InfoNotificationDetailSentTableRow__container"}),e.createElement(p,{sx:[x.tableCell,x.rowTitle]},e.createElement("span",null,a)),e.createElement(p,{sx:x.tableCell},t&&t.map((l,d)=>e.createElement(Y,{key:d,label:l,sx:x.cellItem,"data-testid":"ChipBase_item",size:"small"}))))},V={root:{maxWidth:"690px",minWidth:"360px",borderSpacing:0},tableBody:{display:"table-row-group"}},ze=({courses:a,notificationInfo:t,receivers:n})=>{var m,_,u;const r=h(S.NOTIFICATIONS),s=Z(),l=b.exports.useMemo(()=>{var c;const o=(c=t==null?void 0:t.target_groups)==null?void 0:c.course_filter;return!o||!o.type?[""]:o.type===W.NOTIFICATION_TARGET_GROUP_SELECT_LIST?a.map(i=>i.name):[r(`targetGroupSelect.${o.type}`)]},[a,(m=t==null?void 0:t.target_groups)==null?void 0:m.course_filter,r]),d=b.exports.useMemo(()=>{var c;const o=(c=t==null?void 0:t.target_groups)==null?void 0:c.grade_filter;return!o||!o.type?[""]:o.type&&o.type===W.NOTIFICATION_TARGET_GROUP_SELECT_LIST?o.grades.map(i=>s(`resources.choices.grades.${i}`)):[r(`targetGroupSelect.${o.type}`)]},[(_=t==null?void 0:t.target_groups)==null?void 0:_.grade_filter,s,r]),g=b.exports.useMemo(()=>{var c;const o=(c=t.target_groups)==null?void 0:c.user_group_filter;return!o||!o.user_group?[""]:o==null?void 0:o.user_group.map(i=>s(`resources.choices.user_group.${i}`))},[(u=t.target_groups)==null?void 0:u.user_group_filter,s]);return e.createElement(p,{sx:V.root,"data-testid":"InfoNotificationDetailSentTable__container"},e.createElement(p,{sx:V.tableBody},e.createElement(O,{rowLabel:`${r("label.courses")}:`,rowItems:l}),e.createElement(O,{rowLabel:`${r("label.grades")}:`,rowItems:d}),e.createElement(O,{rowLabel:`${r("label.individualRecipient")}:`,rowItems:n&&n.map(o=>o.name)}),e.createElement(O,{rowLabel:`${r("label.userType")}:`,rowItems:g})))};const Ke=({notificationInfo:a,notificationMsgDetail:t,courses:n,receivers:r,mediaList:s})=>{const l=h(S.NOTIFICATIONS),d=b.exports.useMemo(()=>{var _,u;return(u=ce((_=t==null?void 0:t.content)==null?void 0:_.raw))!=null?u:le.EditorState.createEmpty()},[t==null?void 0:t.content]),g=b.exports.useMemo(()=>a&&e.createElement(ze,{courses:n,notificationInfo:a,receivers:r}),[n,a,r]),m=b.exports.useMemo(()=>f(s)?e.createElement(ue,{medias:s}):e.createElement(v,{variant:"body2"},e.createElement(de,null)),[s]);return e.createElement(N,{container:!0,spacing:2,"data-testid":"NotificationGeneralInfo__container"},e.createElement($,{label:"label.to"},e.createElement(me,{disableElevation:!0,endIcon:e.createElement(pe,null),popoverPosition:"bottom-center",dropdownContent:g,variant:"text",color:"inherit",isAdvancedFilterButton:!1},e.createElement(v,{variant:"body2"},l("label.recipient")))),e.createElement($,{label:"label.content"},e.createElement($e,{editorState:d,displayOnly:!0})),e.createElement($,{label:"label.attachment"},e.createElement(p,{pl:1},m)))},X={accordion:a=>({width:`calc(100% - ${a.spacing(3)} - ${a.spacing(1)})`}),wordBreak:()=>({wordBreak:"break-word"})},Q=a=>{const s=a,{isTextInAccordion:t,sx:n=[X.wordBreak]}=s,r=w(s,["isTextInAccordion","sx"]);return e.createElement(v,y({sx:[t?X.accordion:{},...Ee(n)]},r))},B="QuestionAccordion",I={root:`${B}-root`,content:`${B}-content`,expanded:`${B}-expanded`},He=Ne(ke)(()=>({[`&.${I.root}`]:{margin:0,padding:0,minHeight:"unset",height:"auto"},[`& .${I.content}`]:{margin:0,[`&.${I.expanded}`]:{margin:0}}})),je=a=>{const d=a,{children:t,accordionEndIcon:n,questionName:r,expanded:s}=d,l=w(d,["children","accordionEndIcon","questionName","expanded"]);return e.createElement(Ge,y({expanded:s,elevation:0},l),e.createElement(He,{iconExpandPosition:"right",classes:{root:I.root,content:I.content,expanded:I.expanded},active:s,summaryContent:e.createElement(Q,{variant:"subtitle2",color:"textPrimary"},r),endIcon:n}),t)},Me=({choicesList:a})=>e.createElement(N,{"data-testid":"QuestionnaireDetailAnswers__root",item:!0,container:!0,spacing:1,sx:{mt:0}},f(a)&&a.map((t,n)=>e.createElement(N,{item:!0,container:!0,xs:12,key:`${t}-${n}`},e.createElement(Q,{"data-testid":"QuestionnaireDetailAnswers__answer",isTextInAccordion:!0,variant:"caption"},t)))),Ve=({defaultExpanded:a=!1,choicesList:t,title:n,isShortAnswer:r})=>{const[s,l]=b.exports.useState(a),d=()=>{l(g=>!g)};return e.createElement(p,null,r?e.createElement(je,{questionName:n,onChange:d,expanded:s},e.createElement(Me,{choicesList:t})):e.createElement(Q,{variant:"subtitle2",color:"textPrimary"},n))},Xe={[H.USER_NOTIFICATION_QUESTIONNAIRE_STATUS_ANSWERED]:"success",[H.USER_NOTIFICATION_QUESTIONNAIRE_STATUS_UNANSWERED]:"default"},Je=n=>{var r=n,{status:a}=r,t=w(r,["status"]);const s=Xe[a];return e.createElement(ge,y({size:"small",status:s,"data-testid":"ChipQuestionnaireStatus"},t))},Ye={data:{notificationReceipt:[],studentIds:[],parentIds:[]},total:0},J=({data:a,total:t})=>{const n=new Set,r=new Set;return a?(a.forEach(s=>{s.parent_id&&r.add(s.parent_id),s.student_id&&n.add(s.student_id)}),{data:{studentIds:[...n],parentIds:[...r],notificationReceipt:a||[]},total:t}):Ye},Ze=({id:a})=>{const{isEnabled:t}=F(D.NOTIFICATION_QUESTIONNAIRE),{result:{isLoading:n},data:r,pagination:s}=j({entity:"usersInfoNotifications",action:"communicationGetRecipientListWithQuestionnaireStatus"})({notification_id:a},{enabled:Boolean(a)&&t,selector:J}),{result:{isLoading:l},data:d,pagination:g}=j({entity:"usersInfoNotifications",action:"communicationGetRecipientList"})({notification_id:a},{enabled:Boolean(a)&&!t,selector:J}),{notificationReceipt:m,studentIds:_,parentIds:u}=t?r.data:d.data,{data:o}=M({entity:"users",action:"communicationGetUsernames"})({user_id:_},{enabled:f(_),onError:i=>{var E;(E=window.warner)==null||E.warn("useNotificationReceipt notification studentNames",i)}}),{data:c}=M({entity:"users",action:"communicationGetUsernames"})({user_id:u},{enabled:f(u),onError:i=>{var E;(E=window.warner)==null||E.warn("useNotificationReceipt notification parentNames",i)}});return{notificationReceipt:m,studentNames:o,parentNames:c,loading:t?n:l,pagination:t?s:g}},et=({notificationId:a,isHaveQuestionnaireData:t})=>{const{isEnabled:n}=F(D.NOTIFICATION_QUESTIONNAIRE),{loading:r,notificationReceipt:s,parentNames:l,studentNames:d,pagination:g}=Ze({id:a}),m=h(S.NOTIFICATIONS),_=c=>e.createElement(be,{variant:"body2",maxLength:60},c),u=({users:c,id:i})=>{var E;return!c||!c.length||!i?"":((E=c.find(T=>T.user_id===i))==null?void 0:E.name)||""},o=b.exports.useMemo(()=>{const c=[{key:"user.name",title:m("label.recipientName"),render:i=>{const E=i.user_group,T=i.student_id?i.student_id:i.user_id,R=`/${_e.USER}/${S.STUDENTS}/${T}/show`,A=u({users:d,id:T}),U=u({users:l,id:i.parent_id});return E===Te.USER_GROUP_STUDENT?e.createElement(q,{"data-testid":"RecipientTable__linkName",to:R},_(A)):e.createElement(N,{container:!0,spacing:1,alignItems:"center"},e.createElement(N,{item:!0},e.createElement(q,{"data-testid":"RecipientTable__linkName",to:R},_(m("label.parentOfStudent",{parentName:U,studentName:A})))),e.createElement(N,{item:!0},e.createElement(Y,{"data-testid":"Recipient__chipLabelParent",label:m("label.parent",{smart_count:1}),size:"small"})))}},{key:"status",title:m("label.status"),cellProps:{style:{width:"10%"}},render:i=>{const E=i.status===Se.USER_NOTIFICATION_STATUS_NEW;return e.createElement(p,{"data-testid":"Recipient__status",sx:[T=>E?{color:T.palette.error.main}:{color:T.palette.success.main}]},e.createElement(v,{variant:"body2"},m(`userNotificationStatus.${i.status}`)))}}];return n&&t&&c.splice(1,0,{key:"questionnaire",title:m("label.questionnaire"),cellProps:{style:{width:"15%"}},render:i=>e.createElement(Je,{status:i.qn_status,label:m(`questionnaireStatus.${i.qn_status}`)})}),c},[m,n,t,d,l]);return e.createElement(ye,{withIndex:!0,data:s,columns:o,tableProps:{"data-testid":"Recipient__table"},body:{rowKey:"user_notification_id",loading:!!r,pagination:g},footer:{pagination:g}})},tt={choicesList:We(),title:"What date would you like the event to be held?",isShortAnswer:!0},at=a=>{var t,n;return!a||!a.length?!0:((t=K(a).all_receiver_aggregate.aggregate)==null?void 0:t.count)===((n=K(a).read_aggregate.aggregate)==null?void 0:n.count)},nt=()=>{const a=Z(),t=h(S.NOTIFICATIONS),{isEnabled:n}=F(D.NOTIFICATION_QUESTIONNAIRE),{id:r}=Ie(),{open:s,onClose:l,onOpen:d}=Be(),{onResend:g}=De(),{readCountOfNotifications:m}=Fe({notification_id:r?[r]:[]}),_=at(m),{notificationInfo:u,questionnaire:o,receivers:c,courses:i,isFetching:E}=Qe(r),{notificationMsgDetail:T,mediaList:R,isFetching:A}=Pe((u==null?void 0:u.notification_msg_id)||void 0),U=b.exports.useCallback(()=>{g({data:{notificationId:r}}),l()},[r,l,g]);return E||A?e.createElement(he,null):!r||!u||!T?e.createElement(we,{to:"/page-not-found"}):e.createElement(xe,null,e.createElement(Re,{resource:S.NOTIFICATIONS,name:T.title}),e.createElement(qe,{notificationInfo:u,notificationMsgDetail:T}),e.createElement(Ae,{"data-testid":"NotificationDetail"},e.createElement(N,{container:!0,spacing:3},e.createElement(N,{item:!0,xs:12},e.createElement(p,{mb:2},e.createElement(z,null,t("title.generalInfo"))),e.createElement(Ke,{notificationInfo:u,notificationMsgDetail:T,courses:i,receivers:c,mediaList:R})),e.createElement(N,{item:!0,xs:12},e.createElement(Ce,null)),n&&e.createElement(N,{item:!0,xs:12,"data-testid":"NotificationDetail__questionItem"},e.createElement(Ve,y({},tt))),e.createElement(N,{item:!0,xs:12},e.createElement(p,{mb:2,display:"flex"},e.createElement(p,{flexGrow:1},e.createElement(z,null,t("label.recipient",{smart_count:2}))),e.createElement(p,null,e.createElement(Oe,{startIcon:e.createElement(Le,null),onClick:d,"data-testid":"RecipientTable__buttonResend",disabled:_},t("button.notifyUnread")))),e.createElement(et,{notificationId:r,isHaveQuestionnaireData:Boolean(o)})))),e.createElement(fe,{"data-testid":"NotificationDetail__dialogResendConfirm",textCancelDialog:a("ra.common.resendNotification"),title:a("resources.notifications.button.notifyUnread"),footerConfirmButtonProps:{color:"primary"},open:s,onSave:U,onClose:l}))};var mt=nt;export{mt as default};
