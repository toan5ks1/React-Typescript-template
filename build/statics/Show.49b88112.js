var St=Object.defineProperty,ht=Object.defineProperties;var It=Object.getOwnPropertyDescriptors;var J=Object.getOwnPropertySymbols;var Oe=Object.prototype.hasOwnProperty,Ue=Object.prototype.propertyIsEnumerable;var Ne=(a,t,n)=>t in a?St(a,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):a[t]=n,g=(a,t)=>{for(var n in t||(t={}))Oe.call(t,n)&&Ne(a,n,t[n]);if(J)for(var n of J(t))Ue.call(t,n)&&Ne(a,n,t[n]);return a},C=(a,t)=>ht(a,It(t));var X=(a,t)=>{var n={};for(var o in a)Oe.call(a,o)&&t.indexOf(o)<0&&(n[o]=a[o]);if(a!=null&&J)for(var o of J(a))t.indexOf(o)<0&&Ue.call(a,o)&&(n[o]=a[o]);return n};import{by as Ze,bp as je,eX as U,cG as ft,cR as R,r as m,R as e,eS as vt,aS as v,cV as oe,aJ as f,aK as M,d2 as Tt,d0 as le,cX as _t,j2 as Dt,ch as H,aG as xt,dp as Lt,L as kt,hV as Q,bj as K,ai as wt,ci as ie,a1 as ee,aj as k,eG as Pe,g0 as he,i6 as Ie,i7 as Ce,fW as ce,fT as fe,a8 as At,aI as Ge,h_ as ze,d5 as Ft,j3 as Bt,dd as Rt,ak as Nt,cq as Ke,b8 as ve,b9 as Te,j4 as Ot,aH as We,cw as Ut,cs as Mt,cy as Vt,dm as $t,cv as Ht,j5 as Yt,j6 as Zt,fB as jt,j7 as Gt,c$ as zt,e1 as Kt,j8 as Wt,fy as qt,hj as Jt,eW as Xt,eV as qe,hL as Qt,gF as ea,d6 as ta,d7 as aa,j9 as na,d9 as oa,dc as la,i8 as ra}from"./index.7daee9ef.js";import{i as V}from"./infer-query.264ca744.js";import{S as re,a as sa,u as Je,f as G,d as de,b as _e,c as $,e as ia,D as ca}from"./utils.c80bdd07.js";import{T as z}from"./TypographyMaxLines.88e560ab.js";import{u as D,r as Y,v as Xe,w as da,x as Qe,D as ua}from"./useShowSnackbar.da46e481.js";import{p as Se}from"./pick.09d3500a.js";import{E as ma,a as pa}from"./EntityIcon.4e674647.js";import{I as ga}from"./IconButtonBase.a835a6a3.js";import{i as ya}from"./intersection.1a672747.js";import{T as Ea}from"./TimePickerAutocompleteHF.e331d49c.js";import{u as ne}from"./useDialog.8ab3e0e0.js";import{g as ba,B as Pa}from"./common.eab4c9d9.js";import"./useNavigation.f38e637f.js";import"./useBasicContent.160dc809.js";import"./display-order.ffc5e670.js";import"./_flatRest.95d435ef.js";import"./_baseFlatten.b9c8ce3e.js";import"./_baseRest.fb013a79.js";import"./_castArrayLikeObject.2e9ca1e4.js";import"./isArrayLikeObject.979eb0a9.js";var Ca=Ze(je.exports.jsx("path",{d:"M12 6.5c3.79 0 7.17 2.13 8.82 5.5-1.65 3.37-5.02 5.5-8.82 5.5S4.83 15.37 3.18 12C4.83 8.63 8.21 6.5 12 6.5m0-2C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zm0 5c1.38 0 2.5 1.12 2.5 2.5s-1.12 2.5-2.5 2.5-2.5-1.12-2.5-2.5 1.12-2.5 2.5-2.5m0-2c-2.48 0-4.5 2.02-4.5 4.5s2.02 4.5 4.5 4.5 4.5-2.02 4.5-4.5-2.02-4.5-4.5-4.5z"}),"RemoveRedEyeOutlined"),Sa=Ze(je.exports.jsx("path",{d:"M12 6c3.79 0 7.17 2.13 8.82 5.5-.59 1.22-1.42 2.27-2.41 3.12l1.41 1.41c1.39-1.23 2.49-2.77 3.18-4.53C21.27 7.11 17 4 12 4c-1.27 0-2.49.2-3.64.57l1.65 1.65C10.66 6.09 11.32 6 12 6zm-1.07 1.14L13 9.21c.57.25 1.03.71 1.28 1.28l2.07 2.07c.08-.34.14-.7.14-1.07C16.5 9.01 14.48 7 12 7c-.37 0-.72.05-1.07.14zM2.01 3.87l2.68 2.68C3.06 7.83 1.77 9.53 1 11.5 2.73 15.89 7 19 12 19c1.52 0 2.98-.29 4.32-.82l3.42 3.42 1.41-1.41L3.42 2.45 2.01 3.87zm7.5 7.5 2.61 2.61c-.04.01-.08.02-.12.02-1.38 0-2.5-1.12-2.5-2.5 0-.05.01-.08.01-.13zm-3.4-3.4 1.75 1.75c-.23.55-.36 1.15-.36 1.78 0 2.48 2.02 4.5 4.5 4.5.63 0 1.23-.13 1.77-.36l.98.98c-.88.24-1.8.38-2.75.38-3.79 0-7.17-2.13-8.82-5.5.7-1.43 1.72-2.61 2.93-3.53z"}),"VisibilityOffOutlined");const ha=a=>{const{studyPlan:t,refetchStudyPlan:n,handleOpenEditStudyPlanDialog:o}=a,c=[U.EDIT,t.status===re.STUDY_PLAN_STATUS_ACTIVE?U.ARCHIVE:U.UNARCHIVE],l={[U.EDIT]:t.status===re.STUDY_PLAN_STATUS_ARCHIVED},{archiveStudyPlan:r,activateStudyPlan:i}=sa({action:ft.UPDATE,courseId:R(t.course_id),studyPlanId:t.study_plan_id}),s=m.exports.useCallback(p=>{switch(p){case U.EDIT:return o();case U.ARCHIVE:return r(t,{onSuccess:()=>{n()}});case U.UNARCHIVE:return i(t,{onSuccess:()=>{n()}});default:return}},[i,r,o,n,t]);return e.createElement(vt,{recordName:"",actions:c,disables:l,buttonStyle:"square",onAction:s})},Ia=a=>{const{bookId:t,bookName:n,grades:o,trackSchoolProgress:c}=a,l=D(v.COURSES),{convertGradeToString:r}=Je(),i=oe(o)?r(o):"";return e.createElement(f,{container:!0,sx:{width:"calc(100% + 40px)",margin:"-20px"}},e.createElement(f,{container:!0,item:!0,xs:6,p:2.5,sx:{width:"calc(100% + 16px)",margin:"-8px"}},e.createElement(f,{item:!0,xs:4,p:1},e.createElement(M,{variant:"body2",color:"textSecondary"},l("book"))),e.createElement(f,{item:!0,xs:8,p:1},e.createElement(Tt,{to:`/${le.SYLLABUS}/${v.BOOKS}/${t}/show`,"data-testid":"StudyPlanInfo__bookLink"},e.createElement(M,{variant:"body2",color:"primary"},n))),e.createElement(f,{item:!0,xs:4,p:1},e.createElement(M,{variant:"body2",color:"textSecondary"},l("studyPlan.trackSchoolProgress.title"))),e.createElement(f,{item:!0,xs:8,p:1},e.createElement(z,{variant:"body2",maxLines:2,"data-testid":"StudyPlanInfo__trackSchoolProgress"},l(`studyPlan.trackSchoolProgress.${c}`)))),e.createElement(f,{container:!0,item:!0,xs:6,p:2.5,sx:{width:"calc(100% + 16px)",margin:"-8px"}},e.createElement(f,{item:!0,xs:4,p:1},e.createElement(M,{variant:"body2",color:"textSecondary"},l("grade"))),e.createElement(f,{item:!0,xs:8,p:1},e.createElement(z,{variant:"body2",maxLines:2,"data-testid":"StudyPlanInfo__grades"},i))))},fa=()=>{},va=m.exports.createContext({timezone:{value:""},onChangeTimezone:fa}),De=()=>m.exports.useContext(va),te=a=>{const{value:t}=a,{timezone:n}=De(),o={variant:"body2","data-testid":"StudyPlanItem__dateDisplay"};return isNaN(Date.parse(t))?e.createElement(M,g({},o),e.createElement(_t,null)):e.createElement(M,g({},o),G({isoDate:t,timezone:n}))},et=a=>a?Dt(a):!0,Ta=a=>{const{fieldName:t,studyPlanItemId:n,getValues:o,tCourse:c}=a,l={"<":(i,s)=>new Date(i)<new Date(s),"<=":(i,s)=>new Date(i)<=new Date(s),">":(i,s)=>new Date(i)>new Date(s),">=":(i,s)=>new Date(i)>=new Date(s)},r=(i,s,p)=>u=>{const d=o(`studyPlanItem.${n}.${i}`);return!u||!d||!((de.test(d)||_e.test(d))&&et(d))?!0:l[s](u,d)||c(p)};switch(t){case"availableFrom":return{laterThanAvailableUntil:r("availableTo","<","studyPlan.error.availableFromLaterAvailableUntil")};case"availableTo":return{earlierThanAvailableFrom:r("availableFrom",">","studyPlan.error.availableUntilEarlierAvailableFrom")};case"startDate":return{earlierThanAvailableFrom:r("availableFrom",">=","studyPlan.error.startDateEarlierAvailableFrom"),laterThanAvailableUntil:r("availableTo","<","studyPlan.error.startDateLaterAvailableUntil"),laterThanDueDate:r("endDate","<","studyPlan.error.startDateLaterDueDate")};case"endDate":return{earlierThanAvailableFrom:r("availableFrom",">=","studyPlan.error.dueDateEarlierAvailableFrom"),laterThanAvailableUntil:r("availableTo","<=","studyPlan.error.dueDateLaterAvailableUntil"),earlierThanStartDate:r("startDate",">","studyPlan.error.dueDateEarlierStartDate")}}},_a=a=>{const{fieldName:t,studyPlanItemId:n}=a,{getValues:o}=H(),c=D(v.COURSES);return{validate:g({format:l=>(l?de.test(l)||_e.test(l):!0)||c("studyPlan.error.dateFormatInvalid"),valid:l=>et(l)||c("studyPlan.error.dateFormatInvalid")},Ta({fieldName:t,studyPlanItemId:n,getValues:o,tCourse:c}))}},Me=a=>de.test(a)||_e.test(a),Da=m.exports.forwardRef((a,t)=>e.createElement(xt,g({},a))),xa="yyyy/mm/dd, hh:mm",ae=a=>{const{studyPlanItemId:t,fieldName:n}=a,{timezone:o}=De(),{formState:{errors:c},getValues:l,setValue:r}=H(),i=_a({studyPlanItemId:t,fieldName:n}),s=`studyPlanItem.${t}`,p=`studyPlanItem.${t}.${n}`,u=m.exports.useCallback(y=>{switch(n){case"availableFrom":case"startDate":{r(`${s}.${n}`,`${y}, 00:00`);break}case"availableTo":case"endDate":{r(`${s}.${n}`,`${y}, 23:59`);break}}},[n,r,s]),d=m.exports.useCallback(y=>{const P=new Date(y),h=l(`${s}.availableTo`);P.setDate(P.getDate()+7),P.setHours(23),P.setMinutes(59),h&&Me(h)&&P>new Date(h)&&P.setTime(new Date(h).getTime()),r(`${s}.endDate`,G({isoDate:P.toISOString(),timezone:o,withYear:!0}),{shouldDirty:!0})},[l,s,r,o]),E=m.exports.useCallback(({currentTarget:{value:y}})=>{if(!(!y||!Me)&&(de.test(y)&&u(y),n==="startDate")){if(R(l(`${s}.endDate`)))return;d(y)}},[n,u,l,s,d]),b=m.exports.useCallback(({currentTarget:y})=>{y.select()},[]);return e.createElement(Lt,{title:kt(c,`${p}.message`,"")},e.createElement("span",null,e.createElement(Da,{sx:y=>({backgroundColor:y.palette.background.default}),name:p,placeholder:xa,helperText:void 0,rules:i,onBlur:E,onFocus:b})))},La=()=>e.createElement("svg",{width:"32",height:"32",viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg",role:"img","aria-label":"Assignment icon"},e.createElement("path",{d:"M0 16C0 7.16344 7.16344 0 16 0C24.8366 0 32 7.16344 32 16C32 24.8366 24.8366 32 16 32C7.16344 32 0 24.8366 0 16Z",fill:"none"}),e.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M22.8 20.8008L21.6 19.4404L21.6 11.2008H24V19.4404L22.8 20.8008ZM22.8 19.3498L23.0944 19.016V12.4429H22.5056L22.5056 19.016L22.8 19.3498ZM22.0512 8.80078L23.5488 8.80078C23.7984 8.80078 24 9.02932 24 9.31227L24 10.4008L21.6 10.4008V9.31227C21.6 9.17442 21.648 9.04746 21.7312 8.95314C21.8144 8.85882 21.9232 8.80078 22.0512 8.80078ZM9.40846 8.81334C8.62965 8.8144 7.99906 9.53099 8 10.4139L8.01362 21.6041C8.01456 22.487 8.64668 23.2019 9.42549 23.2008L18.5915 23.1882C19.3704 23.1872 20.0009 22.4706 20 21.5877L19.9864 10.3975C19.9854 9.51458 19.3533 8.79973 18.5745 8.80079L9.40846 8.81334ZM18.4 10.4027L9.6 10.4133L9.61449 21.6133L18.4145 21.6027L18.4 10.4027ZM11.2 12.0008H16.8V13.6008H11.2V12.0008ZM16.8 15.2008H11.2V16.8008H16.8V15.2008ZM11.2 18.4008H15.2V20.0008H11.2V18.4008Z",fill:"#FFF"})),ka=()=>e.createElement("svg",{width:"32",height:"32",viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg",role:"img","aria-label":"Flash card icon"},e.createElement("path",{d:"M0 16C0 7.16344 7.16344 0 16 0C24.8366 0 32 7.16344 32 16C32 24.8366 24.8366 32 16 32C7.16344 32 0 24.8366 0 16Z",fill:"none"}),e.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M8.5946 10.0381C8.16829 10.1542 7.91403 10.5946 8.0267 11.0218L10.4092 20.0559C10.5219 20.4831 10.9588 20.7354 11.3852 20.6193L18.7681 18.6094C19.1944 18.4934 19.4486 18.0529 19.336 17.6257L16.9534 8.59165C16.8407 8.16442 16.4038 7.91218 15.9775 8.02824L8.5946 10.0381ZM15.6603 9.73477L9.7092 11.3549L11.7025 18.9129L17.6536 17.2928L15.6603 9.73477ZM14.8913 15.4232L13.1714 15.8914L13.0908 16.9148L12.0477 17.1987L12.6241 12.1815L13.5331 11.934L16.5111 15.9837L15.468 16.2676L14.8913 15.4232ZM13.2367 15.0625L14.4269 14.7384L13.3808 13.2039L13.2367 15.0625ZM14.1532 22.6204L14.2128 21.7204L15.7853 21.2923L15.7407 21.9644L21.8879 22.385L22.4054 14.5781L20.3531 14.4377L19.9318 12.8404L23.2492 13.0674C23.689 13.0975 24.0217 13.4801 23.9924 13.9221L23.3739 23.2514C23.3446 23.6933 22.9644 24.0272 22.5247 23.9971L14.8963 23.4751C14.4566 23.445 14.1239 23.0623 14.1532 22.6204Z",fill:"#FFF"})),wa=()=>e.createElement("svg",{width:"32",height:"32",viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg",role:"img","aria-label":"Learning objective icon"},e.createElement("path",{d:"M0 16C0 7.16344 7.16344 0 16 0C24.8366 0 32 7.16344 32 16C32 24.8366 24.8366 32 16 32C7.16344 32 0 24.8366 0 16Z",fill:"none"}),e.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M8.80078 10.0006C8.79945 8.89598 9.69388 7.99945 10.7985 7.99819L21.1985 7.98633C22.303 7.98507 23.1994 8.8794 23.2008 9.98391L23.2153 21.9839C23.2166 23.0885 22.3222 23.9851 21.2175 23.9863L10.8176 23.9982C9.71303 23.9994 8.8166 23.1051 8.81527 22.0006L8.80078 10.0006ZM10.4003 9.61402L21.6003 9.60146L21.6158 22.4015L10.4158 22.414L10.4003 9.61402ZM12.0003 11.2005H20.0003V16.0005H12.0003V11.2005ZM17.4003 13.6005L14.7003 15.2005V12.0005L17.4003 13.6005ZM12.0003 16.8005H20.0003V18.4005H12.0003V16.8005ZM18.4003 19.2005H13.6003V20.8005H18.4003V19.2005Z",fill:"#FFF"})),Aa=()=>e.createElement("svg",{width:"32",height:"32",viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg",role:"img","aria-label":"Offline study icon"},e.createElement("path",{d:"M0 16C0 7.16344 7.16344 0 16 0C24.8366 0 32 7.16344 32 16C32 24.8366 24.8366 32 16 32C7.16344 32 0 24.8366 0 16Z",fill:"none"}),e.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M18.4001 7.20117V8.80117L13.6001 8.80117V7.20117L18.4001 7.20117ZM16.0001 9.60117C12.0241 9.60117 8.80005 12.8252 8.80005 16.8012C8.80005 20.7772 12.0241 24.0012 16.0001 24.0012C19.9761 24.0012 23.2001 20.7772 23.2001 16.8012C23.2001 12.8252 19.9761 9.60117 16.0001 9.60117ZM16.0001 22.4012C12.9121 22.4012 10.4001 19.8892 10.4001 16.8012C10.4001 13.7132 12.9121 11.2012 16.0001 11.2012C19.0881 11.2012 21.6001 13.7132 21.6001 16.8012C21.6001 19.8892 19.0881 22.4012 16.0001 22.4012ZM11.9314 9.13254L10.8001 8.00117L7.7373 11.0639L8.86868 12.1953L11.9314 9.13254ZM23.2001 12.0012L24.3315 10.8698L21.5314 8.0698L20.4001 9.20117L23.2001 12.0012ZM19.4427 13.6497L18.5942 12.8012L15.2001 16.1953L16.0486 17.0438L19.4427 13.6497Z",fill:"#FFF"})),Fa=a=>{switch(a){case Q.LEARNING_OBJECTIVE_TYPE_LEARNING:return e.createElement(wa,null);case Q.LEARNING_OBJECTIVE_TYPE_FLASH_CARD:return e.createElement(ka,null);case Q.LEARNING_OBJECTIVE_TYPE_OFFLINE_LEARNING:return e.createElement(Aa,null);case Q.LEARNING_OBJECTIVE_TYPE_EXAM_LO:return e.createElement(pa,null);default:return e.createElement(La,null)}},Ve=a=>{const{loType:t,studyPlanItemStatus:n}=a;return e.createElement(ma,{disabled:n===$.STUDY_PLAN_ITEM_STATUS_ARCHIVED},Fa(t))},Ba=m.exports.forwardRef((a,t)=>{const{onActive:n,onInActive:o,defaultVisible:c=!0,iconButtonProps:l}=a,r=K(),[i,s]=wt(c);m.exports.useImperativeHandle(t,()=>({visible:i}));const p=m.exports.useCallback(async()=>{i?n():o(),await s()},[i,s,n,o]);return e.createElement(ga,g({size:"large",onClick:p,"data-testid":"ButtonShowHide"},l),i?e.createElement(Ca,{color:"primary",fontSize:"small","data-testid":"ButtonShowHide__iconShow"}):e.createElement(Sa,{htmlColor:r.palette.text.primary,fontSize:"small","data-testid":"ButtonShowHide__iconHide"}))}),Ra=a=>{const{studyPlanItemId:t,status:n}=a,o=`studyPlanItem.${t}.status`,{setValue:c,register:l}=H(),r=m.exports.useCallback(()=>c(o,$.STUDY_PLAN_ITEM_STATUS_ARCHIVED,{shouldDirty:!0}),[o,c]),i=m.exports.useCallback(()=>c(o,$.STUDY_PLAN_ITEM_STATUS_ACTIVE,{shouldDirty:!0}),[o,c]);return e.createElement(e.Fragment,null,e.createElement(Ba,{defaultVisible:n===$.STUDY_PLAN_ITEM_STATUS_ACTIVE,onActive:r,onInActive:i,iconButtonProps:{tabIndex:-1,sx:{width:40,height:40}}}),e.createElement("input",g({type:"hidden"},l(o))))},ue=({classes:a,isEditing:t,sxStyles:n})=>{const{register:o}=H(),c=Y(),l=D(v.COURSES),r=D(ie.STUDY_PLANS),i=D(v.TOPICS),s=ee(a.padding,a.dateColumn,a.dateEditColumn);return m.exports.useMemo(()=>{const u={topicName:{key:"colTopicName",title:i("topicName"),cellProps:{className:ee(a.topicColumn,a.topicEditColumn),"data-testid":"StudyPlanItemTableColumns__topicName"}},loName:{key:"colLoName",title:l("studyPlan.loName"),cellProps:{className:ee(a.padding,a.loNameColumn),"data-testid":"StudyPlanItemTableColumns__loName",sx:n==null?void 0:n.padding}},availableFrom:{key:"colAvailableFrom",title:l("studyPlan.availableFrom"),cellProps:{className:s,"data-testid":"StudyPlanItemTableColumns__availableFrom",sx:n==null?void 0:n.padding}},availableUntil:{key:"colAvailableUntil",title:l("studyPlan.availableUntil"),cellProps:{className:s,"data-testid":"StudyPlanItemTableColumns__availableUntil",sx:n==null?void 0:n.padding}},start:{key:"colStart",title:r("columns.start"),cellProps:{className:s,"data-testid":"StudyPlanItemTableColumns__startDate",sx:n==null?void 0:n.padding}},due:{key:"colDue",title:r("columns.due"),cellProps:{className:s,"data-testid":"StudyPlanItemTableColumns__endDate",sx:n==null?void 0:n.padding}},visibility:{key:"colVisibility",title:c("ra.action.show"),cellProps:{className:ee(a.padding,a.visibilityEditColumn),sx:g(g({},n==null?void 0:n.padding),n==null?void 0:n.visibilityEditColumn)}}};return t?[C(g({},u.topicName),{key:"colTopicNameEdit"}),C(g({},u.loName),{key:"colLoNameEdit",render:({loName:d,loType:E,status:b})=>e.createElement(k,{display:"flex",alignItems:"center"},e.createElement(Ve,{loType:E,studyPlanItemStatus:b}),e.createElement(z,{variant:"body2",maxLines:1},d))}),C(g({},u.availableFrom),{key:"colAvailableFromEdit",render:({study_plan_item_id:d,available_from:E})=>e.createElement(ae,{studyPlanItemId:d,fieldName:"availableFrom",value:E})}),C(g({},u.availableUntil),{key:"colAvailableUntilEdit",render:({study_plan_item_id:d,available_to:E})=>e.createElement(ae,{studyPlanItemId:d,fieldName:"availableTo",value:E})}),C(g({},u.start),{key:"colStartEdit",render:({study_plan_item_id:d,start_date:E})=>e.createElement(ae,{studyPlanItemId:d,fieldName:"startDate",value:E})}),C(g({},u.due),{key:"colDueEdit",render:({study_plan_item_id:d,end_date:E})=>e.createElement(ae,{studyPlanItemId:d,fieldName:"endDate",value:E})}),C(g({},u.visibility),{key:"colVisibilityEdit",render:({study_plan_item_id:d,status:E})=>e.createElement(Ra,{studyPlanItemId:d,status:E})}),{key:"colContentStructure",cellProps:{style:{display:"none"}},render:({study_plan_item_id:d,content_structure:E})=>e.createElement("input",g({type:"hidden"},o(`studyPlanItem.${d}.contentStructure`,{value:E})))}]:[g({},u.topicName),C(g({},u.loName),{render:({loName:d,loType:E,status:b})=>e.createElement(k,{display:"flex",alignItems:"center"},e.createElement(Ve,{loType:E,studyPlanItemStatus:b}),e.createElement(z,{variant:"body2",maxLines:1},d))}),C(g({},u.availableFrom),{render:({available_from:d})=>e.createElement(te,{value:d})}),C(g({},u.availableUntil),{render:({available_to:d})=>e.createElement(te,{value:d})}),C(g({},u.start),{render:({start_date:d})=>e.createElement(te,{value:d})}),C(g({},u.due),{render:({end_date:d})=>e.createElement(te,{value:d})})]},[o,t,a,s,n,c,l,r,i])},Na=()=>{const[a,t]=m.exports.useState([]),n=m.exports.useCallback(c=>{t(l=>{const r=l.filter(i=>!Pe(i,c));if(r.length===l.length){const i=l.findIndex(s=>s.topicId===c.topicId);i>-1?r.splice(i,1,c):r.push(c)}return r})},[]),o=m.exports.useCallback((c,l)=>{const r=a.find(u=>u.topicId===c.topicId);if(!r){const u=C(g({},c),{studyPlanItems:[l]});return t(d=>[...d,u])}const{studyPlanItems:i}=r,s=i.filter(u=>!Pe(u,l));if(s.length===i.length&&s.push(l),s.length<=0)return t(a.filter(({topicId:u})=>!Pe(u,r.topicId)));const p=a.findIndex(u=>u.topicId===c.topicId);t(u=>u.map((d,E)=>p===E?C(g({},d),{studyPlanItems:s}):d))},[a]);return{selectedList:a,handleSelectTopic:n,handleSelectItem:o,setSelectedList:t}},$e=({studyPlanItem:a,columns:t,border:n,dataIndex:o,theme:c})=>{const l={backgroundColor:c.palette.grey[100],color:c.palette.grey[400]};return t.map((r,i)=>{var s,p;return e.createElement(ce,C(g({key:r.key},r.cellProps),{style:g(g({},(s=r.cellProps)==null?void 0:s.style),a.status===$.STUDY_PLAN_ITEM_STATUS_ARCHIVED?l:{}),border:n,maxColumnIndex:t.length-1,columnIndex:i}),(p=r.render)==null?void 0:p.call(r,a,o))})},tt=a=>{const{columns:t,data:n,rowKey:o}=a,c=K(),l={columns:t,rowKey:o,border:he(c,Ie.all)};return e.createElement(e.Fragment,null,n.map(({topicId:r,topicName:i,studyPlanItems:s})=>s.length?e.createElement(m.exports.Fragment,{key:r},e.createElement(Ce,C(g({},l),{dataIndex:0,record:s[0],render:p=>e.createElement(e.Fragment,null,e.createElement(ce,g({border:l.border,rowSpan:s.length,style:{verticalAlign:"top"}},p[0].cellProps),e.createElement(z,{variant:"body2",maxLines:1},i)),$e({studyPlanItem:s[0],border:l.border,columns:p.slice(1),dataIndex:0,theme:c}))})),s.slice(1).map((p,u)=>e.createElement(Ce,C(g({},l),{key:fe(p,o),dataIndex:u,record:p,render:d=>$e({studyPlanItem:p,border:l.border,columns:d.slice(1),dataIndex:u,theme:c})})))):null))},Oa=({data:a,rowKey:t})=>{const n=ue({classes:{},isEditing:!0,sxStyles:{padding:{padding:"6px 16px"},visibilityEditColumn:{textAlign:"center"}}});return e.createElement(tt,{columns:n,data:a,rowKey:t})},j="StudyPlanItemTable",w={loNameColumn:`${j}-loNameColumn`,dateColumn:`${j}-dateColumn`,topicColumn:`${j}-topicColumn`,dateEditColumn:`${j}-dateEditColumn`,topicEditColumn:`${j}-topicEditColumn`,visibilityEditColumn:`${j}-visibilityEditColumn`},xe=At("div")(({theme:a})=>({[`& .${w.loNameColumn}`]:{paddingTop:a.spacing(1.25),paddingBottom:a.spacing(1.25)},[`& .${w.dateColumn}`]:{width:"13.8%"},[`& .${w.topicColumn}`]:{width:"17.2%"},[`& .${w.dateEditColumn}`]:{width:"15.8%"},[`& .${w.topicEditColumn}`]:{width:"13%"},[`& .${w.visibilityEditColumn}`]:{width:"1%",whiteSpace:"nowrap",textAlign:"center"}}));xe.displayName="TableContainer";const at=a=>({container:{maxHeight:728},header:{position:"sticky",top:0,backgroundColor:a.palette.background.default,zIndex:a.zIndex.drawer-1},footer:{position:"sticky",bottom:0,backgroundColor:a.palette.background.default,zIndex:a.zIndex.drawer-1}}),nt=a=>{const{isEditing:t,pagination:n,isFetchingStudyPlanItems:o,studyPlanItems:c}=a,l=K(),{formState:{errors:r}}=H(),i=D(v.COURSES),s=Se(w,["loNameColumn","dateColumn","topicColumn"]),p=Se(w,["dateEditColumn","topicEditColumn","visibilityEditColumn"]),u=ue({classes:t?p:s,isEditing:t}),d=ze(ie.STUDY_PLAN_ITEMS);return e.createElement(xe,null,e.createElement(Ft,{columns:u,data:c,errorMessage:r.studyPlanItem&&i("studyPlan.error.dateFormatInvalidGeneric"),styles:at(l),body:{rowKey:d,loading:o,customBody:t?e.createElement(Oa,{data:c,rowKey:d}):e.createElement(tt,{columns:u,data:c,rowKey:d})},footer:{pagination:n,rowsPerPageOptions:[5,10,15]},tableProps:{"data-testid":"StudyPlanItemTable"}}))},Ua=a=>e.createElement(Ge,null,e.createElement(nt,g({},a))),Ma=(a,t)=>({studyPlanItem:a.reduce((n,o)=>{const c=o.studyPlanItems.reduce((l,r)=>{const i={[r.study_plan_item_id]:{availableFrom:G({isoDate:r.available_from,timezone:t,withYear:!0}),availableTo:G({isoDate:r.available_to,timezone:t,withYear:!0}),startDate:G({isoDate:r.start_date,timezone:t,withYear:!0}),endDate:G({isoDate:r.end_date,timezone:t,withYear:!0}),contentStructure:r.content_structure,status:r.status}};return g(g({},l),i)},{});return g(g({},n),c)},{})}),Va=()=>{const a=Y(),t=D(v.COURSES),n=Xe(),{mutate:o,isLoading:c}=da({entity:"studyPlanItem",action:"syllabusStudyPlanItemUpsert"})({onError:l=>{Qe.error(o.name,l),n("ra.common.updatedFail","error")},onSuccess:()=>{const l=a("ra.common.updatedSuccess",{smart_count:t("studyPlan.studyPlanContent")},{lowercase:!0});n(l,"success")}});return{isUpdatingStudyPlanItems:c,updateStudyPlanItems:o}},$a=a=>{const{footerConfirmButtonProps:t,textClose:n,textProceed:o,textSave:c,onClose:l,onProceed:r,onSave:i}=a;return e.createElement(Bt,{disableSpacing:!0,"data-testid":"DialogFooterConfirmStudyPlanItem__dialogActions",sx:{padding:0}},e.createElement(f,{container:!0},e.createElement(f,{item:!0,xs:"auto"},e.createElement(Rt,{onClick:r,"data-testid":"DialogFooterConfirmStudyPlanItem__buttonProceed","aria-label":o},o)),e.createElement(f,{container:!0,item:!0,justifyContent:"flex-end",xs:!0},e.createElement(f,{item:!0},e.createElement(Nt,{color:"default",variant:"text",onClick:l,"data-testid":"DialogFooterConfirmStudyPlanItem__buttonClose","aria-label":n,sx:s=>({marginRight:s.spacing(2)})},n)),e.createElement(f,{item:!0},e.createElement(Ke,g({onClick:i,"data-testid":"DialogFooterConfirmStudyPlanItem__buttonSave","aria-label":c},t),c)))))},He=a=>{const d=a,{children:t,footerConfirmButtonProps:n,textProceed:o,textSave:c,onClose:l,onProceed:r,onSave:i}=d,s=X(d,["children","footerConfirmButtonProps","textProceed","textSave","onClose","onProceed","onSave"]),p=Y(),u=D(v.COURSES);return e.createElement(ve,g({title:p("ra.common.save_change"),footer:e.createElement($a,{footerConfirmButtonProps:n,textClose:p("ra.common.action.cancel"),textProceed:o,textSave:c,onClose:l,onProceed:r,onSave:i}),onClose:l},s),e.createElement(Te,{variant:"body1"},t," ",u("studyPlan.dialog.changesWillBeLostMessage")))},ot=({cellProps:a,checkboxProps:t,children:n})=>e.createElement(ce,g({},a),e.createElement(k,{component:"label",display:"flex",alignItems:"center"},e.createElement(k,{mr:1.5,display:"flex"},e.createElement(Ot,{checkboxProps:C(g({},t),{tabIndex:-1})})),n)),se=ze(ie.STUDY_PLAN_ITEMS),Ha=({studyPlanItem:a,columns:t,dataIndex:n,selectedItems:o,onSelectItem:c})=>{const l=K(),r=he(l,Ie.all),i=o.some(s=>s[se]===a[se]);return e.createElement(e.Fragment,null,t.map((s,p)=>{var y,P,h;const u=p===0,d=C(g({},s.cellProps),{border:r,columnIndex:p,maxColumnIndex:t.length-1,style:g(g(g({},(y=s.cellProps)==null?void 0:y.style),a.status===$.STUDY_PLAN_ITEM_STATUS_ARCHIVED?{backgroundColor:l.palette.grey[100],color:l.palette.grey[400]}:{}),i?{backgroundColor:(P=l.palette.blue)==null?void 0:P[50]}:{})}),E=(h=s.render)==null?void 0:h.call(s,a,n),b=s.key;return u?e.createElement(ot,{key:b,cellProps:d,checkboxProps:{checked:i,onChange:c}},E):e.createElement(ce,g({key:b},d),E)}))},Ya=({topic:a,studyPlanItem:t,selectedTopics:n,selectedItems:o,isLastRow:c,dataIndex:l,onSelectTopic:r,onSelectSPItem:i})=>{const s=K(),p=he(s,Ie.all),u=l===0,{studyPlanItems:d,topicId:E}=a,b=ue({classes:{},isEditing:!0,sxStyles:{padding:{padding:"6px 16px"},visibilityEditColumn:{textAlign:"center"}}}),y=n.some(S=>fe(S,"topicId")===E),P=m.exports.useMemo(()=>{var S;return g(g({},y?{backgroundColor:(S=s.palette.blue)==null?void 0:S[50],borderBottom:`1px solid ${s.palette.grey[300]}`}:{}),c?{}:{borderBottom:"none"})},[c,y,s]),h=m.exports.useMemo(()=>({borderRight:`1px solid ${s.palette.grey[200]}`,borderBottom:c?`1px solid ${s.palette.grey[200]}`:void 0}),[c,s.palette.grey]),I=ya(o,d).length;return e.createElement(Ce,{border:p,rowKey:se,columns:b,dataIndex:l,record:t,render:S=>e.createElement(e.Fragment,null,u?e.createElement(ot,{cellProps:{border:p,style:P},checkboxProps:{indeterminate:y&&I<d.length,onChange:()=>r(a),checked:y}},e.createElement(z,{variant:"body2",maxLines:1},a.topicName)):e.createElement(k,{component:"td",sx:h}),e.createElement(Ha,{selectedItems:o,studyPlanItem:t,columns:S.slice(1),dataIndex:l,onSelectItem:()=>i(a,t)}))})};var Za=m.exports.memo(Ya);const ja=({data:a,selectedTopics:t,selectedItems:n,onSelectTopic:o,onSelectSPItem:c})=>e.createElement(e.Fragment,null,a.map(l=>{const{topicId:r,studyPlanItems:i}=l;return i.length?e.createElement(m.exports.Fragment,{key:r},i.map((s,p)=>{const u=p===i.length-1,d=fe(s,se);return e.createElement(Za,{key:d,topic:l,selectedTopics:t,selectedItems:n,studyPlanItem:s,dataIndex:p,isLastRow:u,onSelectTopic:o,onSelectSPItem:c})})):null}));var Ga=m.exports.memo(ja);const za=({selectedItems:a,setValue:t})=>{const[n,o]=m.exports.useState(),c=m.exports.useCallback(l=>{n&&a.forEach(r=>{const i=`studyPlanItem.${r.study_plan_item_id}.${n.fieldName}`;t(i,l!=null?l:"",{shouldDirty:!0})})},[n,a,t]);return{dialogContext:n,setDialogContext:o,handleUpdateDateTime:c}},Ka=({open:a,onClose:t,dateLabel:n,onUpdateDateTime:o})=>{const c=Y(),l=We({defaultValues:{bulkEditDate:null,bulkEditTime:null}}),{watch:r,resetField:i,handleSubmit:s}=l,p=r("bulkEditDate"),u=()=>{i("bulkEditDate"),i("bulkEditTime"),t()},d=({bulkEditDate:E,bulkEditTime:b})=>{let y=null;E&&(b||(y=Vt(E)),b!=null&&b.value&&(y=$t(E,b.value))),o(y?Ht(y,"yyyy/LL/dd, HH:mm"):null),t()};return e.createElement(Ut,{open:a,onClose:u,title:"Edit Date",textSave:c("ra.common.action.update"),onSave:s(d),methods:l,"data-testid":"BulkEditStudyPlanItem__dialog"},e.createElement(f,{item:!0,container:!0,spacing:1},e.createElement(f,{item:!0,xs:6},e.createElement(Mt,{name:"bulkEditDate",label:n})),e.createElement(f,{item:!0,xs:6},e.createElement(Ea,{name:"bulkEditTime",getOptionSelectedField:"value",disabled:!p,sx:E=>({backgroundColor:p?{}:E.palette.grey[50]})}))))};var Wa=m.exports.memo(Ka),Le=(a=>(a.availableFrom="availableFrom",a.availableUntil="availableTo",a.start="startDate",a.due="endDate",a))(Le||{});const qa=Object.keys(Le),q=Object.values(Le),Ja=({selectedItems:a})=>{const{setValue:t}=H(),{dialogContext:n,setDialogContext:o,handleUpdateDateTime:c}=za({selectedItems:a,setValue:t}),l=D(v.COURSES),r=D(ie.STUDY_PLANS),{onClose:i,onOpen:s,open:p}=Yt(),u=m.exports.useMemo(()=>[l(`studyPlan.bulkEdit.${q[0]}`),l(`studyPlan.bulkEdit.${q[1]}`),l(`studyPlan.bulkEdit.${q[2]}`),l(`studyPlan.bulkEdit.${q[3]}`)].map((b,y)=>({id:y,value:b,disabled:a.length===0})),[a.length,l]),d=m.exports.useCallback(({id:E})=>{const b=qa[E],y=q[E];switch(E){case 0:case 1:o({label:l(`studyPlan.${b}`),fieldName:y});break;case 2:case 3:o({label:r(`columns.${b}`),fieldName:y});break}s()},[s,o,l,r]);return e.createElement(k,{mb:2},e.createElement(Zt,{isTranslated:!0,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},label:"Bulk Action",options:u,onClick:d}),e.createElement(Wa,{open:p,onClose:i,dateLabel:n==null?void 0:n.label,onUpdateDateTime:c}))},Xa=[5,10,15],Qa="topicId",en=Se(w,["dateEditColumn","topicEditColumn","visibilityEditColumn"]),tn=({pagination:a,isFetchingStudyPlanItems:t,studyPlanItems:n})=>{const o=K(),c=at(o),{formState:{errors:l}}=H(),r=D(v.COURSES),i=ue({classes:en,isEditing:!0}),{selectedList:s,handleSelectTopic:p,handleSelectItem:u,setSelectedList:d}=Na(),E=m.exports.useMemo(()=>s.reduce((b,y)=>y.studyPlanItems?[...b,...y.studyPlanItems]:b,[]),[s]);return e.createElement(e.Fragment,null,e.createElement(Ja,{selectedItems:E}),e.createElement(xe,null,e.createElement(jt,{columns:i,data:n,errorMessage:l.studyPlanItem&&r("studyPlan.error.dateFormatInvalidGeneric"),styles:c,body:{rowKey:Qa,loading:t,customBody:e.createElement(Ga,{selectedTopics:s,selectedItems:E,data:n,onSelectTopic:p,onSelectSPItem:u})},footer:{pagination:a,rowsPerPageOptions:Xa},tableProps:{"data-testid":"StudyPlanItemBulkEditTable"},onSelect:d,listSelectedItems:s})))},an=({isFetchingStudyPlanItems:a,pagination:t,studyPlanItems:n,studyPlanId:o,isMasterStudyPlan:c,refetchStudyPlanItems:l,onChangeIsEdit:r,submitCount:i,onChangeSubmitCount:s})=>{const{isEnabled:p}=Gt(zt.STUDY_PLAN_MANAGEMENT_BULK_EDIT),{onPageChange:u,onRowsPerPageChange:d}=t,{timezone:E}=De(),b=Y(),y=D(v.COURSES),P=m.exports.useRef(),h=m.exports.useRef(0),I=m.exports.useRef({target:{value:"10"}}),S=We({reValidateMode:"onBlur",shouldUnregister:!0,defaultValues:Ma(n,E)}),{handleSubmit:_,formState:{isDirty:T,dirtyFields:N}}=S,{isUpdatingStudyPlanItems:L,updateStudyPlanItems:A}=Va(),{onClose:F,onOpen:B,open:Z}=ne(),{onClose:me,onOpen:ke,open:lt}=ne(),{onClose:pe,onOpen:we,open:rt}=ne(),st=m.exports.useCallback(x=>{P.current=x,B()},[B]),W=m.exports.useCallback((x={})=>{var Be;if(!((Be=P.current)!=null&&Be.studyPlanItem))return;let O=Object.entries(P.current.studyPlanItem);const{shouldExitEditMode:dt=!0,onSuccess:Ee}=x;T?O=O.filter(([be])=>N.studyPlanItem[be]):O=[];const ut=O.map(dn=>{var[be,un]=dn,Re=un,{contentStructure:{book_id:mt,chapter_id:pt,topic_id:gt,assignment_id:yt,lo_id:Et,course_id:bt},status:Pt}=Re,Ct=X(Re,["contentStructure","status"]);return g({studyPlanId:o,studyPlanItemId:be,contentStructure:{bookId:mt,chapterId:pt,topicId:gt,assignmentId:{value:yt},loId:{value:Et},courseId:bt},status:ua.StudyPlanItemStatus[Pt]},Ct)});A(ut,{onSuccess:()=>{Ee==null||Ee(),F(),l(),dt&&r(!1)}})},[T,A,N.studyPlanItem,o,F,l,r]),Ae=m.exports.useCallback((x,O)=>{if(T){h.current=O,ke();return}u(x,O)},[T,ke,u]),Fe=m.exports.useCallback(x=>{if(T){I.current=x,we();return}d(x)},[T,we,d]),ge=m.exports.useCallback(()=>{u(null,h.current),me()},[me,u]),ye=m.exports.useCallback(()=>{d(I.current),pe()},[pe,d]),it=m.exports.useCallback(x=>{P.current=x,W({shouldExitEditMode:!1,onSuccess:ge})},[ge,W]),ct=m.exports.useCallback(x=>{P.current=x,W({shouldExitEditMode:!1,onSuccess:ye})},[ye,W]);return m.exports.useEffect(()=>{i!==0&&_(st)()},[i]),Kt(()=>s(0)),e.createElement(e.Fragment,null,e.createElement(Ge,{methods:S},p?e.createElement(tn,{pagination:C(g({},t),{onPageChange:Ae,onRowsPerPageChange:Fe}),isFetchingStudyPlanItems:a,studyPlanItems:n}):e.createElement(nt,{pagination:C(g({},t),{onPageChange:Ae,onRowsPerPageChange:Fe}),isFetchingStudyPlanItems:a,isEditing:!0,studyPlanItems:n})),e.createElement(ve,{footerConfirmButtonProps:{disabled:L},onClose:F,open:Z,onSave:W,textSave:b("ra.common.action.update"),title:y(`studyPlan.dialog.${c?"updateStudyPlanTitle":"updateIndividualStudyPlanTitle"}`)},e.createElement(Te,{variant:"body1"},y(`studyPlan.dialog.${c?"updateStudyPlanMessage":"updateIndividualStudyPlanMessage"}`))),e.createElement(He,{footerConfirmButtonProps:{disabled:L},open:lt,textProceed:y("studyPlan.button.moveWithoutSaving"),textSave:y("studyPlan.button.saveAndMove"),onClose:me,onProceed:ge,onSave:_(it)},y("studyPlan.dialog.confirmPageMoveMessage")),e.createElement(He,{footerConfirmButtonProps:{disabled:L},open:rt,textProceed:y("studyPlan.button.applyWithoutSaving"),textSave:y("studyPlan.button.saveAndApply"),onClose:pe,onProceed:ye,onSave:_(ct)},y("studyPlan.dialog.confirmRowSettingMessage")))},nn=a=>{const{isEditing:t,studyPlanStatus:n,shouldShowArchived:o,onCancel:c,onDisplayChange:l,onEdit:r,onSave:i}=a,s=Y();return t?e.createElement(f,{container:!0,spacing:2},e.createElement(f,{item:!0},e.createElement(Wt,{"aria-label":s("ra.common.action.cancel"),onClick:c},s("ra.common.action.cancel"))),e.createElement(f,{item:!0},e.createElement(Ke,{"aria-label":s("ra.common.action.save"),onClick:i},s("ra.common.action.save")))):e.createElement(k,null,e.createElement(qt,{disabled:n===re.STUDY_PLAN_STATUS_ARCHIVED,control:e.createElement(Jt,{color:"primary",checked:o,onChange:l}),label:e.createElement(M,{variant:"body2"},s(`resources.${v.COURSES}.studyPlan.displayHiddenItems`))}),e.createElement(Xt,{variant:"outlined",disabled:n===re.STUDY_PLAN_STATUS_ARCHIVED,onClick:r}))},on=a=>{const{isFetchingStudyPlanItems:t,studyPlan:n,studyPlanItems:o,pagination:c,refetchStudyPlanItems:l,isMasterStudyPlan:r}=a,[i,s]=m.exports.useState(!0),[p,u]=m.exports.useState(!1),d=D(v.COURSES),[E,b]=m.exports.useState(0),{onClose:y,onOpen:P,open:h}=ne(),I=m.exports.useCallback(({target:{checked:L}})=>{s(L)},[]),S=m.exports.useCallback(()=>{u(!0)},[]),_=m.exports.useCallback(()=>{b(L=>L+1)},[]),T=Y(),N=m.exports.useMemo(()=>i?o:o.map(F=>{var B=F,{studyPlanItems:L}=B,A=X(B,["studyPlanItems"]);return g({studyPlanItems:L.filter(({status:Z})=>Z!==$.STUDY_PLAN_ITEM_STATUS_ARCHIVED)},A)}),[i,o]);return e.createElement(k,{"data-testid":"StudyPlanItemTableAction__root"},e.createElement(qe,{mb:2,title:d("studyPlan.studyPlanContent"),action:e.createElement(nn,{isEditing:p,studyPlanStatus:n.status,shouldShowArchived:i,onCancel:P,onDisplayChange:I,onEdit:S,onSave:_})}),t||!p?e.createElement(k,{"data-testid":"StudyPlanItemTableAction__tableView"},e.createElement(Ua,{isEditing:p,isFetchingStudyPlanItems:t,studyPlanItems:N,pagination:c})):e.createElement(k,{"data-testid":"StudyPlanItemTableAction__tableEdit"},e.createElement(an,{isEditing:p,isFetchingStudyPlanItems:t,pagination:c,studyPlanItems:N,studyPlanId:n.study_plan_id,isMasterStudyPlan:r,refetchStudyPlanItems:l,onChangeIsEdit:u,submitCount:E,onChangeSubmitCount:b})),e.createElement(ve,{footerConfirmButtonProps:{color:"error"},onClose:y,open:h,onSave:()=>{u(!1),y()},textSave:T("ra.action.leave"),title:T("ra.common.cancelDialogTitle")},e.createElement(Te,{variant:"body1"},T("ra.common.cancelDialogMessage"))))},Ye={limit:10,offsetInteger:0,offsetString:""},ln=a=>{const[t,n]=m.exports.useState(Ye),o=m.exports.useRef({total:-1,rowsPerPage:10,currentPage:0}),[c,l]=m.exports.useState(C(g({},t),{offsetInteger:o.current.currentPage*o.current.rowsPerPage+o.current.rowsPerPage}));m.exports.useEffect(()=>{l(C(g({},t),{offsetInteger:t.limit+t.offsetInteger}))},[t]);const{data:r,isFetching:i,refetch:s}=V({entity:"courseReader",action:"TOPIC_GET_LIST_BY_STUDY_PLAN"})({paging:t,studyPlanId:a},{enabled:!0}),{data:p,isFetching:u}=V({entity:"courseReader",action:"TOPIC_GET_LIST_BY_STUDY_PLAN"})({paging:c,studyPlanId:a},{enabled:!0}),d=m.exports.useCallback(I=>{if(i)return;const{currentPage:S}=o.current;if(I>S&&(r==null?void 0:r.nextPage)&&n(g({},r.nextPage)),I<S&&(r==null?void 0:r.nextPage)){const{limit:_,offsetInteger:T}=r.nextPage;n(C(g({},r.nextPage),{offsetInteger:T-_*2}))}o.current.currentPage=I},[r==null?void 0:r.nextPage,i]),E=m.exports.useCallback(I=>{if(i)return;const S=parseInt(I,10);o.current.currentPage=0,o.current.rowsPerPage=S,n(C(g({},Ye),{limit:S}))},[i]),{currentPage:b,rowsPerPage:y,total:P}=o.current,h={page:b,count:P,offset:b*y,limit:y,rowsPerPage:y,nextIconButtonProps:{disabled:!oe(p==null?void 0:p.itemsList)},onPageChange:(I,S)=>d(S),onRowsPerPageChange:({target:{value:I}})=>E(I)};return{result:{data:r,isFetching:u||i,refetch:s},pagination:h}},rn=a=>{const t={studyPlanItemsByAssignmentId:{},studyPlanItemsByLoId:{}},{data:n,isFetching:o,refetch:c}=V({entity:"studyPlan",action:"STUDY_PLAN_GET_ONE"})({study_plan_id:a},{enabled:!0}),{result:{data:l={itemsList:[]},isFetching:r,refetch:i},pagination:s}=ln(a),{studyPlanItemsByAssignmentId:p,studyPlanItemsByLoId:u}=(n==null?void 0:n.study_plan_items.reduce((L,A)=>{const F=g({},L),{assignment_study_plan_item:B,lo_study_plan_item:Z}=A;return Z&&(F.studyPlanItemsByLoId[Z.lo_id]=A),B&&(F.studyPlanItemsByAssignmentId[B.assignment_id]=A),F},g({},t)))||t,d=Object.keys(p),{data:E=[],isFetching:b,refetch:y}=V({entity:"assignment",action:"syllabusAssignmentGetMany"})({assignment_id:d},{enabled:oe(d)}),P=Object.keys(u),{data:h=[],isFetching:I,refetch:S}=V({entity:"learningObjective",action:"LO_GET_MANY_BY_IDS"})({lo_id:P},{enabled:oe(P)}),_=o||r||b||I,T=m.exports.useMemo(()=>_?[]:ia({topics:l.itemsList,assignments:E,learningObjectives:h,studyPlanItemsByAssignmentId:p,studyPlanItemsByLoId:u}),[E,_,h,p,u,l.itemsList]),N=m.exports.useCallback(()=>Promise.all([c({queryKey:new Date().toDateString()}),i(),y(),S()]),[y,S,c,i]);return{studyPlan:n,studyPlanItemsByTopic:T,isFetching:_,pagination:s,refetch:N,refetchStudyPlan:c}},sn={course:{resource:v.COURSES,query:Qt.COURSE_ID,basename:le.SYLLABUS}},cn=()=>{const{search:a}=ea(),{course:t}=m.exports.useMemo(()=>ba(a,sn),[a]),{isLoading:n,data:o}=V({entity:"courses",action:"syllabusCourseGetTitle"})({course_id:t.id||""},{enabled:Boolean(t.id)});return{loading:n,breadcrumbInfos:[{url:`/${le.SYLLABUS}/${v.COURSES}`,translateKey:`resources.${v.COURSES}.name`},{url:`/${le.SYLLABUS}/${v.COURSES}/${t.id}/show`,name:o==null?void 0:o.name,translateKey:`resources.${v.COURSES}.name`}]}},Fn=()=>{const{id:a}=ta(),{studyPlan:t,studyPlanItemsByTopic:n,isFetching:o,pagination:c,refetch:l,refetchStudyPlan:r}=rn(a),{breadcrumbInfos:i,loading:s}=cn(),p=Xe(),[u,d]=m.exports.useState(!1),{convertGradesToArrayGradeObject:E}=Je(),b=m.exports.useCallback(()=>{d(!0)},[d]),y=m.exports.useCallback(()=>{d(!1)},[d]),P=R(t==null?void 0:t.book_id),{data:h}=V({action:"syllabusBookGetTitle",entity:"book"})({book_id:P},{enabled:Boolean(t==null?void 0:t.book_id),onError:T=>{Qe.warn("syllabusBookGetTitle",T),p("ra.message.unableToLoadData","error")}});if(!t&&o)return e.createElement(aa,null);if(!t)return null;const I=R(h==null?void 0:h.name),S=!t.master_study_plan_id&&t.study_plan_type===na.STUDY_PLAN_TYPE_COURSE,_={name:R(t.name),book:{book_id:R(t.book_id),name:I,value:I},grades:E(t.grades),trackSchoolProgress:!!t.track_school_progress};return e.createElement(oa,null,e.createElement(Pa,{loading:s,breadcrumbInfos:i,name:t.name}),e.createElement(qe,{title:R(t.name),action:S&&e.createElement(ha,{studyPlan:t,refetchStudyPlan:r,handleOpenEditStudyPlanDialog:b})}),e.createElement(Ia,{bookId:P,bookName:I,grades:t.grades,trackSchoolProgress:Boolean(t.track_school_progress)}),e.createElement(k,{mb:2,mt:2},e.createElement(la,null)),e.createElement(on,{studyPlan:t,studyPlanItems:n,isFetchingStudyPlanItems:o,pagination:c,refetchStudyPlanItems:l,isMasterStudyPlan:S}),e.createElement(ca,{mode:ra.EDIT,open:u,onClose:y,courseId:R(t.course_id),studyPlanId:a,defaultValues:_,refetchStudyPlanInfo:r}))};export{Fn as default};
