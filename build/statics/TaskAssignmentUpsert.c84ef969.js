import{ci as A,ch as C,r as T,R as e,aj as k,aJ as i,db as F,aK as h,ek as S,aG as f,hM as M,hN as G,cG as P,d0 as U,cR as L,hl as $,aH as w,ew as B,af as R}from"./index.7daee9ef.js";import{r as _,u as D,V as p,v as H,w as K,x as O}from"./useShowSnackbar.da46e481.js";import{F as V}from"./FormUploadMaterials.c32fc30a.js";import{u as W}from"./useHookFormField.c60f8756.js";import{u as Y}from"./useNavigation.f38e637f.js";const j={requiredTitle:{fontWeight:500}},z=()=>{const m=_(),t=D(A.TASK_ASSIGNMENTS),{getValues:c}=C(),[u,o]=W("files",c("files")),l={name:{required:{value:!0,message:m("resources.input.error.required")}}},a=T.exports.useMemo(()=>[{id:p.requireTextNoteSubmission,name:t("requireTextNoteSubmission")},{id:p.requireDuration,name:t("requireDuration")},{id:p.requireCorrectness,name:t("requireCorrectness")},{id:p.requireUnderstandingLevel,name:t("requireUnderstandingLevel")},{id:p.requireAttachmentSubmission,name:t("requireAttachmentSubmission")}],[t]);return e.createElement(k,{"data-testid":"TaskAssignmentForm__root"},e.createElement(i,{container:!0,spacing:3},e.createElement(i,{item:!0,sm:12,md:4},e.createElement(F,null,e.createElement(h,{variant:"h6"},t("attachment")),e.createElement(V,{files:u,isBrightCoveOptional:!0,formUploadFileProps:{multiple:!0,accept:[S.PDF,S.AUDIO,S.IMAGE,S.VIDEO]},onChange:o}))),e.createElement(i,{item:!0,sm:12,md:8},e.createElement(F,null,e.createElement(h,{variant:"h6"},t("taskInformation")),e.createElement(k,{mt:2},e.createElement(i,{container:!0,spacing:2},e.createElement(i,{item:!0,sm:12},e.createElement(f,{required:!0,name:"name",label:t("name"),rules:l.name,inputProps:{"data-testid":"TaskAssignmentForm__name",id:"name"}})),e.createElement(i,{item:!0,sm:12},e.createElement(f,{multiline:!0,rows:6,name:"instruction",label:t("description"),inputProps:{"data-testid":"TaskAssignmentForm__instruction",id:"instruction"}})),e.createElement(i,{item:!0,sm:12},e.createElement(h,{variant:"body1",sx:j.requiredTitle,gutterBottom:!0},t("requiredItems")),e.createElement(M,null,a.map(s=>e.createElement(G,{key:s.id,name:`settings.${s.id}`,label:s.name,sx:{height:"20px",mb:1},checkBoxProps:{id:`settings_${s.id}`,name:`settings.${s.id}`,size:"small"}}))))))))))},J=m=>{const{action:t,searchUrl:c}=m,u=_(),o=H(),l=Y(),a=t===P.CREATE,{mutate:s,isLoading:r}=K({entity:"assignment",action:"ASSIGNMENT_UPSERT"})({onSuccess:({assignmentIdsList:n})=>{const d=u(a?"ra.common.createdSuccess":"ra.common.updatedSuccess",{smart_count:`resources.${A.TASK_ASSIGNMENTS}.task`},{lowercase:!0});o(d,"success"),l.push(`/${U.SYLLABUS}/${A.TASK_ASSIGNMENTS}/${n[0]}/show${c}`)},onError:n=>{O.error(`${t} assignment failed`,n),o(a?"ra.common.createdFail":"ra.common.updatedFail","error")}}),g=T.exports.useCallback(n=>{const{assignment_id:d,content:E,display_order:x,instruction:q,name:y,files:N,settings:v}=n,I=a?0:Number(x);return{name:y,files:N,settings:v,assignmentId:d,content:{loIdList:E.lo_id,topicId:E.topic_id},displayOrder:I,instruction:L(q),requiredGrade:!1,maxGrade:0,assignmentType:$.AssignmentType.ASSIGNMENT_TYPE_TASK}},[a]);return{upsertTaskAssignment:T.exports.useCallback((n,d)=>{if(r)return;const E=g(n);s(E,d)},[g,s,r]),isLoading:r}},ae=m=>{const{action:t,defaultValues:c,searchUrl:u,title:o,onClose:l}=m,a=w({defaultValues:c}),{upsertTaskAssignment:s,isLoading:r}=J({action:t,searchUrl:u}),g=T.exports.useCallback(b=>{s(b,{})},[s]);return e.createElement(B,{title:o,open:!0,footerConfirmButtonProps:{disabled:r},methods:a,onClose:l,onSave:a.handleSubmit(g)},e.createElement(z,null),r&&e.createElement(k,{mt:2},e.createElement(R,{"aria-hidden":!r})))};export{ae as T};
