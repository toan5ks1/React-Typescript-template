var yt=Object.defineProperty,Dt=Object.defineProperties;var At=Object.getOwnPropertyDescriptors;var ie=Object.getOwnPropertySymbols;var We=Object.prototype.hasOwnProperty,ze=Object.prototype.propertyIsEnumerable;var Ye=(s,n,t)=>n in s?yt(s,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[n]=t,S=(s,n)=>{for(var t in n||(n={}))We.call(n,t)&&Ye(s,t,n[t]);if(ie)for(var t of ie(n))ze.call(n,t)&&Ye(s,t,n[t]);return s},K=(s,n)=>Dt(s,At(n));var le=(s,n)=>{var t={};for(var a in s)We.call(s,a)&&n.indexOf(a)<0&&(t[a]=s[a]);if(s!=null&&ie)for(var a of ie(s))n.indexOf(a)<0&&ze.call(s,a)&&(t[a]=s[a]);return t};import{by as ve,bp as Ne,cd as T,R as e,cx as P,eF as ht,r as g,cV as h,aK as Y,aJ as E,eG as Rt,dc as te,b8 as fe,eH as Ce,aj as L,cz as Me,c1 as It,d1 as vt,eI as j,d0 as he,aS as Nt,eJ as Ct,cR as _e,eK as Mt,eb as Le,eL as Xe,c_ as Pt,bb as wt,dd as Pe,eM as Je,b9 as Ze,eN as Ft,eO as Ot,eP as xt,eQ as ue,d5 as et,ch as tt,aG as Ee,cl as nt,eR as kt,eS as at,eT as ge,e8 as Vt,db as Gt,eU as Ae,cq as Ut,aH as Bt,cG as ce,dQ as $t,ew as Ht,de as st,c$ as Yt,cv as me,eq as Wt,bj as zt,eV as ot,eW as Kt,eX as Ke,d6 as qt,b as jt,d8 as Qt,d9 as Xt,da as Jt,eY as Zt,eZ as qe,cA as en}from"./index.7daee9ef.js";import{u as y,L as F,D as q,a as z,C as ee,b as H,W as we,c as C,d as B,i as V,e as pe,f as tn,A as nn,g as Re,h as Se,l as Fe,j as U,T as an,k as rt,m as it,p as sn,n as on,o as rn,q as ln,r as cn,s as dn,t as un,S as mn,v as pn,w as _n}from"./LessonManagementUpsert.db48e44e.js";import{T as Ie}from"./TypographyMaxLines.88e560ab.js";import{M as En}from"./MediaListing.c26c4fa3.js";import"./FormUploadMaterials.c32fc30a.js";import"./BrightcoveLogoIcon.9d2bdc09.js";import"./UploadInput.4c4e4115.js";import"./useMutationV2.0883e427.js";import"./_baseFlatten.b9c8ce3e.js";import"./_baseRest.fb013a79.js";import"./isArrayLikeObject.979eb0a9.js";import"./last.e1193f3d.js";import"./_castArrayLikeObject.2e9ca1e4.js";var gn=ve(Ne.exports.jsx("path",{d:"M7 15h7v2H7zm0-4h10v2H7zm0-4h10v2H7zm12-4h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-.14 0-.27.01-.4.04-.39.08-.74.28-1.01.55-.18.18-.33.4-.43.64-.1.23-.16.49-.16.77v14c0 .27.06.54.16.78s.25.45.43.64c.27.27.62.47 1.01.55.13.02.26.03.4.03h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7-.25c.41 0 .75.34.75.75s-.34.75-.75.75-.75-.34-.75-.75.34-.75.75-.75zM19 19H5V5h14v14z"}),"AssignmentOutlined"),fn=ve(Ne.exports.jsx("path",{d:"M11 15h2v2h-2v-2zm0-8h2v6h-2V7zm.99-5C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}),"ErrorOutlineOutlined"),Ln=ve(Ne.exports.jsx("path",{d:"M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9zm-1 5v5l4.25 2.52.77-1.28-3.52-2.09V8z"}),"HistoryOutlined");const lt=s=>{const{dynamicData:n}=s,t=y(T.LESSON_MANAGEMENT),a=n.find(i=>i.field_id===F.ATTENDANCE_REMARK),r={hasDoubleDash:!0,label:t("attendanceRemark"),value:a==null?void 0:a.value,variant:"horizontal",dataTestidLabel:"DynamicLabelAttendanceRemark__typographyLabel",dataTestidValue:"DynamicLabelAttendanceRemark__typographyValue"};return e.createElement(P,S({},r))},ct=s=>{const{dynamicData:n}=s,t=y(T.LESSON_MANAGEMENT),a=n.find(o=>o.field_id===F.ATTENDANCE_STATUS),r="STUDENT_ATTEND_STATUS_EMPTY",i=(a==null?void 0:a.value)!==r?a==null?void 0:a.value:void 0,l=i&&typeof i=="string"?t(`studentAttendanceStatus.${i}`):void 0,c={hasDoubleDash:!0,label:t("attendanceStatus"),value:l,variant:"horizontal",dataTestidLabel:"DynamicLabelAttendanceStatus__typographyLabel",dataTestidValue:"DynamicLabelAttendanceStatus__typographyValue"};return e.createElement(P,S({},c))};function Sn(){const{locale:s}=ht();return s}const Te=()=>{const s=Sn(),n=y(T.LESSON_MANAGEMENT),t=g.exports.useCallback(r=>{if(r){const i=r.i18n.translations[r.i18n.fallback_language];if(s)return r.i18n.translations[s]||i||n("missingTranslation")}return n("missingTranslation")},[s,n]),a=g.exports.useCallback(r=>({key:r.key,label:t(r.label)}),[t]);return{getDynamicFieldLabel:t,convertToAutocompleteOptionProps:a}},Tn=()=>{const{getDynamicFieldLabel:s}=Te();return(t,a)=>{var l;const r=(l=a.find(c=>c.field_id===t.field_id))==null?void 0:l.value;if(!r)return;if(t.component_config.type===q.AUTOCOMPLETE){const c=t.component_props.options;if(h(c)){const o=c.find(d=>d.key===r);if(o)return s(o.label)}}return r}},bn=s=>{const{field:n,dynamicData:t,labelComponentType:a}=s,{getDynamicFieldLabel:r}=Te(),i=Tn(),l="horizontal",c={label:r(n.label),value:i(n,t),variant:l,dataTestidLabel:"DynamicLabelBase__typographyLabel",dataTestidValue:"DynamicLabelBase__typographyValue"};switch(a){case z.TYPOGRAPHY:const o={children:r(n.label)};return e.createElement(Y,S({},o));case z.TYPOGRAPHY_WITH_VALUE:const d=S({hasDoubleDash:!0},c);return n.display_config.size.md===12&&n.display_config.size.xs===12?e.createElement(P,S({xsLabel:3,xsValue:9},d)):e.createElement(P,S({},d));case z.TYPOGRAPHY_WITH_VALUE_PERCENTAGE:const m=S({hasPercentage:!0},c);return e.createElement(P,S({},m));default:return e.createElement(e.Fragment,null)}},yn={[ee.TYPOGRAPHY]:z.TYPOGRAPHY,[ee.TEXT_FIELD_PERCENTAGE]:z.TYPOGRAPHY_WITH_VALUE_PERCENTAGE,[ee.AUTOCOMPLETE]:z.TYPOGRAPHY_WITH_VALUE,[ee.TEXT_FIELD]:z.TYPOGRAPHY_WITH_VALUE,[ee.TEXT_FIELD_AREA]:z.TYPOGRAPHY_WITH_VALUE},dt=s=>{const{field:n,dynamicLessonReportData:t}=s;return e.createElement(bn,{field:n,dynamicData:t,labelComponentType:yn[n.component_config.type]})},Dn=s=>{const{fields:n,dynamicLessonReportData:t}=s,a=r=>{switch(r.component_config.type){case H.ATTENDANCE_STATUS:return e.createElement(ct,{dynamicData:t});case H.ATTENDANCE_REMARK:return e.createElement(lt,{dynamicData:t});default:return e.createElement(dt,{field:r,dynamicLessonReportData:t})}};return h(n)?e.createElement(E,{container:!0,item:!0,spacing:2},n.map(r=>e.createElement(E,K(S({item:!0},r.display_config.size),{key:r.field_id}),a(r)))):e.createElement(e.Fragment,null)},be=(s,n)=>Rt(s+1,n),An=s=>{const{dataConfig:n,previousLessonReportData:t}=s;return e.createElement(e.Fragment,null,n.map((a,r)=>e.createElement(E,{container:!0,spacing:2,key:a.section_id},e.createElement(E,{item:!0,xs:12},e.createElement(Dn,{fields:a.fields,dynamicLessonReportData:t})),!be(r,n.length)&&e.createElement(E,{item:!0,xs:12},e.createElement(we,null,e.createElement(te,null))))))},hn=s=>{const{open:n,onSave:t,onClose:a,previousLessonReportDataConfig:r,previousLessonReportData:i}=s,l=C(),c=y(T.LESSON_REPORTS),o=(d,m)=>!h(m)||!h(d)?e.createElement(Ce,{noDataMessage:l("ra.message.noDataInformation")}):e.createElement(L,{pt:1,"data-testid":"DialogPreviousLessonReport__content"},e.createElement(An,{dataConfig:d,previousLessonReportData:m}));return e.createElement(fe,{open:n,onSave:t,onClose:a,textSave:l("ra.action.close"),title:c("previousReport"),shouldShowCancelButton:!1,maxWidth:"md",minWidthBox:"md"},o(r,i))},Rn=(s,n)=>{const t=s.find(a=>a.field_id===n.field_id);switch(t==null?void 0:t.value_type){case"VALUE_TYPE_INT":return t.int_value;case"VALUE_TYPE_STRING":return t.string_value;default:return t==null?void 0:t.string_value}},In=(s,n)=>{const t=[];return n.sections.forEach(a=>{a.fields.forEach(r=>{if(r.value_type==="VALUE_TYPE_NULL"||[String(F.ATTENDANCE_STATUS),String(F.ATTENDANCE_REMARK)].includes(r.field_id))return;const l=Rn(s.partner_dynamic_form_field_values,r);l&&t.push({field_id:r.field_id,value:l})})}),t},vn=(s,n)=>s.map(t=>({studentId:t.student.student_id,dynamicLabelValues:In(t,n)})),Nn=(s,n,t)=>{const a=s.flatMap(i=>i.fields),r=[];return a.forEach(i=>{if(i.value_type==="VALUE_TYPE_NULL")return;let l=null;switch(i.field_id){case F.ATTENDANCE_STATUS:l=t.attendance_status;break;case F.ATTENDANCE_REMARK:l=t.attendance_remark;break;default:l=Cn(n,i);break}l&&r.push({field_id:i.field_id,value:l})}),r},Cn=(s,n)=>{const t=s.find(a=>a.field_id===n.field_id);switch(t==null?void 0:t.value_type){case"VALUE_TYPE_INT":return t.int_value;case"VALUE_TYPE_STRING":return t.string_value;default:return t==null?void 0:t.string_value}},Mn={defaultOffset:0,defaultLimit:10};function Pn(s=Mn){const[n,t]=g.exports.useState(s.defaultOffset||0),[a,r]=g.exports.useState(s.defaultLimit||10),i=g.exports.useCallback((c,o)=>{let d=o*a;t(d)},[a]),l=g.exports.useCallback(c=>{r(parseInt(c.target.value,10)),t(0)},[]);return g.exports.useMemo(()=>({offset:n,page:Math.ceil(n/a),limit:a,rowsPerPage:a,setOffset:t,setLimit:r,onPageChange:i,onRowsPerPageChange:l}),[l,i,n,a])}function wn({formConfigId:s}){var i;const n=C(),t=B(),{data:a}=V({entity:"partnerFormConfigs",action:"partnerFormConfigsGetOne"})({form_config_id:s},{enabled:Boolean(s),onError:l=>{var c;(c=window.warner)==null||c.warn("useGetPartnerFormConfigById getPartnerConfig",l),t(`${n("ra.message.unableToLoadData")} ${l.message}`,"error")}});return{dataConfig:((i=a==null?void 0:a.form_config_data)==null?void 0:i.sections)||[]}}const Fn=s=>{const{studentId:n,courseId:t,reportId:a,lessonId:r}=s,i=C(),l=B(),c={report_user_id:n,report_course_id:t,report_id:a,report_lesson_id:r},{data:o}=V({entity:"lessonReports",action:"lessonReportsGetOneByCourseIdAndStudentIdAndReportIdAndLessonId"})(S({},c),{enabled:Boolean(c.report_course_id)&&Boolean(c.report_user_id),onError(u){var p;(p=window.warner)==null||p.warn("usePreviousLessonReport getLessonReport",u),l(`${i("ra.message.unableToLoadData")} ${u.message}`,"error")}}),{data:d}=V({entity:"partnerDynamicFormFieldValues",action:"partnerDynamicFormFieldValuesGetOneByLessonReportDetailsIdAndStudentId"})({user_id:n,report_id:(o==null?void 0:o.lesson_report_id)||""},{enabled:Boolean(o==null?void 0:o.lesson_report_id),onError(u){var p;(p=window.warner)==null||p.warn("usePreviousLessonReport getPartnerFormDynamicValues",u),l(`${i("ra.message.unableToLoadData")} ${u.message}`,"error")}}),{data:m}=V({entity:"lessonMembers",action:"lessonMembersGetOneLessonMemberByUserIdAndCourseIdAndLessonId"})({course_id:t,user_id:n,lesson_id:(o==null?void 0:o.lesson_id)||""},{enabled:Boolean(o&&r),onError(u){var p;(p=window.warner)==null||p.warn("usePreviousLessonReport getLessonMember",u),l(`${i("ra.message.unableToLoadData")} ${u.message}`,"error")}});return{formConfigId:(o==null?void 0:o.form_config_id)||"",dynamicValues:d||[],attendanceValues:m||{}}},ut=s=>{const{studentId:n,courseId:t,reportId:a,lessonId:r}=s,i=y(T.LESSON_MANAGEMENT),[l,c]=g.exports.useState(!1),{dynamicValues:o,attendanceValues:d,formConfigId:m}=Fn({studentId:n,courseId:t,reportId:a,lessonId:r}),{dataConfig:u}=wn({formConfigId:m}),p=g.exports.useMemo(()=>!h(u)||!h(o)||!d?[]:Nn(u,o,d),[d,u,o]),_=()=>{c(!1)},D=h(p)?"previousReport":"studentDoesNotHavePreviousLessonReportForThisCourse";return e.createElement(L,{title:i(D)},e.createElement(Me,{onClick:()=>c(!0),startIcon:e.createElement(Ln,null),fullWidth:!0,disabled:!h(p),id:"ButtonPreviousReport__button","data-testid":"ButtonPreviousReport__button"},i("previousReport")),e.createElement(hn,{open:l,onClose:_,onSave:_,previousLessonReportData:p,previousLessonReportDataConfig:u}))};function On(){const[s,n]=g.exports.useState(null);return g.exports.useEffect(()=>{const t=It.registerListener("PROFILE",a=>{a&&n(a)},{run1st:!0});return()=>{typeof t=="function"&&t()}},[]),{userProfile:s}}const xn=s=>{const{courseId:n,studentId:t}=s,a=C(),r=B(),{userProfile:i}=On(),l=(i==null?void 0:i.userGroup)===vt.USER_GROUP_TEACHER,c=Boolean(l&&n&&t),{data:o}=V({entity:"lessonReports",action:"lessonReportsRetrievePartnerDomain"})({type:j.DomainType.DOMAIN_TYPE_TEACHER},{cacheFor:3e5,enabled:c,onError(m){var u;(u=window.warner)==null||u.warn("useCreateViewStudyPlanLink fetchPartnerDomain",m),r(`${a("ra.message.unableToLoadData")} ${m.message}`,"error")}}),d=o==null?void 0:o.domain;return l&&!d||!l&&!n?"":l?`${d}#/courseDetail?course_id=${n}/studentStudyPlan?student_id=${t}`:`/${he.SYLLABUS}/${Nt.COURSES}/${n}/show?tab=CourseShow__studyPlanTab`},mt=s=>{const c=s,{studentId:n,courseId:t}=c,a=le(c,["studentId","courseId"]),r=y(T.LESSON_MANAGEMENT),i=xn({courseId:t,studentId:n}),l=i?"viewStudyPlan":"errors.unableToFetchTheLinkToThisStudentStudyPlan";return e.createElement(L,{title:r(l)},e.createElement(Me,S({id:"ButtonViewStudyPlan__button","data-testid":"ButtonViewStudyPlan__button",onClick:()=>Ct(i),startIcon:e.createElement(gn,null),fullWidth:!0,disabled:!i},a),r("viewStudyPlan")))},kn=s=>{const{fields:n,dynamicLessonReportData:t,courseId:a,studentId:r,reportId:i,lessonId:l}=s,c=o=>{switch(o.component_config.type){case H.BUTTON_PREVIOUS_REPORT:{const d={courseId:a,studentId:r,reportId:i,lessonId:l||""};return e.createElement(ut,S({},d))}case H.LINK_VIEW_STUDY_PLAN:return e.createElement(mt,{courseId:a,studentId:r});case H.ATTENDANCE_STATUS:return e.createElement(ct,{dynamicData:t});case H.ATTENDANCE_REMARK:return e.createElement(lt,{dynamicData:t});default:return e.createElement(dt,{field:o,dynamicLessonReportData:t})}};return h(n)?e.createElement(E,{container:!0,item:!0,spacing:2},n.map(o=>e.createElement(E,K(S({item:!0},o.display_config.size),{key:o.field_id}),c(o)))):e.createElement(e.Fragment,null)},Vn=({courseInfo:s})=>{const n=y(T.LESSON_REPORTS);return e.createElement(e.Fragment,null,e.createElement(L,{justifyContent:"space-between"},e.createElement(L,{mb:2},e.createElement(Y,{variant:"body2"},n("generalInfo"))),e.createElement(E,{container:!0},e.createElement(E,{item:!0,xs:12,sm:6},e.createElement(P,{variant:"horizontal",value:s.name,label:n("course")})),e.createElement(E,{item:!0,xs:12,sm:6},e.createElement(P,{variant:"horizontal",value:_e(s.subject),label:n("subject")})))),e.createElement(L,{my:3},e.createElement(te,null)))},Gn=s=>{const{dataConfig:n,lessonReportDetailOfStudent:t,hasGeneralInfo:a,reportId:r,lessonId:i}=s,{dynamicLessonReportData:l,course:c,previousLessonReport:o,user:d}=t,m=y(T.LESSON_MANAGEMENT),u=()=>a?c?e.createElement(Vn,{courseInfo:c}):e.createElement(L,{mb:1},e.createElement(Mt,{color:"error",elevation:0,severity:"error"},m("errors.studentDoesNotBelongToAnyCourse"))):e.createElement(e.Fragment,null);return e.createElement(e.Fragment,null,e.createElement(u,null),n.sections.map((p,_)=>e.createElement(E,{container:!0,spacing:2,key:p.section_id},e.createElement(E,{item:!0,xs:12},e.createElement(kn,{fields:p.fields,dynamicLessonReportData:l,previousLessonReport:o,courseId:_e(c==null?void 0:c.course_id),studentId:d.user_id,reportId:r,lessonId:i})),!be(_,n.sections.length)&&e.createElement(E,{item:!0,xs:12},e.createElement(we,null,e.createElement(te,null))))))},Un=s=>{const{studentLessonReportData:n,isInLessonManagement:t,lessonReports:a}=s,r=y(T.LESSON_MANAGEMENT);return e.createElement(Le,null,e.createElement(L,{p:3},e.createElement(Y,{variant:"subtitle1"},n.user.name)),e.createElement(Xe,null),e.createElement(L,{p:3},a.partner_form_config?e.createElement(Gn,{lessonReportDetailOfStudent:n,dataConfig:a.partner_form_config.form_config_data,hasGeneralInfo:!t,reportId:a.lesson_report_id,lessonId:a.lesson_id}):e.createElement(Y,null,r("errors.errorWhileFetchingFormConfig",{message:r("errors.canNotGetPartnerFormConfig")}))))},pt=()=>{const s=B(),n=C(),{mutateAsync:t}=pe({entity:"lessonReports",action:"lessonReportsSubmit"})(),{mutateAsync:a}=pe({entity:"lessonReports",action:"lessonReportsSaveDraft"})(),{mutateAsync:r}=pe({entity:"lessonReports",action:"lessonReportsDelete"})(),i=g.exports.useCallback(async o=>{const{data:d,onSuccess:m,onError:u}=o;await t({data:d},{onSuccess:m,onError:p=>{var _;s(n("ra.manabie-error.unknown"),"error"),(_=window.warner)==null||_.warn(`Error MutationLessonIndividualReport: ${p.message}`),u==null||u()}})},[t,s,n]),l=g.exports.useCallback(async o=>{const{data:d,onSuccess:m,onError:u}=o;await a({data:d},{onSuccess:m,onError:p=>{var _;s(n("ra.manabie-error.unknown"),"error"),(_=window.warner)==null||_.warn(`Error MutationLessonIndividualReport: ${p.message}`),u==null||u()}})},[a,s,n]),c=g.exports.useCallback(async o=>{const{data:d,onSuccess:m,onError:u}=o;await r({data:d},{onSuccess:m,onError:p=>{var _;s(n("ra.manabie-error.unknown"),"error"),(_=window.warner)==null||_.warn(`Error MutationLessonIndividualReport: ${p.message}`),u==null||u()}})},[r,s,n]);return{upsertLessonReport:i,saveDraftLessonReport:l,deleteLessonReport:c}},Bn=s=>{const{lessonReports:n,onEdit:t,onDelete:a}=s,r=C(),i=y(T.LESSON_MANAGEMENT),[l,c]=g.exports.useState(!1),{deleteLessonReport:o}=pt(),d=async()=>{await o({data:{lessonReportId:n.lesson_report_id},onSuccess:a})},m=n.report_submitting_status===tn.LESSON_REPORT_SUBMITTING_STATUS_SUBMITTED?"success":"default";return e.createElement(e.Fragment,null,e.createElement(E,{container:!0},e.createElement(E,{item:!0,xs:6,container:!0,alignItems:"center"},e.createElement(L,{mr:2},e.createElement(Pt,{"data-testid":"DetailSectionStudentReportActionBar__chipLessonReportStatus",label:i(`status.${n.report_submitting_status}`),status:m})),e.createElement(wt,{title:i("reportDetail"),disablePadding:!0})),e.createElement(E,{item:!0,xs:6,container:!0,alignItems:"center",justifyContent:"flex-end"},e.createElement(Pe,{startIcon:e.createElement(Je,null),onClick:t,"data-testid":"DetailSectionStudentReportActionBar__buttonEdit"},r("ra.action.edit")))),e.createElement(fe,{open:l,title:i("deleteLessonReport"),textSave:r("ra.common.action.delete"),onClose:()=>c(!1),onSave:async()=>await d(),footerConfirmButtonProps:{color:"error"},"data-testid":"DetailSectionStudentReportActionBar__dialogDelete"},e.createElement(Ze,{variant:"body1"},i("areYouSureYouWantToDeleteTheLessonReport"))))},je={errorIcon:s=>({color:s.palette.error.main}),listItemText:{wordBreak:"break-word"}},_t=s=>{const{students:n,selectedIndexProp:t,onSelect:a,errors:r}=s,i=y(T.LESSON_MANAGEMENT),l=s.hasOwnProperty("selectedIndexProp"),[c,o]=g.exports.useState(0),d=u=>{if(r&&r[u])return e.createElement(L,{"data-testid":"ListStudent__iconError",title:i("messages.needToFillInTheRequiredInformation")},e.createElement(fn,{sx:je.errorIcon}))},m=(u,p)=>{if(l){a({index:u,studentId:p});return}o(u),a({index:u,studentId:p})};return e.createElement(Le,{fullHeight:!0,"data-testid":"ListStudent__root"},e.createElement(Ft,{disablePadding:!0,component:"nav"},n.map((u,p)=>{const _=(l?t:c)===p;return e.createElement(L,{key:u.user.user_id},e.createElement(Ot,{button:!0,color:"default",selected:_,onClick:()=>m(p,u.user.user_id),"data-testid":"ListStudent__listItem",divider:!be(p,n.length)},e.createElement(xt,{sx:je.listItemText},e.createElement(Ie,{maxLines:2,variant:"body1"},u.user.name)),Boolean(r)&&d(p)))})))},$n=s=>{const{students:n,attendanceValues:t,onChangeAttendanceValue:a}=s,r=y(T.LESSON_MANAGEMENT),i=[{key:"colStudentName",title:r("columns.studentName"),cellProps:{style:{width:"20%"}},render:l=>e.createElement(ue,{variant:"body2","data-testid":"TableBulkUpdateAttendanceTable__studentName"},l.user.name)},{key:"colAttendanceStatus",title:r("attendanceStatus"),cellProps:{style:{width:"auto"}},render:(l,c)=>{if(c!==void 0)return e.createElement(nn,{value:t[c],onChange:o=>a(c,o),"data-testid":"TableBulkUpdateAttendanceTable__autocompleteAttendance",limitChipText:"Ellipsis",getOptionSelectedField:"key"})}}];return e.createElement(et,{withIndex:!0,columns:i,data:n,body:{loading:!1,rowKey:"id"}})},Hn=s=>{const _=s,{students:n,onSave:t,dynamicFieldAttendanceValues:a}=_,r=le(_,["students","onSave","dynamicFieldAttendanceValues"]),i=y(T.LESSON_MANAGEMENT),{setValue:l,clearErrors:c}=tt(),o=g.exports.useMemo(()=>a.map(b=>{if(Re(b))return b;const f="STUDENT_ATTEND_STATUS_ATTEND";return Se(i).find(R=>R.key===f)}),[a,i]),[d,m]=g.exports.useState(o),u=(D,b)=>{let f=[...d];f[D]=b,m(f)},p=()=>{n.forEach((D,b)=>{const f="attendance_status",A=Fe(b,f),R=d[b];l(A,R),c(`lessonReportDetails.${b}.dynamicFields.${f}`)}),t()};return e.createElement(fe,S({fullWidth:!0,maxWidth:"md",minWidthBox:"md",onSave:p,"data-testid":"DialogBulkUpdateAttendance__dialog",title:i("bulkUpdateAttendance")},r),e.createElement(L,{mt:1},e.createElement($n,{students:n,attendanceValues:d,onChangeAttendanceValue:u})))},Yn=s=>{const{fieldProps:n,name:t}=s,a=C(),r=y(T.LESSON_MANAGEMENT),i={name:t,label:r("attendanceRemark"),required:n.is_required,rules:{required:{value:n.is_required,message:a("resources.input.error.required")}}};return e.createElement(L,{"data-testid":"DynamicFieldAttendanceRemark__container"},e.createElement(Ee,S({id:`DynamicFieldAttendanceRemark__textField__${n.field_id}`,"data-testid":`DynamicFieldAttendanceRemark__textField__${n.field_id}`},i)))},Wn=s=>{const{fieldProps:n,name:t}=s,a=C(),r=y(T.LESSON_MANAGEMENT),i={name:t,label:r("attendanceStatus"),required:n.is_required,rules:{required:{value:n.is_required,message:a("resources.input.error.required")}}},l=S({options:Se(r),optionLabelKey:"label",getOptionSelectedField:"key"},i);return e.createElement(L,{"data-testid":"DynamicFieldAttendanceStatus__container"},e.createElement(nt,S({id:`DynamicFieldAttendanceStatus__autocomplete__${n.field_id}`,"data-testid":`DynamicFieldAttendanceStatus__autocomplete__${n.field_id}`},l)))},de=100,zn=s=>e.createElement(Ee,S({InputProps:{endAdornment:e.createElement(kt,{position:"end"},`/${de}%`)},inputProps:{min:0,max:de,onInput:n=>{const t=parseInt(n.currentTarget.value,10);n.currentTarget.value=`${t}`,t>de&&(n.currentTarget.value=`${de}`),t<0&&(n.currentTarget.value="0")}},type:"number"},s)),Kn=s=>{const{componentType:n,fieldProps:t,name:a}=s,r=C(),{getDynamicFieldLabel:i,convertToAutocompleteOptionProps:l}=Te(),c=g.exports.useMemo(()=>({name:a,label:i(t.label),required:t.is_required,rules:{required:{value:t.is_required,message:r("resources.input.error.required")}}}),[t,a,r,i]),o=()=>{var d,m,u,p;switch(n){case q.AUTOCOMPLETE:{const _=S({options:(m=(d=t.component_props)==null?void 0:d.options)==null?void 0:m.map(D=>l(D)),optionLabelKey:(u=t.component_props)==null?void 0:u.optionLabelKey,getOptionSelectedField:"key"},c);return e.createElement(nt,S({id:`DynamicFieldBase__autocomplete__${t.field_id}`,"data-testid":`DynamicFieldBase__autocomplete__${t.field_id}`},_))}case q.TEXT_FIELD_AREA:{const _=S({InputProps:(p=t.component_props)==null?void 0:p.InputProps},c);return e.createElement(Ee,S({id:`DynamicFieldBase__textFieldArea__${t.field_id}`,"data-testid":`DynamicFieldBase__textFieldArea__${t.field_id}`},_))}case q.TYPOGRAPHY:{const _={children:i(t.label)};return e.createElement(L,{display:"flex",alignItems:"center",height:"100%"},e.createElement(Y,S({id:`DynamicFieldBase__typography__${t.field_id}`,"data-testid":`DynamicFieldBase__typography__${t.field_id}`},_)))}case q.TEXT_FIELD_PERCENTAGE:return e.createElement(zn,S({id:`DynamicFieldBase__textFieldPercentage__${t.field_id}`,"data-testid":`DynamicFieldBase__textFieldPercentage__${t.field_id}`},c));case q.TEXT_FIELD:default:return e.createElement(Ee,S({id:`DynamicFieldBase__textField__${t.field_id}`,"data-testid":`DynamicFieldBase__textField__${t.field_id}`},c))}};return e.createElement(L,{"data-testid":"DynamicFieldBase__container",height:"100%"},o())},qn=s=>{const{fields:n,reportIndex:t,student:a,lessonReportId:r,lessonId:i}=s,l=c=>{var d,m;const o={fieldProps:c,name:Fe(t,c.field_id)};switch(c.component_config.type){case H.BUTTON_PREVIOUS_REPORT:{const u=r.length?r:null;return e.createElement(ut,{courseId:U((d=a.course)==null?void 0:d.course_id),studentId:a.user.user_id,reportId:u,lessonId:i})}case H.LINK_VIEW_STUDY_PLAN:return e.createElement(mt,{courseId:U((m=a.course)==null?void 0:m.course_id),studentId:a.user.user_id});case H.ATTENDANCE_STATUS:return e.createElement(Wn,S({},o));case H.ATTENDANCE_REMARK:return e.createElement(Yn,S({},o));default:return e.createElement(Kn,K(S({},o),{componentType:c.component_config.type}))}};return e.createElement(E,{container:!0,spacing:2},n.map(c=>e.createElement(E,K(S({item:!0},c.display_config.size),{key:c.field_id}),l(c))))},jn=s=>{const{title:n,actionsList:t=[]}=s,a=t.map(i=>i.action),r=g.exports.useCallback(i=>{const l=t.find(c=>c.action.action===i);l==null||l.mutation()},[t]);return e.createElement(L,{display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%"},e.createElement(Y,{variant:"subtitle1","data-testid":"FormSectionReportDetailTitleBar__title"},n),h(t)&&e.createElement(at,{actions:a,onAction:r,recordName:n}))},Qn=s=>{const{student:n,lessonId:t,reportIndex:a,configSections:r,isVisible:i=!0,lessonReportId:l}=s,c=i?"block":"none";return e.createElement(L,{key:n.user.user_id,display:c,"data-testid":`FormSectionIndividualLessonReportDetailPage__formSectionRoot.${a}`},e.createElement(Le,null,e.createElement(L,{px:3,py:2},e.createElement(jn,{title:n.user.name,actionsList:[]})),e.createElement(Xe,null),e.createElement(L,{p:3},h(r)&&r.map((o,d)=>h(o.fields)?e.createElement(E,{container:!0,item:!0,spacing:2,key:o.section_id},e.createElement(E,{item:!0,xs:12},e.createElement(qn,{student:n,lessonId:t,fields:o.fields,reportIndex:a,lessonReportId:l})),!be(d,r.length)&&e.createElement(E,{item:!0,xs:12},e.createElement(we,null,e.createElement(te,null)))):e.createElement(e.Fragment,null)))))},Xn=s=>{var u;const{students:n,reports:t,selectedIndex:a,partnerFormConfig:r,lessonId:i,lessonReportId:l}=s,{data:c,isLoading:o,error:d}=r,m=(u=c==null?void 0:c.form_config_data)==null?void 0:u.sections;if(o)return e.createElement(ge,null);if(m&&h(n)&&h(t)){const p=n.map((_,D)=>{const b=a===D;return e.createElement(Qn,{key:_.user.user_id,lessonId:i,lessonReportId:l,student:_,reportIndex:D,configSections:m,isVisible:b})});return e.createElement(L,null,p)}return e.createElement(Y,null,d==null?void 0:d.message)},Jn=(s,n,t)=>{const r=Se(t).find(i=>i.key===n.attendance_status);return{lessonId:s,student:n,dynamicFields:{[F.ATTENDANCE_STATUS]:r||null,[F.ATTENDANCE_REMARK]:n.attendance_remark||null}}},Zn=s=>{const{lessonReport:n,partnerFormConfig:t}=s,{students:a,lessonReportDetails:r,lessonId:i,lessonReportId:l}=n,[c,o]=g.exports.useState(!1),[d,m]=g.exports.useState(0),u=y(T.LESSON_MANAGEMENT),p=B(),{control:_,getValues:D,formState:{errors:b}}=tt(),{fields:f=[],append:A}=Vt({control:_,name:"lessonReportDetails",shouldUnregister:!0});g.exports.useEffect(()=>{const N=a.map(x=>{const w=r.find(I=>I.student.user.user_id===x.user.user_id);return w||Jn(i,x,u)});A(N)},[r]);const R=f.reduce((N,x)=>{const w=a.findIndex(G=>G.user.user_id===x.student.user.user_id),I=Fe(w,F.ATTENDANCE_STATUS),k=D(I);return N.push(k),N},[]),M=()=>{o(!1),p(u("messages.bulkActionSuccessfully"))};return e.createElement(e.Fragment,null,e.createElement(Gt,null,e.createElement(an,{"data-testid":"FormLessonManagementReportsIndividualUpsert__tableAction",title:u("lessonReport"),ButtonAddProps:{onClick:()=>o(!0),children:u("actions.bulkAction"),startIcon:null},shouldShowDeleteButton:!1}),e.createElement(E,{container:!0,spacing:2},e.createElement(E,{item:!0,xs:4},e.createElement(_t,{selectedIndexProp:d,onSelect:({index:N})=>m(N),students:a,errors:b.lessonReportDetails})),e.createElement(E,{item:!0,xs:8},e.createElement(Xn,{lessonId:i,lessonReportId:l,students:a,reports:f,selectedIndex:d,partnerFormConfig:t})))),c&&e.createElement(Hn,{open:c,onClose:()=>o(!1),onSave:M,students:a,dynamicFieldAttendanceValues:R}))};function ea(s){const{featureName:n}=s,t=y(T.LESSON_MANAGEMENT),[a,r]=g.exports.useState(void 0),{data:i,isLoading:l}=V({entity:"partnerFormConfigs",action:"partnerFormConfigsGetOneLatestConfig"})({feature_name:n},{enabled:Boolean(n),onSuccess:c=>{var o;if(!Boolean(c)){const d=new Error(t("errors.errorWhileFetchingFormConfig",{message:t("errors.canNotGetPartnerFormConfig")}));(o=window.warner)==null||o.warn("useGetLatestPartnerFormConfig fetch error: there is no partner-form-config"),r(d)}},onError:c=>{var o;(o=window.warner)==null||o.warn("useGetLatestPartnerFormConfig fetch error: ",c),r(c)}});return{data:i,isLoading:l,error:a}}const ta=()=>{const[s,n]=Ae(!1),[t,a]=Ae(!1),[r,i]=Ae(!1);return{formActions:{isSubmittingForm:s,isVisibleSubmitDialog:t,isVisibleCancelDialog:r},submitFormActions:{handleSubmittingForm:()=>n(!0),handleSubmittedForm:()=>n(!1)},submitDialogActions:{handleOpenSubmitDialog:()=>a(!0),handleCloseSubmitDialog:()=>a(!1)},cancelDialogActions:{handleOpenCancelDialog:()=>i(!0),handleCloseCancelDialog:()=>i(!1)}}},na={disableDiscard:!1,disableCancel:!1,disableSubmitAll:!1},aa=s=>{const{onDiscard:n,onSaveDraft:t,onSubmitAll:a,disableActions:r=na}=s,{disableDiscard:i,disableCancel:l,disableSubmitAll:c}=r,o=C(),d=y(T.LESSON_MANAGEMENT);return e.createElement(E,{container:!0,justifyContent:"space-between"},e.createElement(E,{item:!0,xs:6},e.createElement(Me,{color:"error",onClick:n,disabled:i,"data-testid":"FooterLessonManagementReportsIndividualUpsert__buttonDiscard"},o("ra.action.discard"))),e.createElement(E,{container:!0,spacing:2,item:!0,xs:6,justifyContent:"flex-end"},e.createElement(E,{item:!0},e.createElement(Pe,{onClick:t,disabled:l,"data-testid":"FooterLessonManagementReportsIndividualUpsert__buttonSaveDraft"},o("ra.common.saveDraft"))),e.createElement(E,{item:!0},e.createElement(Ut,{onClick:a,disabled:c,"data-testid":"FooterLessonManagementReportsIndividualUpsert__buttonSubmitAll"},d("actions.submitAll")))))},Et=(s,n)=>{if(!n||!h(n))return;const t="VALUE_TYPE_NULL";let a;const i=n.flatMap(c=>c.fields).find(c=>c.field_id===s);return i&&i.value_type!==t&&i&&(a=j.ValueType[i.value_type]),a},sa=(s,n)=>{if(!n||!h(n))return;let t;const r=n.flatMap(i=>i.fields).find(i=>i.field_id===s);return r&&(t=r.component_config.type),t},oa=(s,n)=>Se(n).find(a=>a.key===s),ra=(s,n)=>{var c;let t=s.dynamicFields;const a=t[F.ATTENDANCE_STATUS],r=Re(a)?j.StudentAttendStatus[a.key]:j.StudentAttendStatus.STUDENT_ATTEND_STATUS_EMPTY,i=U(t[F.ATTENDANCE_REMARK]);delete t[F.ATTENDANCE_STATUS],delete t[F.ATTENDANCE_REMARK];const l=Object.keys(s.dynamicFields).reduce((o,d)=>{const m=Et(d,n);if(m!==void 0){const u=t[d],p=Re(u)?u.key:u,_={dynamicFieldId:d,valueType:m,boolValue:rt(p),intValue:it(p),stringValue:U(p),fieldRenderGuide:""};o.push(_)}return o},[]);return{attendanceStatus:r,attendanceRemark:i,fieldValuesList:l,courseId:U((c=s.student.course)==null?void 0:c.course_id),studentId:s.student.user.user_id}},ia=()=>g.exports.useCallback(({rawData:n,formSections:t})=>{const a=JSON.parse(JSON.stringify(n));return{lessonId:a.lessonId,lessonReportId:a.lessonReportId,detailsList:a.lessonReportDetails.map(i=>ra(i,t))}},[]),gt=s=>{var Ge,Ue,Be,$e;const{onClose:n,open:t,lessonReport:a,isLessonReportFetching:r,partnerFormConfigForEditMode:i,onUpsertLessonReportSuccess:l}=s,{lessonId:c,students:o,lessonReportId:d}=a,m=B(),u=C(),p=y(T.LESSON_MANAGEMENT),_=Bt({defaultValues:{lessonId:c,students:o,lessonReportId:d},mode:"all"}),{handleSubmit:D,getValues:b}=_,f=i&&!r,R=ea({featureName:f?void 0:sn}),{upsertLessonReport:M,saveDraftLessonReport:N}=pt(),x=ia(),w=f?(Ue=(Ge=i==null?void 0:i.data)==null?void 0:Ge.form_config_data)==null?void 0:Ue.sections:($e=(Be=R.data)==null?void 0:Be.form_config_data)==null?void 0:$e.sections,I=p("messages.submittedIndividualReportSuccessfully"),k=p(f?"messages.editedIndividualReportSuccessfully":"messages.createdReportSuccessfully"),{formActions:G,submitFormActions:$,submitDialogActions:X,cancelDialogActions:J}=ta(),{isSubmittingForm:Q,isVisibleSubmitDialog:ye,isVisibleCancelDialog:De}=G,{handleSubmittingForm:ne,handleSubmittedForm:v}=$,{handleOpenSubmitDialog:O,handleCloseSubmitDialog:ae}=X,{handleOpenCancelDialog:Oe,handleCloseCancelDialog:xe}=J,ke=g.exports.useCallback((W,se)=>{const oe=se===ce.SUBMIT_LESSON_REPORT?I:k;return{data:W,onSuccess:async()=>{await l(),m(oe),v(),ae()},onError:()=>v()}},[ae,v,l,k,m,I]),Ve=g.exports.useCallback(async(W,se)=>{var oe,He;if(!w||!h(w)){m(u("ra.manabie-error.unknown"),"error");const Z="Error LessonManagementReportsIndividualUpsert: invalid dynamic form config";(oe=window.warner)==null||oe.warn(Z);return}try{ne();const Z=x({rawData:W,formSections:w}),re=ke(Z,se);if(se===ce.SUBMIT_LESSON_REPORT){await M(re);return}await N(re)}catch(Z){v();const re=$t(Z);m(u("ra.manabie-error.unknown"),"error");const bt=`Error LessonManagementReportsIndividualUpsert: ${re.message}`;(He=window.warner)==null||He.warn(bt)}},[w,m,u,ne,x,ke,N,M,v]),Lt=async()=>{const W=b();W&&await Ve(W,ce.SAVE_DRAFT_LESSON_REPORT)},St=async()=>{const W=b();W&&(ae(),await Ve(W,ce.SUBMIT_LESSON_REPORT))},Tt=p(f?"editIndividualReport":"createIndividualReport");return e.createElement(e.Fragment,null,e.createElement(Ht,{title:Tt,open:t,onClose:Oe,onSave:n,methods:_,"data-testid":"LessonManagementReportsIndividualUpsert__dialog",footer:e.createElement(aa,{onDiscard:Oe,onSaveDraft:Lt,onSubmitAll:D(O),disableActions:{disableCancel:Q,disableDiscard:Q,disableSubmitAll:Q}}),isShowingBackdrop:Q},e.createElement(Zn,{lessonReport:a,partnerFormConfig:f?i:R})),e.createElement(st,{open:De,onClose:xe,onSave:()=>{xe(),n()}}),e.createElement(fe,{open:ye,onClose:ae,onSave:St,title:p("actions.submit"),textSave:p("actions.submit"),"data-testid":"LessonManagementReportsIndividualUpsert__dialogSubmit"},e.createElement(Ze,{variant:"body1"},p("areYouSureSubmitLessonReport"))))},la=()=>{const{convertToAutocompleteOptionProps:s}=Te();return g.exports.useCallback(({fieldId:t,fieldValue:a,formSections:r})=>{if(!r||!h(r))return;let i;const c=r.flatMap(d=>d.fields).find(d=>d.field_id===t),o=c==null?void 0:c.component_props.options;if(o&&h(o)){const d=o.find(m=>m.key===a);d&&(i=s(d))}return i},[s])},ca=(s,n)=>n.filter(t=>Boolean(s.find(a=>a.user.user_id===t.student.student_id))),da=(s,n)=>{const t=Et(s,n),a=sa(s,n);return{valueType:t,componentType:a}},ft=()=>{const s=y(T.LESSON_MANAGEMENT),n=la(),t=g.exports.useCallback(i=>{let l={};return l[F.ATTENDANCE_STATUS]=oa(U(i.attendance_status),s),l[F.ATTENDANCE_REMARK]=i.attendance_remark,l},[s]),a=g.exports.useCallback((i,l)=>{let c={};return i.forEach(o=>{const{valueType:d,componentType:m}=da(o.field_id,l);if(d!==void 0&&m===q.AUTOCOMPLETE)c[o.field_id]=n({fieldId:o.field_id,fieldValue:U(o.string_value),formSections:l});else switch(d){case j.ValueType.VALUE_TYPE_STRING:c[o.field_id]=U(o.string_value);break;case j.ValueType.VALUE_TYPE_INT:c[o.field_id]=it(o.int_value);break;case j.ValueType.VALUE_TYPE_BOOL:c[o.field_id]=rt(o.bool_value);break}}),c},[n]);return g.exports.useCallback(({lessonData:i,lessonReports:l})=>{const c=i.lesson_id,o=i.lesson_members,d=U(l==null?void 0:l.lesson_report_id);let m=[];return l&&(m=ca(o,l.lesson_report_details).map(_=>{var R;const D=o.find(M=>M.user.user_id===_.student.student_id),b=on((R=l.partner_form_config)==null?void 0:R.form_config_data.sections),f=t(D),A=a(_.partner_dynamic_form_field_values,b);return{student:D,lessonId:U(l==null?void 0:l.lesson_id),dynamicFields:S(S({},f),A)}})),{lessonId:c,students:o,lessonReportId:d,lessonReportDetails:m}},[t,a])},ua=s=>{var N,x,w;const{isInLessonManagement:n=!1,lessonData:t,lessonReports:a,isLoading:r,onEditSuccess:i,onDeleteSuccess:l}=s,[c,o]=g.exports.useState(t.lesson_members[0].user.user_id),[d,m]=g.exports.useState(!1),u=C(),_=ft()({lessonData:t,lessonReports:a}),D={data:{form_config_id:U((N=a.partner_form_config)==null?void 0:N.form_config_id),form_config_data:(x=a.partner_form_config)==null?void 0:x.form_config_data},isLoading:r},b=t.lesson_members.map(I=>{const{attendance_status:k,attendance_remark:G,user:$,course:X}=I,J=[{field_id:F.ATTENDANCE_STATUS,value:k||""},{field_id:F.ATTENDANCE_REMARK,value:G||""}];return{user:$,course:X,dynamicLessonReportData:J}}),f=vn(a.lesson_report_details,(w=a.partner_form_config)==null?void 0:w.form_config_data),R=b.map(I=>{const k=f.find(G=>G.studentId===I.user.user_id);return I.dynamicLessonReportData=I.dynamicLessonReportData.concat((k==null?void 0:k.dynamicLabelValues)||[]),I}).find(I=>I.user.user_id===c),M=async()=>{await(i==null?void 0:i()),m(!1)};return r?e.createElement(ge,null):e.createElement(L,{"data-testid":"DetailSectionStudentReportsList__container"},e.createElement(L,{pb:3},e.createElement(Bn,{lessonReports:a,onEdit:()=>m(!0),onDelete:()=>l==null?void 0:l()})),e.createElement(E,{container:!0,spacing:3},e.createElement(E,{item:!0,xs:4},t&&e.createElement(_t,{onSelect:({studentId:I})=>o(I),students:t.lesson_members})),e.createElement(E,{item:!0,xs:8},R?e.createElement(Un,{studentLessonReportData:R,isInLessonManagement:n,lessonReports:a}):e.createElement(Ce,{noDataMessage:u("ra.message.noDataInformation")}))),d&&e.createElement(gt,{open:d,onClose:()=>m(!1),onUpsertLessonReportSuccess:M,lessonReport:_,partnerFormConfigForEditMode:D,isLessonReportFetching:r}))},ma=s=>{const{lesson:n,isLoadingGeneralInfo:t,centerName:a,isLoadingCenter:r}=s,i=C(),l=y(T.LESSON_MANAGEMENT),c=B();n.lessons_teachers||c(l("errors.unableToFindTeacher"),"error");const{isEnabled:o}=rn(Yt.LESSON_MANAGEMENT_LESSON_GROUP),d=ln(new Date(n.start_time),i),m=cn(n.start_time,n.end_time),u=o&&n.teaching_method==="LESSON_TEACHING_METHOD_GROUP";return e.createElement(L,{"data-testid":"LessonDetailsGeneralInfo__root"},e.createElement(L,{mb:2},e.createElement(Y,{variant:"subtitle1"},l("generalInfo"))),e.createElement(E,{container:!0,spacing:2},e.createElement(E,{item:!0,xs:6},e.createElement(P,{variant:"horizontal",value:me(n.start_time,"yyyy/LL/dd"),label:l("columns.lessonDate"),isLoading:t,dataTestidValue:"LessonDetailsGeneralInfo__lessonDate"})),e.createElement(E,{item:!0,xs:6},e.createElement(P,{variant:"horizontal",value:d,label:l("dayOfTheWeek"),isLoading:t,dataTestidValue:"LessonDetailsGeneralInfo__dayOfWeek"})),e.createElement(E,{item:!0,xs:6},e.createElement(P,{variant:"horizontal",value:me(n.start_time,"HH:mm"),label:l("startTime"),isLoading:t,dataTestidValue:"LessonDetailsGeneralInfo__startTime"})),e.createElement(E,{item:!0,xs:6},e.createElement(P,{variant:"horizontal",value:me(n.end_time,"HH:mm"),label:l("endTime"),isLoading:t,dataTestidValue:"LessonDetailsGeneralInfo__endTime"})),e.createElement(E,{item:!0,xs:6},e.createElement(P,{variant:"horizontal",value:`${m} ${l("minutes")}`,label:l("totalTime"),isLoading:t,dataTestidValue:"LessonDetailsGeneralInfo__totalTime"})),e.createElement(E,{item:!0,xs:6},e.createElement(P,{variant:"horizontal",value:l(`${n.teaching_medium}`),label:l("columns.teachingMedium"),isLoading:t,dataTestidValue:"LessonDetailsGeneralInfo__teachingMedium"})),e.createElement(E,{item:!0,xs:6},e.createElement(P,{variant:"horizontal",value:l(`${n.teaching_method}`),label:l("columns.teachingMethod"),isLoading:t,dataTestidValue:"LessonDetailsGeneralInfo__teachingMethod"})),e.createElement(E,{item:!0,xs:6},e.createElement(P,{variant:"horizontal",value:a,label:l("columns.location"),isLoading:r||t,dataTestidValue:"LessonDetailsGeneralInfo__center"})),e.createElement(E,{item:!0,xs:6},e.createElement(P,{variant:"horizontal",value:dn(n.lessons_teachers),label:l("columns.teacher"),isLoading:t,dataTestidValue:"LessonDetailsGeneralInfo__teachers"})),u?e.createElement(E,{item:!0,xs:6},e.createElement(P,{variant:"horizontal",value:"Course Name 01",label:l("columns.course"),isLoading:t,dataTestidValue:"LessonDetailsGeneralInfo__course"})):null,u?e.createElement(E,{item:!0,xs:6},e.createElement(P,{variant:"horizontal",value:"Class Name 01",label:l("columns.class"),isLoading:t,dataTestidValue:"LessonDetailsGeneralInfo__class"})):null))},pa=s=>{const{mediasList:n,isLoadingMedias:t,onConvertSuccessfully:a,isInLessonManagement:r}=s,i=C();return t?e.createElement(Wt,{"data-testid":"ListMaterials__skeleton"}):n&&h(n)?e.createElement(L,{width:r?"30%":"100%"},e.createElement(En,{medias:n,variant:"outlined",requirePdfConversion:!0,onConvertSuccessfully:a})):e.createElement(Le,null,e.createElement(Ce,{noDataMessage:i("ra.message.noDataInformation")}))},_a=s=>{const{mediasList:n,isLoadingMedias:t}=s,a=y(T.LESSON_MANAGEMENT);return e.createElement(L,{"data-testid":"LessonDetailsMaterials__root"},e.createElement(L,{mb:2},e.createElement(Y,{variant:"subtitle1"},a("materialInfo"))),e.createElement(pa,{mediasList:n,isLoadingMedias:t,isInLessonManagement:!0}))},Ea=s=>{const{isLoading:n,lessonMembers:t}=s,[a,r]=g.exports.useState(t),b=Pn({defaultOffset:0,defaultLimit:5}),{setLimit:l,setOffset:c}=b,o=le(b,["setLimit","setOffset"]),d=K(S({},o),{count:t.length});g.exports.useEffect(()=>{const f=[...t],A=d.page*d.limit,R=f.slice(A,A+d.limit);r(R)},[t,d.limit,d.page]);const m=y(T.LESSON_MANAGEMENT),u=C(),{getStudentGradeName:p}=un(),_=zt(),D=g.exports.useMemo(()=>[{title:m("columns.studentName"),key:"colName",cellProps:{style:{width:"30%"}},render:f=>e.createElement(Ie,{variant:"body2",maxLines:2,"data-testid":"LessonDetailsStudentsTable__columnStudentName"},f.user.name)},{title:m("columns.grade"),key:"colGrade",cellProps:{style:{width:"10%"}},render:f=>{var A;return e.createElement(ue,{variant:"body2","data-testid":"LessonDetailsStudentsTable__columnGrade"},u(p((A=f.user.student)==null?void 0:A.current_grade)||""))}},{title:m("course"),key:"colCourse",cellProps:{style:{width:"40%"}},render:f=>{var A;return e.createElement(Ie,{variant:"body2",maxLines:2,"data-testid":"LessonDetailsStudentsTable__columnCourseName"},((A=f.course)==null?void 0:A.name)||"")}},{title:m("attendance"),key:"colAttendance",cellProps:{style:{width:"15%"}},render:f=>{const A=f.attendance_status===mn.STUDENT_ATTEND_STATUS_EMPTY||!f.attendance_status,R=A?"--":m(`studentAttendanceStatus.${f.attendance_status}`);return e.createElement(ue,{variant:"body2","data-testid":"LessonDetailsStudentsTable__columnAttendanceStatus",color:A?_.palette.grey[400]:"inherit"},R)}}],[m,u,p,_.palette.grey]);return e.createElement(L,{"data-testid":"LessonDetailsStudentsTable__root"},e.createElement(L,{mb:2},e.createElement(ue,{variant:"subtitle1"},m("studentInfo")," (",a.length,")")),e.createElement(et,{data:a,columns:D,tableProps:{"data-testid":"LessonDetailsStudentList__table"},withIndex:!0,body:{rowKey:"user.user_id",loading:n,pagination:d},footer:{pagination:d}}))},Qe=e.createElement(L,{my:3},e.createElement(te,null)),ga=s=>{const{lesson:n,isLoadingLesson:t,mediasList:a,isLoadingMedia:r,centerName:i,isLoadingCenter:l,onUpdatedLesson:c}=s,o=y(T.LESSON_MANAGEMENT),[d,m]=g.exports.useState(!1),u=t||r||l||!n,p=async()=>{await c(),m(!1)};return e.createElement(L,{"data-testid":"LessonDetailsTab__container"},e.createElement(ot,{title:o("lessonDetail"),action:e.createElement(Kt,{isLoading:u,disabled:u,variant:"outlined",onClick:()=>m(!0),"data-testid":"LessonDetailsTab__buttonEdit",startIcon:e.createElement(Je,null)})}),e.createElement(ma,{lesson:n,isLoadingGeneralInfo:t,centerName:i,isLoadingCenter:l}),Qe,e.createElement(Ea,{lessonMembers:n.lesson_members,isLoading:t}),Qe,e.createElement(_a,{mediasList:a,isLoadingMedias:r}),d&&e.createElement(pn,{isOpen:d,onUpsertSuccessfully:p,onCloseUpsertDialog:()=>m(!1),lesson:n,centerName:i,mediasList:a}))},fa=()=>{const s=C(),n=B(),{mutate:t}=pe({entity:"lessons",action:"lessonsDelete"})();return{deleteLesson:g.exports.useCallback(async r=>{const{lessonId:i,onSuccess:l,onError:c}=r;t({lessonId:i},{onSuccess:l,onError:o=>{var d;n(s("ra.manabie-error.unknown"),"error"),(d=window.warner)==null||d.warn(`Error DeleteLessonOfLessonManagement: ${o.message}`),c==null||c()}})},[t,n,s])}},La=s=>{const{lessonTitle:n,lessonId:t,onDeleteSuccess:a}=s,[r,i]=g.exports.useState(!1),l=C(),c=y(T.LESSON_MANAGEMENT),{deleteLesson:o}=fa(),d=g.exports.useCallback(p=>{if(p===Ke.DELETE)return i(!0)},[]),m=async()=>{await o({lessonId:t,onSuccess:()=>a()})},u=[{action:Ke.DELETE,label:l("ra.action.delete"),withConfirm:!1}];return e.createElement(e.Fragment,null,e.createElement(ot,{title:n,action:e.createElement(at,{actions:u,onAction:d,recordName:"",buttonStyle:"square"})}),r&&e.createElement(st,{open:r,onSave:m,onClose:()=>i(!1),textSave:l("ra.action.delete"),title:c("deleteLesson"),textCancelDialog:e.createElement(e.Fragment,null,c("areYouSureDeleteTheLesson"),e.createElement("br",null),c("ifYouDeleteThisLesson"))}))},Sa=s=>{const{studentCourseInfos:n}=s,t=B(),a=C(),{data:r,isLoading:i,refetch:l}=V({entity:"lessonStudentSubscriptions",action:"lessonStudentSubscriptionsGetStudentCourseSubscription"})(n,{enabled:h(n),onError(c){var o;(o=window.warner)==null||o.warn("useGetStudentSubcriptions fetch",c),t(`${a("ra.message.unableToLoadData")} ${c.message}`,"error")}});return{studentSubscriptions:r==null?void 0:r.itemsList,isLoadingStudentSubscriptions:i,refetchStudentCourseSubscriptions:l}},Ta=s=>s.map(n=>{var t;return{studentId:n.user.user_id,courseId:`${(t=n.course)==null?void 0:t.course_id}`}}),ba=s=>{const{lessonId:n,shouldEnableQuery:t=!0,onQueryLessonReportSuccess:a}=s,r=B(),i=C(),l=y(T.LESSON_MANAGEMENT),c=Boolean(n)&&t,{data:o,isLoading:d,refetch:m}=V({entity:"lessons",action:"lessonsGetOne"})({lesson_id:n},{enabled:c,onError(v){var O;(O=window.warner)==null||O.warn("useLessonReportDetail fetchLesson",v),r(`${i("ra.message.unableToLoadData")} ${v.message}`,"error")}}),u=Boolean(o)&&t,{data:p,isLoading:_,refetch:D}=V({entity:"lessonReports",action:"lessonReportsGetOne"})({lesson_id:o==null?void 0:o.lesson_id},{enabled:u,onError(v){var O;(O=window.warner)==null||O.warn("useLessonReportDetail fetchLessonReport",v),r(`${l("errors.unableToGetLessonReport")}`,"error")},onSuccess:v=>{v&&(a==null||a())}}),b=Boolean(o)&&Boolean(o==null?void 0:o.center_id),{data:f,isLoading:A,refetch:R}=V({entity:"locations",action:"locationsGetOne"})({location_id:(o==null?void 0:o.center_id)||void 0},{enabled:b,onError(v){var O;(O=window.warner)==null||O.warn("useLessonReportDetail fetchCenter",v),r(l("errors.unableToFetchCenter"),"error")}}),M=Boolean(o==null?void 0:o.lesson_group_id),{data:N,isLoading:x,refetch:w}=V({entity:"lessonGroups",action:"lessonGroupsGetOne"})({lesson_group_id:(o==null?void 0:o.lesson_group_id)||void 0},{enabled:M,onError(v){var O;(O=window.warner)==null||O.warn("useLessonReportDetail fetchLessonGroup",v),r(l("errors.unableToFetchLessonGroup"),"error")}}),I=h(N==null?void 0:N.media_ids),{data:k=[],isLoading:G,refetch:$}=V({entity:"media",action:"mediaGetMany"})({media_id:N==null?void 0:N.media_ids},{enabled:I,onError(v){var O;(O=window.warner)==null||O.warn("useLessonReportDetail fetchMedias",v),r(l("errors.unableToFetchMedia"),"error")}}),X=Ta((o==null?void 0:o.lesson_members)||[]),J=h(o==null?void 0:o.lesson_members),{studentSubscriptions:Q,isLoadingStudentSubscriptions:ye,refetchStudentCourseSubscriptions:De}=Sa({studentCourseInfos:X}),ne=async()=>{if(c&&await m(),u&&await D(),b&&await R(),M){const{data:v}=await w();h(v==null?void 0:v.media_ids)&&await $()}J&&await De()};return{isLoadingLesson:d||ye,isLoadingLessonReport:_,isLoadingMedia:d||x||G,lessonData:o?K(S({},o),{studentSubscriptions:Q}):void 0,lessonReports:p,mediasList:I?k:[],center:f,isLoadingCenter:A,refetchLessonAndLessonReportDetail:ne}},ya=()=>{const{lessonId:s}=qt(),n=jt(),[t,a]=g.exports.useState(!1),[r,i]=g.exports.useState(!1),l=g.exports.useRef(),c=$=>l.current&&l.current.changeCurrentTab($),{lessonData:o,isLoadingLesson:d,lessonReports:m,isLoadingLessonReport:u,refetchLessonAndLessonReportDetail:p,isLoadingMedia:_,mediasList:D,center:b,isLoadingCenter:f}=ba({lessonId:s,onQueryLessonReportSuccess:()=>r&&c(_n.REPORTS)}),A=ft(),R=B(),M=y(T.LESSON_MANAGEMENT),N=async()=>{i(!0),await p(),a(!1)},x=async()=>{i(!1),await p()};if(!s)return R(M("errors.unableToGetLessonId"),"error"),e.createElement(Qt,{to:`/${he.LESSON}/${T.LESSON_MANAGEMENT}`});if(d)return e.createElement(ge,null);if(!o)return e.createElement(Y,null,M("errors.unableToFindLessonInfo"));const w=me(o.start_time,"yyyy/LL/dd"),I=()=>{const $=[{tabName:e.createElement(qe,{label:M("lessonInfo")}),tabPanel:e.createElement(L,{py:3},e.createElement(ga,{lesson:o,isLoadingLesson:d,isLoadingMedia:_,mediasList:D,centerName:_e(b==null?void 0:b.name),isLoadingCenter:f,onUpdatedLesson:x}))}];return m&&$.push({tabName:e.createElement(qe,{label:M("report")}),tabPanel:e.createElement(L,{pt:3},e.createElement(ua,{isInLessonManagement:!0,lessonData:o,lessonReports:m,isLoading:u,onEditSuccess:p}))}),$},k=()=>{if(u)return e.createElement(ge,null);if(!u&&!m)return e.createElement(Pe,{startIcon:e.createElement(en,null),onClick:()=>a(!0),"data-testid":"LessonManagementIndividualDetails__createReportButton"},M("report"))},G=!u&&!m&&o;return e.createElement(e.Fragment,null,e.createElement(Xt,{"data-testid":"LessonManagementIndividualDetails__root"},e.createElement(Jt,{resource:T.LESSON_MANAGEMENT,name:w}),e.createElement(La,{lessonTitle:_e(w),lessonId:s,onDeleteSuccess:()=>{R(M("messages.success.deleteLesson")),n.push(`/${he.LESSON}/${T.LESSON_MANAGEMENT}`)}}),e.createElement(Zt,{hasDivider:!0,mapTabs:I(),tabHeaderAction:k(),ref:l})),G&&e.createElement(gt,{open:t,onClose:()=>a(!1),lessonReport:A({lessonData:o,lessonReports:m}),isLessonReportFetching:u,onUpsertLessonReportSuccess:N}))};var ka=ya;export{ka as default};
