var R=Object.defineProperty,A=Object.defineProperties;var w=Object.getOwnPropertyDescriptors;var P=Object.getOwnPropertySymbols;var L=Object.prototype.hasOwnProperty,k=Object.prototype.propertyIsEnumerable;var f=(r,t,a)=>t in r?R(r,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):r[t]=a,m=(r,t)=>{for(var a in t||(t={}))L.call(t,a)&&f(r,a,t[a]);if(P)for(var a of P(t))k.call(t,a)&&f(r,a,t[a]);return r},_=(r,t)=>A(r,w(t));import{gK as B,h1 as U,R as e,aJ as n,aj as x,aK as E,g7 as y,aS as C,db as M,eL as N,g6 as q,r as l,ai as V,ch as Y,e3 as G,de as K,fG as W,h4 as j,ey as H,gD as $,d7 as J,gE as Q,gq as X,b as z,gF as Z,aH as ee,cp as te}from"./index.7daee9ef.js";import{a as re,C as ae,u as ne,O as oe,b as se,P as ce}from"./OrderUpsertForm.355b1b9f.js";import{u as de}from"./useFetchStudentInfo.0fff90f4.js";import"./AccordionSummaryBase.51fee70a.js";import"./IconButtonBase.a835a6a3.js";import"./toInteger.9a87c39c.js";import"./intersection.1a672747.js";import"./_castArrayLikeObject.2e9ca1e4.js";import"./isArrayLikeObject.979eb0a9.js";import"./_baseRest.fb013a79.js";const h=({productFieldItem:r})=>{const{product:t,status:a}=r,{getProductPluginsMap:o}=re(),s=B(r),{ProductPreviewItemChild:c}=o(s),d=a===U.CANCELLED;return e.createElement(n,{container:!0,spacing:2},e.createElement(n,{item:!0,xs:12},e.createElement(x,{display:"flex",justifyItems:"center"},d&&e.createElement(ae,{mr:.5}),e.createElement(x,null,e.createElement(E,{variant:"subtitle1"},t==null?void 0:t.name)))),e.createElement(n,{item:!0,xs:12},e.createElement(c,{productFieldItem:r})))},ie=({beforeProductFieldItem:r,afterProductFieldItem:t})=>{const a=y(C.ORDERS);return e.createElement(M,null,e.createElement(n,{container:!0},e.createElement(n,{item:!0,xs:!0},e.createElement(n,{container:!0,spacing:3},e.createElement(n,{item:!0,xs:12},e.createElement(E,{variant:"h6"},a("title.beforeUpdateInfo"))),e.createElement(n,{item:!0,xs:12},e.createElement(h,{productFieldItem:r})))),e.createElement(n,{item:!0,width:"49px",pr:3,pl:3},e.createElement(N,{orientation:"vertical",sx:o=>({borderRight:`1px dashed ${o.palette.divider}`,borderBottom:0,backgroundColor:"transparent",width:"1px"}),textAlign:"center"})),e.createElement(n,{item:!0,xs:!0},e.createElement(n,{container:!0,spacing:3},e.createElement(n,{item:!0,xs:12},e.createElement(E,{variant:"h6"},a("title.afterUpdateInfo"))),e.createElement(n,{item:!0,xs:12},e.createElement(h,{productFieldItem:t}))))))},le=({isOpen:r,hasNextPage:t,onNextPage:a,children:o,isLoading:s,onSave:c,openDialogCancel:d,onPreviousPage:i})=>{const u=y(C.ORDERS);return e.createElement(W,{title:u("title.updateProducts"),open:r,onClose:d,onSave:c,"data-testid":"UpdateOrderUpsertDialog__dialog",isShowingBackdrop:s,footer:e.createElement(se,{onCancel:d,hasNextPage:t,onNextPage:a,onPreviousPage:i,onSubmit:c})},o)},ue=({isOpen:r,onClose:t,defaultProduct:a})=>{const o=q(),[s,c]=l.exports.useState(null),d=l.exports.useRef(),[i,u]=l.exports.useState(!1),[O,p]=V(!1),I=l.exports.useCallback(()=>{p(!0)},[p]),{handleSubmit:v}=Y(),[T]=G({name:["productFieldArrayItem"]}),g=ne(),F=l.exports.useCallback(S=>{const{isError:b,errorMessage:D}=g.productArrayTable.validate(S.productFieldArrayItem);if(b){c(D);return}},[g.productArrayTable]);return e.createElement(e.Fragment,null,e.createElement(le,{isOpen:r,onSave:v(F),isLoading:!1,openDialogCancel:I,hasNextPage:!i,onNextPage:()=>u(!0),onPreviousPage:()=>u(!1)},i?e.createElement(ie,{beforeProductFieldItem:a,afterProductFieldItem:T[0]}):e.createElement(oe,{productErrorMessage:s,productListSectionRef:d})),e.createElement(K,{open:O,onClose:()=>p(!1),onSave:()=>{t(),p(!1)},textSave:o("ra.common.action.leave")}))};function pe(r){const t={product_id:177,name:"Demo Update Product",product_type:j.PRODUCT_TYPE_FEE,tax_id:1,available_from:"2021-12-28T02:35:17.738471+00:00",available_until:"2022-12-28T02:35:17.738471+00:00",remarks:"Remark 1",billing_schedule_id:1,disable_pro_rating_flag:!1,updated_at:"2021-12-28T02:35:17.738675+00:00",created_at:"2021-12-28T02:35:17.738675+00:00"};return{product:_(m({},t),{value:t.name}),fee:{fee_type:"FEE_TYPE_ONE_TIME"},productTax:{tax_category:"TAX_CATEGORY_INCLUSIVE",tax_percentage:30},productPrices:[{billing_schedule_period_id:null,created_at:"2022-05-09T11:02:07.616219+00:00",price:300,product_id:177,product_price_id:2229,quantity:1}],status:U.ACTIVE}}const me=({studentInfo:r,product:t})=>{const a=z(),{search:o}=Z(),s=ee({defaultValues:{student:r,productFieldArrayItem:[t]}}),c=()=>{const i=new URLSearchParams(o).get("redirectUrl");i?a.push(i):a.goBack()};return e.createElement(te,m({},s),e.createElement(ue,{isOpen:!0,onClose:c,defaultProduct:t}))},Ee=()=>{const{studentId:r,studentProductId:t}=H(),a=typeof r=="string"?r:void 0,{currentCurrency:o}=$(),{data:s,isFetching:c}=de({studentId:a}),d=pe();return c?e.createElement(J,null):typeof s=="undefined"?e.createElement(Q,{"data-testid":"UpdateOrderUpsert__notfound"}):e.createElement(ce,{currency:o,orderType:X.OrderType.ORDER_TYPE_UPDATE},e.createElement(me,{studentInfo:s,product:d}))};var ve=Ee;export{ve as default};
